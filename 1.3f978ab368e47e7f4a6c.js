(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{"I/3d":function(t,e,n){"use strict";n.d(e,"a",function(){return ip});var r=n("fXoL"),i=n("D0XW"),o=n("HDdC"),s=n("Cfvw"),a=n("LRne"),u=n("JX91"),c=n("Zy1z"),h=n("lJxs"),l=n("Kqap"),f=n("/uUt"),d=n("pLZG"),p=n("pxpQ"),y=n("spgP"),g=n("ofXK"),v=n("Jgta"),m=n("zIRd"),b=n("mrSG"),w=n("qOnz"),I=n("q/0M"),T=function(t,e){return(T=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function E(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var _,O="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},S=S||{},D=O||self;function N(){}function A(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function j(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var k="closure_uid_"+(1e9*Math.random()>>>0),C=0;function x(t,e,n){return t.call.apply(t.bind,arguments)}function R(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function P(t,e,n){return(P=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?x:R).apply(null,arguments)}function L(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function F(t,e){function n(){}n.prototype=e.prototype,t.Z=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Vb=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function M(){this.s=this.s,this.o=this.o}var V={};M.prototype.s=!1,M.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var t=function(t){return Object.prototype.hasOwnProperty.call(t,k)&&t[k]||(t[k]=++C)}(this);delete V[t]}},M.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var q=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},U=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function B(t){return Array.prototype.concat.apply([],arguments)}function K(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function G(t){return/^[\s\xa0]*$/.test(t)}var Q,z=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function H(t,e){return-1!=t.indexOf(e)}function W(t,e){return t<e?-1:t>e?1:0}t:{var Y=D.navigator;if(Y){var X=Y.userAgent;if(X){Q=X;break t}}Q=""}function $(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function J(t){var e={};for(var n in t)e[n]=t[n];return e}var Z="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function tt(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<Z.length;o++)n=Z[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function et(t){return et[" "](t),t}et[" "]=N;var nt,rt,it=H(Q,"Opera"),ot=H(Q,"Trident")||H(Q,"MSIE"),st=H(Q,"Edge"),at=st||ot,ut=H(Q,"Gecko")&&!(H(Q.toLowerCase(),"webkit")&&!H(Q,"Edge"))&&!(H(Q,"Trident")||H(Q,"MSIE"))&&!H(Q,"Edge"),ct=H(Q.toLowerCase(),"webkit")&&!H(Q,"Edge");function ht(){var t=D.document;return t?t.documentMode:void 0}t:{var lt="",ft=(rt=Q,ut?/rv:([^\);]+)(\)|;)/.exec(rt):st?/Edge\/([\d\.]+)/.exec(rt):ot?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(rt):ct?/WebKit\/(\S+)/.exec(rt):it?/(?:Version)[ \/]?(\S+)/.exec(rt):void 0);if(ft&&(lt=ft?ft[1]:""),ot){var dt=ht();if(null!=dt&&dt>parseFloat(lt)){nt=String(dt);break t}}nt=lt}var pt={};var yt=D.document&&ot&&(ht()||parseInt(nt,10))||void 0,gt=function(){if(!D.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{D.addEventListener("test",N,e),D.removeEventListener("test",N,e)}catch(n){}return t}();function vt(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}function mt(t,e){if(vt.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(ut){t:{try{et(e.nodeName);var i=!0;break t}catch(o){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:bt[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&mt.Z.h.call(this)}}vt.prototype.h=function(){this.defaultPrevented=!0},F(mt,vt);var bt={2:"touch",3:"pen",4:"mouse"};mt.prototype.h=function(){mt.Z.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var wt="closure_listenable_"+(1e6*Math.random()|0),It=0;function Tt(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ia=i,this.key=++It,this.ca=this.fa=!1}function Et(t){t.ca=!0,t.listener=null,t.proxy=null,t.src=null,t.ia=null}function _t(t){this.src=t,this.g={},this.h=0}function Ot(t,e){var n=e.type;if(n in t.g){var r,i=t.g[n],o=q(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(Et(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function St(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.ca&&o.listener==e&&o.capture==!!n&&o.ia==r)return i}return-1}_t.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.g[o])||(t=this.g[o]=[],this.h++);var s=St(t,e,r,i);return-1<s?(e=t[s],n||(e.fa=!1)):((e=new Tt(e,this.src,o,!!r,i)).fa=n,t.push(e)),e};var Dt="closure_lm_"+(1e6*Math.random()|0),Nt={};function At(t,e,n,r,i){if(r&&r.once)return kt(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)At(t,e[o],n,r,i);return null}return n=Mt(n),t&&t[wt]?t.N(e,n,j(r)?!!r.capture:!!r,i):jt(t,e,n,!1,r,i)}function jt(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=j(i)?!!i.capture:!!i,a=Lt(t);if(a||(t[Dt]=a=new _t(t)),(n=a.add(e,n,r,s,o)).proxy)return n;if(r=function(){var t=Pt;return function e(n){return t.call(e.src,e.listener,n)}}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)gt||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Rt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function kt(t,e,n,r,i){if(Array.isArray(e)){for(var o=0;o<e.length;o++)kt(t,e[o],n,r,i);return null}return n=Mt(n),t&&t[wt]?t.O(e,n,j(r)?!!r.capture:!!r,i):jt(t,e,n,!0,r,i)}function Ct(t,e,n,r,i){if(Array.isArray(e))for(var o=0;o<e.length;o++)Ct(t,e[o],n,r,i);else r=j(r)?!!r.capture:!!r,n=Mt(n),t&&t[wt]?(t=t.i,(e=String(e).toString())in t.g&&-1<(n=St(o=t.g[e],n,r,i))&&(Et(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete t.g[e],t.h--))):t&&(t=Lt(t))&&(e=t.g[e.toString()],t=-1,e&&(t=St(e,n,r,i)),(n=-1<t?e[t]:null)&&xt(n))}function xt(t){if("number"!=typeof t&&t&&!t.ca){var e=t.src;if(e&&e[wt])Ot(e.i,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Rt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Lt(e))?(Ot(n,t),0==n.h&&(n.src=null,e[Dt]=null)):Et(t)}}}function Rt(t){return t in Nt?Nt[t]:Nt[t]="on"+t}function Pt(t,e){if(t.ca)t=!0;else{e=new mt(e,this);var n=t.listener,r=t.ia||t.src;t.fa&&xt(t),t=n.call(r,e)}return t}function Lt(t){return(t=t[Dt])instanceof _t?t:null}var Ft="__closure_events_fn_"+(1e9*Math.random()>>>0);function Mt(t){return"function"==typeof t?t:(t[Ft]||(t[Ft]=function(e){return t.handleEvent(e)}),t[Ft])}function Vt(){M.call(this),this.i=new _t(this),this.P=this,this.I=null}function qt(t,e){var n,r=t.I;if(r)for(n=[];r;r=r.I)n.push(r);if(t=t.P,r=e.type||e,"string"==typeof e)e=new vt(e,t);else if(e instanceof vt)e.target=e.target||t;else{var i=e;tt(e=new vt(r,t),i)}if(i=!0,n)for(var o=n.length-1;0<=o;o--){var s=e.g=n[o];i=Ut(s,r,!0,e)&&i}if(i=Ut(s=e.g=t,r,!0,e)&&i,i=Ut(s,r,!1,e)&&i,n)for(o=0;o<n.length;o++)i=Ut(s=e.g=n[o],r,!1,e)&&i}function Ut(t,e,n,r){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s=e[o];if(s&&!s.ca&&s.capture==n){var a=s.listener,u=s.ia||s.src;s.fa&&Ot(t.i,s),i=!1!==a.call(u,r)&&i}}return i&&!r.defaultPrevented}F(Vt,M),Vt.prototype[wt]=!0,Vt.prototype.removeEventListener=function(t,e,n,r){Ct(this,t,e,n,r)},Vt.prototype.M=function(){if(Vt.Z.M.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],r=0;r<n.length;r++)Et(n[r]);delete e.g[t],e.h--}}this.I=null},Vt.prototype.N=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)},Vt.prototype.O=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};var Bt=D.JSON.stringify;function Kt(){var t=$t,e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var Gt,Qt=function(){function t(){this.h=this.g=null}return t.prototype.add=function(t,e){var n=zt.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n},t}(),zt=new(function(){function t(t,e){this.i=t,this.j=e,this.h=0,this.g=null}return t.prototype.get=function(){var t;return 0<this.h?(this.h--,this.g=(t=this.g).next,t.next=null):t=this.i(),t},t}())(function(){return new Ht},function(t){return t.reset()}),Ht=function(){function t(){this.next=this.g=this.h=null}return t.prototype.set=function(t,e){this.h=t,this.g=e,this.next=null},t.prototype.reset=function(){this.next=this.g=this.h=null},t}();function Wt(t){D.setTimeout(function(){throw t},0)}function Yt(t,e){Gt||function(){var t=D.Promise.resolve(void 0);Gt=function(){t.then(Jt)}}(),Xt||(Gt(),Xt=!0),$t.add(t,e)}var Xt=!1,$t=new Qt;function Jt(){for(var t;t=Kt();){try{t.h.call(t.g)}catch(n){Wt(n)}var e=zt;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}Xt=!1}function Zt(t,e){Vt.call(this),this.h=t||1,this.g=e||D,this.j=P(this.kb,this),this.l=Date.now()}function te(t){t.da=!1,t.S&&(t.g.clearTimeout(t.S),t.S=null)}function ee(t,e,n){if("function"==typeof t)n&&(t=P(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=P(t.handleEvent,t)}return 2147483647<Number(e)?-1:D.setTimeout(t,e||0)}function ne(t){t.g=ee(function(){t.g=null,t.i&&(t.i=!1,ne(t))},t.j);var e=t.h;t.h=null,t.m.apply(null,e)}F(Zt,Vt),(_=Zt.prototype).da=!1,_.S=null,_.kb=function(){if(this.da){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-t):(this.S&&(this.g.clearTimeout(this.S),this.S=null),qt(this,"tick"),this.da&&(te(this),this.start()))}},_.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},_.M=function(){Zt.Z.M.call(this),te(this),delete this.g};var re=function(t){function e(e,n){var r=t.call(this)||this;return r.m=e,r.j=n,r.h=null,r.i=!1,r.g=null,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}T(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.l=function(t){this.h=arguments,this.g?this.i=!0:ne(this)},e.prototype.M=function(){t.prototype.M.call(this),this.g&&(D.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)},e}(M);function ie(t){M.call(this),this.h=t,this.g={}}F(ie,M);var oe=[];function se(t,e,n,r){Array.isArray(n)||(n&&(oe[0]=n.toString()),n=oe);for(var i=0;i<n.length;i++){var o=At(e,n[i],r||t.handleEvent,!1,t.h||t);if(!o)break;t.g[o.key]=o}}function ae(t){$(t.g,function(t,e){this.g.hasOwnProperty(e)&&xt(t)},t),t.g={}}function ue(){this.g=!0}function ce(t,e,n,r){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var o=i[0];if("noop"!=o&&"stop"!=o&&"close"!=o)for(var s=1;s<i.length;s++)i[s]=""}}}return Bt(n)}catch(a){return e}}(t,n)+(r?" "+r:"")})}ie.prototype.M=function(){ie.Z.M.call(this),ae(this)},ie.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},ue.prototype.Aa=function(){this.g=!1},ue.prototype.info=function(){};var he={},le=null;function fe(){return le=le||new Vt}function de(t){vt.call(this,he.Ma,t)}function pe(t){var e=fe();qt(e,new de(e,t))}function ye(t,e){vt.call(this,he.STAT_EVENT,t),this.stat=e}function ge(t){var e=fe();qt(e,new ye(e,t))}function ve(t,e){vt.call(this,he.Na,t),this.size=e}function me(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return D.setTimeout(function(){t()},e)}he.Ma="serverreachability",F(de,vt),he.STAT_EVENT="statevent",F(ye,vt),he.Na="timingevent",F(ve,vt);var be={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},we={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function Ie(){}function Te(){}Ie.prototype.h=null;var Ee,_e={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function Oe(){vt.call(this,"d")}function Se(){vt.call(this,"c")}function De(){}function Ne(t,e,n,r){this.l=t,this.j=e,this.m=n,this.X=r||1,this.V=new ie(this),this.P=je,this.W=new Zt(t=at?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new Ae}function Ae(){this.i=null,this.g="",this.h=!1}F(Oe,vt),F(Se,vt),F(De,Ie),De.prototype.g=function(){return new XMLHttpRequest},De.prototype.i=function(){return{}},Ee=new De;var je=45e3,ke={},Ce={};function xe(t,e,n){t.K=1,t.v=nn(Xe(e)),t.s=n,t.U=!0,Re(t,null)}function Re(t,e){t.F=Date.now(),Me(t),t.A=Xe(t.v);var n=t.A,r=t.X;Array.isArray(r)||(r=[String(r)]),gn(n.h,"t",r),t.C=0,n=t.l.H,t.h=new Ae,t.g=vr(t.l,n?e:null,!t.s),0<t.O&&(t.L=new re(P(t.Ia,t,t.g),t.O)),se(t.V,t.g,"readystatechange",t.gb),e=t.H?J(t.H):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ea(t.A,t.u,t.s,e)):(t.u="GET",t.g.ea(t.A,t.u,null,e)),pe(1),function(t,e,n,r,i,o){t.info(function(){if(t.g)if(o)for(var s="",a=o.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var h=c[0];c=c[1];var l=h.split("_");s=2<=l.length&&"type"==l[1]?s+(h+"=")+c+"&":s+(h+"=redacted&")}}else s=null;else s=o;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+n+"\n"+s})}(t.j,t.u,t.A,t.m,t.X,t.s)}function Pe(t){return!!t.g&&"GET"==t.u&&2!=t.K&&t.l.Ba}function Le(t,e,n){for(var r,i=!0;!t.I&&t.C<n.length;){if((r=Fe(t,n))==Ce){4==e&&(t.o=4,ge(14),i=!1),ce(t.j,t.m,null,"[Incomplete Response]");break}if(r==ke){t.o=4,ge(15),ce(t.j,t.m,n,"[Invalid Chunk]"),i=!1;break}ce(t.j,t.m,r,null),Ke(t,r)}Pe(t)&&r!=Ce&&r!=ke&&(t.h.g="",t.C=0),4!=e||0!=n.length||t.h.h||(t.o=1,ge(16),i=!1),t.i=t.i&&i,i?0<n.length&&!t.aa&&(t.aa=!0,(e=t.l).g==t&&e.$&&!e.L&&(e.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),cr(e),e.L=!0,ge(11))):(ce(t.j,t.m,n,"[Invalid Chunked Response]"),Be(t),Ue(t))}function Fe(t,e){var n=t.C,r=e.indexOf("\n",n);return-1==r?Ce:(n=Number(e.substring(n,r)),isNaN(n)?ke:(r+=1)+n>e.length?Ce:(e=e.substr(r,n),t.C=r+n,e))}function Me(t){t.Y=Date.now()+t.P,Ve(t,t.P)}function Ve(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=me(P(t.eb,t),e)}function qe(t){t.B&&(D.clearTimeout(t.B),t.B=null)}function Ue(t){0==t.l.G||t.I||fr(t.l,t)}function Be(t){qe(t);var e=t.L;e&&"function"==typeof e.na&&e.na(),t.L=null,te(t.W),ae(t.V),t.g&&(e=t.g,t.g=null,e.abort(),e.na())}function Ke(t,e){try{var n=t.l;if(0!=n.G&&(n.g==t||En(n.i,t)))if(n.I=t.N,!t.J&&En(n.i,t)&&3==n.G){try{var r=n.Ca.g.parse(e)}catch(o){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.u){if(n.g){if(!(n.g.F+3e3<t.F))break t;lr(n),tr(n)}ur(n),ge(18)}}else n.ta=i[1],0<n.ta-n.U&&37500>i[2]&&n.N&&0==n.A&&!n.v&&(n.v=me(P(n.ab,n),6e3));if(1>=Tn(n.i)&&n.ka){try{n.ka()}catch(o){}n.ka=void 0}}else pr(n,11)}else if((t.J||n.g==t)&&lr(n),!G(e))for(i=n.Ca.g.parse(e),e=0;e<i.length;e++){var o=i[e];if(n.U=o[0],o=o[1],2==n.G)if("c"==o[0]){n.J=o[1],n.la=o[2];var s=o[3];null!=s&&(n.ma=s,n.h.info("VER="+n.ma));var a=o[4];null!=a&&(n.za=a,n.h.info("SVER="+n.za));var u=o[5];null!=u&&"number"==typeof u&&0<u&&(n.K=r=1.5*u,n.h.info("backChannelRequestTimeoutMs_="+r)),r=n;var c=t.g;if(c){var h=c.g?c.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(h){var l=r.i;!l.g&&(H(h,"spdy")||H(h,"quic")||H(h,"h2"))&&(l.j=l.l,l.g=new Set,l.h&&(_n(l,l.h),l.h=null))}if(r.D){var f=c.g?c.g.getResponseHeader("X-HTTP-Session-Id"):null;f&&(r.sa=f,en(r.F,r.D,f))}}n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-t.F,n.h.info("Handshake RTT: "+n.O+"ms"));var d=t;if((r=n).oa=gr(r,r.H?r.la:null,r.W),d.J){On(r.i,d);var p=d,y=r.K;y&&p.setTimeout(y),p.B&&(qe(p),Me(p)),r.g=d}else ar(r);0<n.l.length&&rr(n)}else"stop"!=o[0]&&"close"!=o[0]||pr(n,7);else 3==n.G&&("stop"==o[0]||"close"==o[0]?"stop"==o[0]?pr(n,7):Zn(n):"noop"!=o[0]&&n.j&&n.j.wa(o),n.A=0)}pe(4)}catch(o){}}function Ge(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(A(t)||"string"==typeof t)U(t,e,void 0);else{if(t.T&&"function"==typeof t.T)var n=t.T();else if(t.R&&"function"==typeof t.R)n=void 0;else if(A(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.R&&"function"==typeof t.R)return t.R();if("string"==typeof t)return t.split("");if(A(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Qe(t,e){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Qe)for(n=t.T(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function ze(t){if(t.i!=t.g.length){for(var e=0,n=0;e<t.g.length;){var r=t.g[e];He(t.h,r)&&(t.g[n++]=r),e++}t.g.length=n}if(t.i!=t.g.length){var i={};for(n=e=0;e<t.g.length;)He(i,r=t.g[e])||(t.g[n++]=r,i[r]=1),e++;t.g.length=n}}function He(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(_=Ne.prototype).setTimeout=function(t){this.P=t},_.gb=function(t){t=t.target;var e=this.L;e&&3==Wn(t)?e.l():this.Ia(t)},_.Ia=function(t){try{if(t==this.g)t:{var e=Wn(this.g),n=this.g.Da(),r=this.g.ba();if(!(3>e)&&(3!=e||at||this.g&&(this.h.h||this.g.ga()||Yn(this.g)))){this.I||4!=e||7==n||pe(8==n||0>=r?3:2),qe(this);var i=this.g.ba();this.N=i;e:if(Pe(this)){var o=Yn(this.g);t="";var s=o.length,a=4==Wn(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Be(this),Ue(this);var u="";break e}this.h.i=new D.TextDecoder}for(n=0;n<s;n++)this.h.h=!0,t+=this.h.i.decode(o[n],{stream:a&&n==s-1});o.splice(0,s),this.h.g+=t,this.C=0,u=this.h.g}else u=this.g.ga();if(this.i=200==i,function(t,e,n,r,i,o,s){t.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+o+" "+s})}(this.j,this.u,this.A,this.m,this.X,e,i),this.i){if(this.$&&!this.J){e:{if(this.g){var c,h=this.g;if((c=h.g?h.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!G(c)){var l=c;break e}}l=null}if(!(i=l)){this.i=!1,this.o=3,ge(12),Be(this),Ue(this);break t}ce(this.j,this.m,i,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Ke(this,i)}this.U?(Le(this,e,u),at&&this.i&&3==e&&(se(this.V,this.W,"tick",this.fb),this.W.start())):(ce(this.j,this.m,u,null),Ke(this,u)),4==e&&Be(this),this.i&&!this.I&&(4==e?fr(this.l,this):(this.i=!1,Me(this)))}else 400==i&&0<u.indexOf("Unknown SID")?(this.o=3,ge(12)):(this.o=0,ge(13)),Be(this),Ue(this)}}}catch(e){}},_.fb=function(){if(this.g){var t=Wn(this.g),e=this.g.ga();this.C<e.length&&(qe(this),Le(this,t,e),this.i&&4!=t&&Me(this))}},_.cancel=function(){this.I=!0,Be(this)},_.eb=function(){this.B=null;var t=Date.now();0<=t-this.Y?(function(t,e){t.info(function(){return"TIMEOUT: "+e})}(this.j,this.A),2!=this.K&&(pe(3),ge(17)),Be(this),this.o=2,Ue(this)):Ve(this,this.Y-t)},(_=Qe.prototype).R=function(){ze(this);for(var t=[],e=0;e<this.g.length;e++)t.push(this.h[this.g[e]]);return t},_.T=function(){return ze(this),this.g.concat()},_.get=function(t,e){return He(this.h,t)?this.h[t]:e},_.set=function(t,e){He(this.h,t)||(this.i++,this.g.push(t)),this.h[t]=e},_.forEach=function(t,e){for(var n=this.T(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var We=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Ye(t,e){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,t instanceof Ye){this.g=void 0!==e?e:t.g,$e(this,t.j),this.s=t.s,Je(this,t.i),Ze(this,t.m),this.l=t.l,e=t.h;var n=new fn;n.i=e.i,e.g&&(n.g=new Qe(e.g),n.h=e.h),tn(this,n),this.o=t.o}else t&&(n=String(t).match(We))?(this.g=!!e,$e(this,n[1]||"",!0),this.s=rn(n[2]||""),Je(this,n[3]||"",!0),Ze(this,n[4]),this.l=rn(n[5]||"",!0),tn(this,n[6]||"",!0),this.o=rn(n[7]||"")):(this.g=!!e,this.h=new fn(null,this.g))}function Xe(t){return new Ye(t)}function $e(t,e,n){t.j=n?rn(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function Je(t,e,n){t.i=n?rn(e,!0):e}function Ze(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function tn(t,e,n){e instanceof fn?(t.h=e,function(t,e){e&&!t.j&&(dn(t),t.i=null,t.g.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(pn(this,e),gn(this,n,t))},t)),t.j=e}(t.h,t.g)):(n||(e=on(e,hn)),t.h=new fn(e,t.g))}function en(t,e,n){t.h.set(e,n)}function nn(t){return en(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function rn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function on(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,sn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function sn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Ye.prototype.toString=function(){var t=[],e=this.j;e&&t.push(on(e,an,!0),":");var n=this.i;return(n||"file"==e)&&(t.push("//"),(e=this.s)&&t.push(on(e,an,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&t.push("/"),t.push(on(n,"/"==n.charAt(0)?cn:un,!0))),(n=this.h.toString())&&t.push("?",n),(n=this.o)&&t.push("#",on(n,ln)),t.join("")};var an=/[#\/\?@]/g,un=/[#\?:]/g,cn=/[#\?]/g,hn=/[#\?@]/g,ln=/#/g;function fn(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function dn(t){t.g||(t.g=new Qe,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.i,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}function pn(t,e){dn(t),e=vn(t,e),He(t.g.h,e)&&(t.i=null,t.h-=t.g.get(e).length,He((t=t.g).h,e)&&(delete t.h[e],t.i--,t.g.length>2*t.i&&ze(t)))}function yn(t,e){return dn(t),e=vn(t,e),He(t.g.h,e)}function gn(t,e,n){pn(t,e),0<n.length&&(t.i=null,t.g.set(vn(t,e),K(n)),t.h+=n.length)}function vn(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}(_=fn.prototype).add=function(t,e){dn(this),this.i=null,t=vn(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},_.forEach=function(t,e){dn(this),this.g.forEach(function(n,r){U(n,function(n){t.call(e,n,r,this)},this)},this)},_.T=function(){dn(this);for(var t=this.g.R(),e=this.g.T(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},_.R=function(t){dn(this);var e=[];if("string"==typeof t)yn(this,t)&&(e=B(e,this.g.get(vn(this,t))));else{t=this.g.R();for(var n=0;n<t.length;n++)e=B(e,t[n])}return e},_.set=function(t,e){return dn(this),this.i=null,yn(this,t=vn(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},_.get=function(t,e){return t&&0<(t=this.R(t)).length?String(t[0]):e},_.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var t=[],e=this.g.T(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.R(r);for(var o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}}return this.i=t.join("&")};var mn=function(){return function(t,e){this.h=t,this.g=e}}();function bn(t){this.l=t||wn,t=D.PerformanceNavigationTiming?0<(t=D.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(D.g&&D.g.Ea&&D.g.Ea()&&D.g.Ea().Zb),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var wn=10;function In(t){return!!t.h||!!t.g&&t.g.size>=t.j}function Tn(t){return t.h?1:t.g?t.g.size:0}function En(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function _n(t,e){t.g?t.g.add(e):t.h=e}function On(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function Sn(t){var e,n;if(null!=t.h)return t.i.concat(t.h.D);if(null!=t.g&&0!==t.g.size){var r=t.i;try{for(var i=E(t.g.values()),o=i.next();!o.done;o=i.next())r=r.concat(o.value.D)}catch(s){e={error:s}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}return K(t.i)}function Dn(){}function Nn(){this.g=new Dn}function An(t,e,n){var r=n||"";try{Ge(t,function(t,n){var i=t;j(t)&&(i=Bt(t)),e.push(r+n+"="+encodeURIComponent(i))})}catch(Md){throw e.push(r+"type="+encodeURIComponent("_badmap")),Md}}function jn(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(o){}}function kn(t){this.l=t.$b||null,this.j=t.ib||!1}function Cn(t,e){Vt.call(this),this.D=t,this.u=e,this.m=void 0,this.readyState=xn,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}bn.prototype.cancel=function(){var t,e;if(this.i=Sn(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){try{for(var n=E(this.g.values()),r=n.next();!r.done;r=n.next())r.value.cancel()}catch(i){t={error:i}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.g.clear()}},Dn.prototype.stringify=function(t){return D.JSON.stringify(t,void 0)},Dn.prototype.parse=function(t){return D.JSON.parse(t,void 0)},F(kn,Ie),kn.prototype.g=function(){return new Cn(this.l,this.j)},kn.prototype.i=function(t){return function(){return t}}({}),F(Cn,Vt);var xn=0;function Rn(t){t.j.read().then(t.Sa.bind(t)).catch(t.ha.bind(t))}function Pn(t){t.readyState=4,t.l=null,t.j=null,t.A=null,Ln(t)}function Ln(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(_=Cn.prototype).open=function(t,e){if(this.readyState!=xn)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,Ln(this)},_.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;var e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.D||D).fetch(new Request(this.B,e)).then(this.Va.bind(this),this.ha.bind(this))},_.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Pn(this)),this.readyState=xn},_.Va=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,Ln(this)),this.g&&(this.readyState=3,Ln(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==D.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Rn(this)}else t.text().then(this.Ua.bind(this),this.ha.bind(this))},_.Sa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?Pn(this):Ln(this),3==this.readyState&&Rn(this)}},_.Ua=function(t){this.g&&(this.response=this.responseText=t,Pn(this))},_.Ta=function(t){this.g&&(this.response=t,Pn(this))},_.ha=function(){this.g&&Pn(this)},_.setRequestHeader=function(t,e){this.v.append(t,e)},_.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},_.getAllResponseHeaders=function(){if(!this.h)return"";for(var t=[],e=this.h.entries(),n=e.next();!n.done;)t.push((n=n.value)[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(Cn.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var Fn=D.JSON.parse;function Mn(t){Vt.call(this),this.headers=new Qe,this.u=t||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=Vn,this.K=this.L=!1}F(Mn,Vt);var Vn="",qn=/^https?$/i,Un=["POST","PUT"];function Bn(t){return"content-type"==t.toLowerCase()}function Kn(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,Gn(t),zn(t)}function Gn(t){t.D||(t.D=!0,qt(t,"complete"),qt(t,"error"))}function Qn(t){if(t.h&&void 0!==S&&(!t.C[1]||4!=Wn(t)||2!=t.ba()))if(t.v&&4==Wn(t))ee(t.Fa,0,t);else if(qt(t,"readystatechange"),4==Wn(t)){t.h=!1;try{var e,n=t.ba();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.H).match(We)[1]||null;if(!o&&D.self&&D.self.location){var s=D.self.location.protocol;o=s.substr(0,s.length-1)}i=!qn.test(o?o.toLowerCase():"")}e=i}if(e)qt(t,"complete"),qt(t,"success");else{t.m=6;try{var a=2<Wn(t)?t.g.statusText:""}catch(u){a=""}t.j=a+" ["+t.ba()+"]",Gn(t)}}finally{zn(t)}}}function zn(t,e){if(t.g){Hn(t);var n=t.g,r=t.C[0]?N:null;t.g=null,t.C=null,e||qt(t,"ready");try{n.onreadystatechange=r}catch(Md){}}}function Hn(t){t.g&&t.K&&(t.g.ontimeout=null),t.A&&(D.clearTimeout(t.A),t.A=null)}function Wn(t){return t.g?t.g.readyState:0}function Yn(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.J){case Vn:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(e){return null}}function Xn(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=function(t){var e="";return $(t,function(t,n){e+=n,e+=":",e+=t,e+="\r\n"}),e}(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):en(t,e,n))}function $n(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Jn(t){this.za=0,this.l=[],this.h=new ue,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=$n("failFast",!1,t),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=$n("baseRetryDelayMs",5e3,t),this.$a=$n("retryDelaySeedMs",1e4,t),this.Ya=$n("forwardChannelMaxRetries",2,t),this.ra=$n("forwardChannelRequestTimeoutMs",2e4,t),this.qa=t&&t.xmlHttpFactory||void 0,this.Ba=t&&t.Yb||!1,this.K=void 0,this.H=t&&t.supportsCrossDomainXhr||!1,this.J="",this.i=new bn(t&&t.concurrentRequestLimit),this.Ca=new Nn,this.ja=t&&t.fastHandshake||!1,this.Ra=t&&t.Wb||!1,t&&t.Aa&&this.h.Aa(),t&&t.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&t&&t.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!t||!1!==t.Xb}function Zn(t){if(er(t),3==t.G){var e=t.V++,n=Xe(t.F);en(n,"SID",t.J),en(n,"RID",e),en(n,"TYPE","terminate"),or(t,n),(e=new Ne(t,t.h,e,void 0)).K=2,e.v=nn(Xe(n)),n=!1,D.navigator&&D.navigator.sendBeacon&&(n=D.navigator.sendBeacon(e.v.toString(),"")),!n&&D.Image&&((new Image).src=e.v,n=!0),n||(e.g=vr(e.l,null),e.g.ea(e.v)),e.F=Date.now(),Me(e)}yr(t)}function tr(t){t.g&&(cr(t),t.g.cancel(),t.g=null)}function er(t){tr(t),t.u&&(D.clearTimeout(t.u),t.u=null),lr(t),t.i.cancel(),t.m&&("number"==typeof t.m&&D.clearTimeout(t.m),t.m=null)}function nr(t,e){t.l.push(new mn(t.Za++,e)),3==t.G&&rr(t)}function rr(t){In(t.i)||t.m||(t.m=!0,Yt(t.Ha,t),t.C=0)}function ir(t,e){var n;n=e?e.m:t.V++;var r=Xe(t.F);en(r,"SID",t.J),en(r,"RID",n),en(r,"AID",t.U),or(t,r),t.o&&t.s&&Xn(r,t.o,t.s),n=new Ne(t,t.h,n,t.C+1),null===t.o&&(n.H=t.s),e&&(t.l=e.D.concat(t.l)),e=sr(t,n,1e3),n.setTimeout(Math.round(.5*t.ra)+Math.round(.5*t.ra*Math.random())),_n(t.i,n),xe(n,r,e)}function or(t,e){t.j&&Ge({},function(t,n){en(e,n,t)})}function sr(t,e,n){n=Math.min(t.l.length,n);var r=t.j?P(t.j.Oa,t.j,t):null;t:for(var i=t.l,o=-1;;){var s=["count="+n];-1==o?0<n?s.push("ofs="+(o=i[0].h)):o=0:s.push("ofs="+o);for(var a=!0,u=0;u<n;u++){var c=i[u].h,h=i[u].g;if(0>(c-=o))o=Math.max(0,i[u].h-100),a=!1;else try{An(h,s,"req"+c+"_")}catch(Xr){r&&r(h)}}if(a){r=s.join("&");break t}}return t=t.l.splice(0,n),e.D=t,r}function ar(t){t.g||t.u||(t.Y=1,Yt(t.Ga,t),t.A=0)}function ur(t){return!(t.g||t.u||3<=t.A||(t.Y++,t.u=me(P(t.Ga,t),dr(t,t.A)),t.A++,0))}function cr(t){null!=t.B&&(D.clearTimeout(t.B),t.B=null)}function hr(t){t.g=new Ne(t,t.h,"rpc",t.Y),null===t.o&&(t.g.H=t.s),t.g.O=0;var e=Xe(t.oa);en(e,"RID","rpc"),en(e,"SID",t.J),en(e,"CI",t.N?"0":"1"),en(e,"AID",t.U),or(t,e),en(e,"TYPE","xmlhttp"),t.o&&t.s&&Xn(e,t.o,t.s),t.K&&t.g.setTimeout(t.K);var n=t.g;t=t.la,n.K=1,n.v=nn(Xe(e)),n.s=null,n.U=!0,Re(n,t)}function lr(t){null!=t.v&&(D.clearTimeout(t.v),t.v=null)}function fr(t,e){var n=null;if(t.g==e){lr(t),cr(t),t.g=null;var r=2}else{if(!En(t.i,e))return;n=e.D,On(t.i,e),r=1}if(t.I=e.N,0!=t.G)if(e.i)if(1==r){n=e.s?e.s.length:0,e=Date.now()-e.F;var i=t.C;qt(r=fe(),new ve(r,n,e,i)),rr(t)}else ar(t);else if(3==(i=e.o)||0==i&&0<t.I||!(1==r&&function(t,e){return!(Tn(t.i)>=t.i.j-(t.m?1:0)||(t.m?(t.l=e.D.concat(t.l),0):1==t.G||2==t.G||t.C>=(t.Xa?0:t.Ya)||(t.m=me(P(t.Ha,t,e),dr(t,t.C)),t.C++,0)))}(t,e)||2==r&&ur(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),i){case 1:pr(t,5);break;case 4:pr(t,10);break;case 3:pr(t,6);break;default:pr(t,2)}}function dr(t,e){var n=t.Pa+Math.floor(Math.random()*t.$a);return t.j||(n*=2),n*e}function pr(t,e){if(t.h.info("Error code "+e),2==e){var n=null;t.j&&(n=null);var r=P(t.jb,t);n||(n=new Ye("//www.google.com/images/cleardot.gif"),D.location&&"http"==D.location.protocol||$e(n,"https"),nn(n)),function(t,e){var n=new ue;if(D.Image){var r=new Image;r.onload=L(jn,n,r,"TestLoadImage: loaded",!0,e),r.onerror=L(jn,n,r,"TestLoadImage: error",!1,e),r.onabort=L(jn,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=L(jn,n,r,"TestLoadImage: timeout",!1,e),D.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}(n.toString(),r)}else ge(2);t.G=0,t.j&&t.j.va(e),yr(t),er(t)}function yr(t){t.G=0,t.I=-1,t.j&&(0==Sn(t.i).length&&0==t.l.length||(t.i.i.length=0,K(t.l),t.l.length=0),t.j.ua())}function gr(t,e,n){var r=function(t){return t instanceof Ye?Xe(t):new Ye(t,void 0)}(n);if(""!=r.i)e&&Je(r,e+"."+r.i),Ze(r,r.m);else{var i=D.location;r=function(t,e,n,r){var i=new Ye(null,void 0);return t&&$e(i,t),e&&Je(i,e),n&&Ze(i,n),r&&(i.l=r),i}(i.protocol,e?e+"."+i.hostname:i.hostname,+i.port,n)}return t.aa&&$(t.aa,function(t,e){en(r,e,t)}),n=t.sa,(e=t.D)&&n&&en(r,e,n),en(r,"VER",t.ma),or(t,r),r}function vr(t,e,n){if(e&&!t.H)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new Mn(n&&t.Ba&&!t.qa?new kn({ib:!0}):t.qa)).L=t.H,e}function mr(){}function br(){if(ot&&!(10<=Number(yt)))throw Error("Environmental error: no available transport.")}function wr(t,e){Vt.call(this),this.g=new Jn(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(t?t["X-WebChannel-Client-Profile"]=e.ya:t={"X-WebChannel-Client-Profile":e.ya}),this.g.P=t,(t=e&&e.httpHeadersOverwriteParam)&&!G(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!G(e)&&(this.g.D=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new Er(this)}function Ir(t){Oe.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function Tr(){Se.call(this),this.status=1}function Er(t){this.g=t}(_=Mn.prototype).ea=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+t);e=e?e.toUpperCase():"GET",this.H=t,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():Ee.g(),this.C=function(t){return t.h||(t.h=t.i())}(this.u?this.u:Ee),this.g.onreadystatechange=P(this.Fa,this);try{this.F=!0,this.g.open(e,String(t),!0),this.F=!1}catch(o){return void Kn(this,o)}t=n||"";var i=new Qe(this.headers);r&&Ge(r,function(t,e){i.set(e,t)}),r=function(t){t:{for(var e=Bn,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return 0>e?null:"string"==typeof t?t.charAt(e):t[e]}(i.T()),n=D.FormData&&t instanceof D.FormData,!(0<=q(Un,e))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(t,e){this.g.setRequestHeader(e,t)},this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Hn(this),0<this.B&&((this.K=function(t){return ot&&function(){return t=pt,Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=function(){for(var t=0,e=z(String(nt)).split("."),n=z("9").split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",s=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==o[0].length&&0==s[0].length)break;t=W(0==o[1].length?0:parseInt(o[1],10),0==s[1].length?0:parseInt(s[1],10))||W(0==o[2].length,0==s[2].length)||W(o[2],s[2]),o=o[3],s=s[3]}while(0==t)}return 0<=t}();var t}()&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=P(this.pa,this)):this.A=ee(this.pa,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(o){Kn(this,o)}},_.pa=function(){void 0!==S&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,qt(this,"timeout"),this.abort(8))},_.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,qt(this,"complete"),qt(this,"abort"),zn(this))},_.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),zn(this,!0)),Mn.Z.M.call(this)},_.Fa=function(){this.s||(this.F||this.v||this.l?Qn(this):this.cb())},_.cb=function(){Qn(this)},_.ba=function(){try{return 2<Wn(this)?this.g.status:-1}catch(rt){return-1}},_.ga=function(){try{return this.g?this.g.responseText:""}catch(rt){return""}},_.Qa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Fn(e)}},_.Da=function(){return this.m},_.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(_=Jn.prototype).ma=8,_.G=1,_.hb=function(t){try{this.h.info("Origin Trials invoked: "+t)}catch(e){}},_.Ha=function(t){if(this.m)if(this.m=null,1==this.G){if(!t){this.V=Math.floor(1e5*Math.random()),t=this.V++;var e=new Ne(this,this.h,t,void 0),n=this.s;if(this.P&&(n?tt(n=J(n),this.P):n=this.P),null===this.o&&(e.H=n),this.ja)t:{for(var r=0,i=0;i<this.l.length;i++){var o=this.l[i];if(void 0===(o="__data__"in o.g&&"string"==typeof(o=o.g.__data__)?o.length:void 0))break;if(4096<(r+=o)){r=i;break t}if(4096===r||i===this.l.length-1){r=i+1;break t}}r=1e3}else r=1e3;r=sr(this,e,r),en(i=Xe(this.F),"RID",t),en(i,"CVER",22),this.D&&en(i,"X-HTTP-Session-Id",this.D),or(this,i),this.o&&n&&Xn(i,this.o,n),_n(this.i,e),this.Ra&&en(i,"TYPE","init"),this.ja?(en(i,"$req",r),en(i,"SID","null"),e.$=!0,xe(e,i,null)):xe(e,i,r),this.G=2}}else 3==this.G&&(t?ir(this,t):0==this.l.length||In(this.i)||ir(this))},_.Ga=function(){if(this.u=null,hr(this),this.$&&!(this.L||null==this.g||0>=this.O)){var t=2*this.O;this.h.info("BP detection timer enabled: "+t),this.B=me(P(this.bb,this),t)}},_.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,ge(10),tr(this),hr(this))},_.ab=function(){null!=this.v&&(this.v=null,tr(this),ur(this),ge(19))},_.jb=function(t){t?(this.h.info("Successfully pinged google.com"),ge(2)):(this.h.info("Failed to ping google.com"),ge(1))},(_=mr.prototype).xa=function(){},_.wa=function(){},_.va=function(){},_.ua=function(){},_.Oa=function(){},br.prototype.g=function(t,e){return new wr(t,e)},F(wr,Vt),wr.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var t=this.g,e=this.l,n=this.h||void 0;t.Wa&&(t.h.info("Origin Trials enabled."),Yt(P(t.hb,t,e))),ge(0),t.W=e,t.aa=n||{},t.N=t.X,t.F=gr(t,null,t.W),rr(t)},wr.prototype.close=function(){Zn(this.g)},wr.prototype.u=function(t){if("string"==typeof t){var e={};e.__data__=t,nr(this.g,e)}else this.v?((e={}).__data__=Bt(t),nr(this.g,e)):nr(this.g,t)},wr.prototype.M=function(){this.g.j=null,delete this.j,Zn(this.g),delete this.g,wr.Z.M.call(this)},F(Ir,Oe),F(Tr,Se),F(Er,mr),Er.prototype.xa=function(){qt(this.g,"a")},Er.prototype.wa=function(t){qt(this.g,new Ir(t))},Er.prototype.va=function(t){qt(this.g,new Tr(t))},Er.prototype.ua=function(){qt(this.g,"b")},br.prototype.createWebChannel=br.prototype.g,wr.prototype.send=wr.prototype.u,wr.prototype.open=wr.prototype.m,wr.prototype.close=wr.prototype.close,be.NO_ERROR=0,be.TIMEOUT=8,be.HTTP_ERROR=6,we.COMPLETE="complete",Te.EventType=_e,_e.OPEN="a",_e.CLOSE="b",_e.ERROR="c",_e.MESSAGE="d",Vt.prototype.listen=Vt.prototype.N,Mn.prototype.listenOnce=Mn.prototype.O,Mn.prototype.getLastError=Mn.prototype.La,Mn.prototype.getLastErrorCode=Mn.prototype.Da,Mn.prototype.getStatus=Mn.prototype.ba,Mn.prototype.getResponseJson=Mn.prototype.Qa,Mn.prototype.getResponseText=Mn.prototype.ga,Mn.prototype.send=Mn.prototype.ea;var _r=be,Or=we,Sr=he,Dr=kn,Nr=Te,Ar=Mn,jr=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.t(t)},this.i=function(t){return e.writeSequenceNumber(t)})}return t.prototype.t=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.i&&this.i(t),t},t}();jr.o=-1;var kr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Cr=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).code=e,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return Object(b.c)(e,t),e}(Error),xr=new I.b("@firebase/firestore");function Rr(){return xr.logLevel}function Pr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(xr.logLevel<=I.a.DEBUG){var r=e.map(Mr);xr.debug.apply(xr,Object(b.f)(["Firestore (8.8.0): "+t],r))}}function Lr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(xr.logLevel<=I.a.ERROR){var r=e.map(Mr);xr.error.apply(xr,Object(b.f)(["Firestore (8.8.0): "+t],r))}}function Fr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(xr.logLevel<=I.a.WARN){var r=e.map(Mr);xr.warn.apply(xr,Object(b.f)(["Firestore (8.8.0): "+t],r))}}function Mr(t){if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(Md){return t}}function Vr(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE (8.8.0) INTERNAL ASSERTION FAILED: "+t;throw Lr(e),new Error(e)}function qr(t,e){t||Vr()}function Ur(t,e){return t}function Br(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}var Kr=function(){function t(){}return t.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=Br(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},t}();function Gr(t,e){return t<e?-1:t>e?1:0}function Qr(t,e,n){return t.length===e.length&&t.every(function(t,r){return n(t,e[r])})}function zr(t){return t+"\0"}var Hr=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new Cr(kr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new Cr(kr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Cr(kr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Cr(kr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,Math.floor(1e6*(e-1e3*n)))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype._compareTo=function(t){return this.seconds===t.seconds?Gr(this.nanoseconds,t.nanoseconds):Gr(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},t.prototype.valueOf=function(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},t}(),Wr=function(){function t(t){this.timestamp=t}return t.fromTimestamp=function(e){return new t(e)},t.min=function(){return new t(new Hr(0,0))},t.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.toTimestamp=function(){return this.timestamp},t}();function Yr(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Xr(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function $r(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var Jr=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&Vr(),void 0===n?n=t.length-e:n>t.length-e&&Vr(),this.segments=t,this.offset=e,this.len=n}return Object.defineProperty(t.prototype,"length",{get:function(){return this.len},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.comparator(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach(function(t){n.push(t)}):n.push(e),this.construct(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.popFirst=function(t){return this.construct(this.segments,this.offset+(t=void 0===t?1:t),this.length-t)},t.prototype.popLast=function(){return this.construct(this.segments,this.offset,this.length-1)},t.prototype.firstSegment=function(){return this.segments[this.offset]},t.prototype.lastSegment=function(){return this.get(this.length-1)},t.prototype.get=function(t){return this.segments[this.offset+t]},t.prototype.isEmpty=function(){return 0===this.length},t.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},t.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),Zr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(b.c)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.prototype.canonicalString=function(){return this.toArray().join("/")},e.prototype.toString=function(){return this.canonicalString()},e.fromString=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=[],i=0,o=t;i<o.length;i++){var s=o[i];if(s.indexOf("//")>=0)throw new Cr(kr.INVALID_ARGUMENT,"Invalid segment ("+s+"). Paths must not contain // in them.");r.push.apply(r,s.split("/").filter(function(t){return t.length>0}))}return new e(r)},e.emptyPath=function(){return new e([])},e}(Jr),ti=/^[_a-zA-Z][_a-zA-Z0-9]*$/,ei=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(b.c)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.isValidIdentifier=function(t){return ti.test(t)},e.prototype.canonicalString=function(){return this.toArray().map(function(t){return t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e.isValidIdentifier(t)||(t="`"+t+"`"),t}).join(".")},e.prototype.toString=function(){return this.canonicalString()},e.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},e.keyField=function(){return new e(["__name__"])},e.fromServerFormat=function(t){for(var n=[],r="",i=0,o=function(){if(0===r.length)throw new Cr(kr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");n.push(r),r=""},s=!1;i<t.length;){var a=t[i];if("\\"===a){if(i+1===t.length)throw new Cr(kr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new Cr(kr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=u,i+=2}else"`"===a?(s=!s,i++):"."!==a||s?(r+=a,i++):(o(),i++)}if(o(),s)throw new Cr(kr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new e(n)},e.emptyPath=function(){return new e([])},e}(Jr),ni=function(){function t(t){this.fields=t,t.sort(ei.comparator)}return t.prototype.covers=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].isPrefixOf(t))return!0;return!1},t.prototype.isEqual=function(t){return Qr(this.fields,t.fields,function(t,e){return t.isEqual(e)})},t}(),ri=function(){function t(t){this.binaryString=t}return t.fromBase64String=function(e){return new t(atob(e))},t.fromUint8Array=function(e){return new t(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(e))},t.prototype.toBase64=function(){return btoa(this.binaryString)},t.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)},t.prototype.approximateByteSize=function(){return 2*this.binaryString.length},t.prototype.compareTo=function(t){return Gr(this.binaryString,t.binaryString)},t.prototype.isEqual=function(t){return this.binaryString===t.binaryString},t}();ri.EMPTY_BYTE_STRING=new ri("");var ii=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function oi(t){if(qr(!!t),"string"==typeof t){var e=0,n=ii.exec(t);if(qr(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:si(t.seconds),nanos:si(t.nanos)}}function si(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function ai(t){return"string"==typeof t?ri.fromBase64String(t):ri.fromUint8Array(t)}function ui(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function ci(t){var e=t.mapValue.fields.__previous_value__;return ui(e)?ci(e):e}function hi(t){var e=oi(t.mapValue.fields.__local_write_time__.timestampValue);return new Hr(e.seconds,e.nanos)}function li(t){return null==t}function fi(t){return 0===t&&1/t==-1/0}function di(t){return"number"==typeof t&&Number.isInteger(t)&&!fi(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var pi=function(){function t(t){this.path=t}return t.fromPath=function(e){return new t(Zr.fromString(e))},t.fromName=function(e){return new t(Zr.fromString(e).popFirst(5))},t.prototype.hasCollectionId=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===Zr.comparator(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.comparator=function(t,e){return Zr.comparator(t.path,e.path)},t.isDocumentKey=function(t){return t.length%2==0},t.fromSegments=function(e){return new t(new Zr(e.slice()))},t}();function yi(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?ui(t)?4:10:Vr()}function gi(t,e){var n=yi(t);if(n!==yi(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return hi(t).isEqual(hi(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=oi(t.timestampValue),r=oi(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return ai(t.bytesValue).isEqual(ai(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return si(t.geoPointValue.latitude)===si(e.geoPointValue.latitude)&&si(t.geoPointValue.longitude)===si(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return si(t.integerValue)===si(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=si(t.doubleValue),r=si(e.doubleValue);return n===r?fi(n)===fi(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return Qr(t.arrayValue.values||[],e.arrayValue.values||[],gi);case 10:return function(t,e){var n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(Yr(n)!==Yr(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!gi(n[i],r[i])))return!1;return!0}(t,e);default:return Vr()}}function vi(t,e){return void 0!==(t.values||[]).find(function(t){return gi(t,e)})}function mi(t,e){var n=yi(t),r=yi(e);if(n!==r)return Gr(n,r);switch(n){case 0:return 0;case 1:return Gr(t.booleanValue,e.booleanValue);case 2:return function(t,e){var n=si(t.integerValue||t.doubleValue),r=si(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return bi(t.timestampValue,e.timestampValue);case 4:return bi(hi(t),hi(e));case 5:return Gr(t.stringValue,e.stringValue);case 6:return function(t,e){var n=ai(t),r=ai(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=Gr(n[i],r[i]);if(0!==o)return o}return Gr(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){var n=Gr(si(t.latitude),si(e.latitude));return 0!==n?n:Gr(si(t.longitude),si(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=mi(n[i],r[i]);if(o)return o}return Gr(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var a=Gr(r[s],o[s]);if(0!==a)return a;var u=mi(n[r[s]],i[o[s]]);if(0!==u)return u}return Gr(r.length,o.length)}(t.mapValue,e.mapValue);default:throw Vr()}}function bi(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Gr(t,e);var n=oi(t),r=oi(e),i=Gr(n.seconds,r.seconds);return 0!==i?i:Gr(n.nanos,r.nanos)}function wi(t){return Ii(t)}function Ii(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){var e=oi(t);return"time("+e.seconds+","+e.nanos+")"}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?ai(t.bytesValue).toBase64():"referenceValue"in t?pi.fromName(t.referenceValue).toString():"geoPointValue"in t?"geo("+(e=t.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in t?function(t){for(var e="[",n=!0,r=0,i=t.values||[];r<i.length;r++)n?n=!1:e+=",",e+=Ii(i[r]);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+Ii(t.fields[o])}return e+"}"}(t.mapValue):Vr();var e}function Ti(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.canonicalString()}}function Ei(t){return!!t&&"integerValue"in t}function _i(t){return!!t&&"arrayValue"in t}function Oi(t){return!!t&&"nullValue"in t}function Si(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Di(t){return!!t&&"mapValue"in t}function Ni(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){var e={mapValue:{fields:{}}};return Xr(t.mapValue.fields,function(t,n){return e.mapValue.fields[t]=Ni(n)}),e}if(t.arrayValue){for(var n={arrayValue:{values:[]}},r=0;r<(t.arrayValue.values||[]).length;++r)n.arrayValue.values[r]=Ni(t.arrayValue.values[r]);return n}return Object.assign({},t)}var Ai=function(){function t(t){this.value=t}return t.empty=function(){return new t({mapValue:{}})},t.prototype.field=function(t){if(t.isEmpty())return this.value;for(var e=this.value,n=0;n<t.length-1;++n)if(!Di(e=(e.mapValue.fields||{})[t.get(n)]))return null;return(e=(e.mapValue.fields||{})[t.lastSegment()])||null},t.prototype.set=function(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Ni(e)},t.prototype.setAll=function(t){var e=this,n=ei.emptyPath(),r={},i=[];t.forEach(function(t,o){if(!n.isImmediateParentOf(o)){var s=e.getFieldsMap(n);e.applyChanges(s,r,i),r={},i=[],n=o.popLast()}t?r[o.lastSegment()]=Ni(t):i.push(o.lastSegment())});var o=this.getFieldsMap(n);this.applyChanges(o,r,i)},t.prototype.delete=function(t){var e=this.field(t.popLast());Di(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]},t.prototype.isEqual=function(t){return gi(this.value,t.value)},t.prototype.getFieldsMap=function(t){var e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(var n=0;n<t.length;++n){var r=e.mapValue.fields[t.get(n)];Di(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields},t.prototype.applyChanges=function(t,e,n){Xr(e,function(e,n){return t[e]=n});for(var r=0,i=n;r<i.length;r++)delete t[i[r]]},t.prototype.clone=function(){return new t(Ni(this.value))},t}();function ji(t){var e=[];return Xr(t.fields,function(t,n){var r=new ei([t]);if(Di(n)){var i=ji(n.mapValue).fields;if(0===i.length)e.push(r);else for(var o=0,s=i;o<s.length;o++)e.push(r.child(s[o]))}else e.push(r)}),new ni(e)}var ki=function(){function t(t,e,n,r,i){this.key=t,this.documentType=e,this.version=n,this.data=r,this.documentState=i}return t.newInvalidDocument=function(e){return new t(e,0,Wr.min(),Ai.empty(),0)},t.newFoundDocument=function(e,n,r){return new t(e,1,n,r,0)},t.newNoDocument=function(e,n){return new t(e,2,n,Ai.empty(),0)},t.newUnknownDocument=function(e,n){return new t(e,3,n,Ai.empty(),2)},t.prototype.convertToFoundDocument=function(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this},t.prototype.convertToNoDocument=function(t){return this.version=t,this.documentType=2,this.data=Ai.empty(),this.documentState=0,this},t.prototype.convertToUnknownDocument=function(t){return this.version=t,this.documentType=3,this.data=Ai.empty(),this.documentState=2,this},t.prototype.setHasCommittedMutations=function(){return this.documentState=2,this},t.prototype.setHasLocalMutations=function(){return this.documentState=1,this},Object.defineProperty(t.prototype,"hasLocalMutations",{get:function(){return 1===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasCommittedMutations",{get:function(){return 2===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!1,configurable:!0}),t.prototype.isValidDocument=function(){return 0!==this.documentType},t.prototype.isFoundDocument=function(){return 1===this.documentType},t.prototype.isNoDocument=function(){return 2===this.documentType},t.prototype.isUnknownDocument=function(){return 3===this.documentType},t.prototype.isEqual=function(e){return e instanceof t&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)},t.prototype.clone=function(){return new t(this.key,this.documentType,this.version,this.data.clone(),this.documentState)},t.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+JSON.stringify(this.data.value)+", {documentType: "+this.documentType+"}), {documentState: "+this.documentState+"})"},t}(),Ci=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.h=null};function xi(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new Ci(t,e,n,r,i,o,s)}function Ri(t){var e=Ur(t);if(null===e.h){var n=e.path.canonicalString();null!==e.collectionGroup&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(function(t){return function(t){return t.field.canonicalString()+t.op.toString()+wi(t.value)}(t)}).join(","),n+="|ob:",n+=e.orderBy.map(function(t){return function(t){return t.field.canonicalString()+t.dir}(t)}).join(","),li(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=Hi(e.startAt)),e.endAt&&(n+="|ub:",n+=Hi(e.endAt)),e.h=n}return e.h}function Pi(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n=0;n<t.orderBy.length;n++)if(!Yi(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(var r=0;r<t.filters.length;r++)if((i=t.filters[r]).op!==(o=e.filters[r]).op||!i.field.isEqual(o.field)||!gi(i.value,o.value))return!1;var i,o;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!$i(t.startAt,e.startAt)&&$i(t.endAt,e.endAt)}function Li(t){return pi.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}var Fi=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).field=e,i.op=n,i.value=r,i}return Object(b.c)(e,t),e.create=function(t,n,r){return t.isKeyField()?"in"===n||"not-in"===n?this.l(t,n,r):new Mi(t,n,r):"array-contains"===n?new Bi(t,r):"in"===n?new Ki(t,r):"not-in"===n?new Gi(t,r):"array-contains-any"===n?new Qi(t,r):new e(t,n,r)},e.l=function(t,e,n){return"in"===e?new Vi(t,n):new qi(t,n)},e.prototype.matches=function(t){var e=t.data.field(this.field);return"!="===this.op?null!==e&&this.m(mi(e,this.value)):null!==e&&yi(this.value)===yi(e)&&this.m(mi(e,this.value))},e.prototype.m=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return Vr()}},e.prototype.g=function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0},e}(function(){}),Mi=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,r)||this).key=pi.fromName(r.referenceValue),i}return Object(b.c)(e,t),e.prototype.matches=function(t){var e=pi.comparator(t.key,this.key);return this.m(e)},e}(Fi),Vi=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"in",n)||this).keys=Ui(0,n),r}return Object(b.c)(e,t),e.prototype.matches=function(t){return this.keys.some(function(e){return e.isEqual(t.key)})},e}(Fi),qi=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"not-in",n)||this).keys=Ui(0,n),r}return Object(b.c)(e,t),e.prototype.matches=function(t){return!this.keys.some(function(e){return e.isEqual(t.key)})},e}(Fi);function Ui(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map(function(t){return pi.fromName(t.referenceValue)})}var Bi=function(t){function e(e,n){return t.call(this,e,"array-contains",n)||this}return Object(b.c)(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return _i(e)&&vi(e.arrayValue,this.value)},e}(Fi),Ki=function(t){function e(e,n){return t.call(this,e,"in",n)||this}return Object(b.c)(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return null!==e&&vi(this.value.arrayValue,e)},e}(Fi),Gi=function(t){function e(e,n){return t.call(this,e,"not-in",n)||this}return Object(b.c)(e,t),e.prototype.matches=function(t){if(vi(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var e=t.data.field(this.field);return null!==e&&!vi(this.value.arrayValue,e)},e}(Fi),Qi=function(t){function e(e,n){return t.call(this,e,"array-contains-any",n)||this}return Object(b.c)(e,t),e.prototype.matches=function(t){var e=this,n=t.data.field(this.field);return!(!_i(n)||!n.arrayValue.values)&&n.arrayValue.values.some(function(t){return vi(e.value.arrayValue,t)})},e}(Fi),zi=function(t,e){this.position=t,this.before=e};function Hi(t){return(t.before?"b":"a")+":"+t.position.map(function(t){return wi(t)}).join(",")}var Wi=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function Yi(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function Xi(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i];if(r=o.field.isKeyField()?pi.comparator(pi.fromName(s.referenceValue),n.key):mi(s,n.data.field(o.field)),"desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function $i(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!gi(t.position[n],e.position[n]))return!1;return!0}var Ji=function(t,e,n,r,i,o,s,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=a,this.p=null,this.T=null};function Zi(t,e,n,r,i,o,s,a){return new Ji(t,e,n,r,i,o,s,a)}function to(t){return new Ji(t)}function eo(t){return!li(t.limit)&&"F"===t.limitType}function no(t){return!li(t.limit)&&"L"===t.limitType}function ro(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function io(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.g())return r.field}return null}function oo(t){return null!==t.collectionGroup}function so(t){var e=Ur(t);if(null===e.p){e.p=[];var n=io(e),r=ro(e);if(null!==n&&null===r)n.isKeyField()||e.p.push(new Wi(n)),e.p.push(new Wi(ei.keyField(),"asc"));else{for(var i=!1,o=0,s=e.explicitOrderBy;o<s.length;o++){var a=s[o];e.p.push(a),a.field.isKeyField()&&(i=!0)}if(!i){var u=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.p.push(new Wi(ei.keyField(),u))}}}return e.p}function ao(t){var e=Ur(t);if(!e.T)if("F"===e.limitType)e.T=xi(e.path,e.collectionGroup,so(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=so(e);r<i.length;r++){var o=i[r];n.push(new Wi(o.field,"desc"===o.dir?"asc":"desc"))}var s=e.endAt?new zi(e.endAt.position,!e.endAt.before):null,a=e.startAt?new zi(e.startAt.position,!e.startAt.before):null;e.T=xi(e.path,e.collectionGroup,n,e.filters,e.limit,s,a)}return e.T}function uo(t,e,n){return new Ji(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function co(t,e){return Pi(ao(t),ao(e))&&t.limitType===e.limitType}function ho(t){return Ri(ao(t))+"|lt:"+t.limitType}function lo(t){return"Query(target="+function(t){var e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=", filters: ["+t.filters.map(function(t){return(e=t).field.canonicalString()+" "+e.op+" "+wi(e.value);var e}).join(", ")+"]"),li(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=", orderBy: ["+t.orderBy.map(function(t){return function(t){return t.field.canonicalString()+" ("+t.dir+")"}(t)}).join(", ")+"]"),t.startAt&&(e+=", startAt: "+Hi(t.startAt)),t.endAt&&(e+=", endAt: "+Hi(t.endAt)),"Target("+e+")"}(ao(t))+"; limitType="+t.limitType+")"}function fo(t,e){return e.isFoundDocument()&&function(t,e){var n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):pi.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(var n=0,r=t.explicitOrderBy;n<r.length;n++){var i=r[n];if(!i.field.isKeyField()&&null===e.data.field(i.field))return!1}return!0}(t,e)&&function(t,e){for(var n=0,r=t.filters;n<r.length;n++)if(!r[n].matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!Xi(t.startAt,so(t),e)||t.endAt&&Xi(t.endAt,so(t),e))}(t,e)}function po(t){return function(e,n){for(var r=!1,i=0,o=so(t);i<o.length;i++){var s=o[i],a=yo(s,e,n);if(0!==a)return a;r=r||s.field.isKeyField()}return 0}}function yo(t,e,n){var r=t.field.isKeyField()?pi.comparator(e.key,n.key):function(t,e,n){var r=e.data.field(t),i=n.data.field(t);return null!==r&&null!==i?mi(r,i):Vr()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Vr()}}function go(t,e){if(t.I){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:fi(e)?"-0":e}}function vo(t){return{integerValue:""+t}}function mo(t,e){return di(e)?vo(e):go(t,e)}var bo=function(){this._=void 0};function wo(t,e,n){return t instanceof Eo?function(t,e){var n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof _o?Oo(t,e):t instanceof So?Do(t,e):function(t,e){var n=To(t,e),r=Ao(n)+Ao(t.A);return Ei(n)&&Ei(t.A)?vo(r):go(t.R,r)}(t,e)}function Io(t,e,n){return t instanceof _o?Oo(t,e):t instanceof So?Do(t,e):n}function To(t,e){return t instanceof No?Ei(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}var Eo=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(b.c)(e,t),e}(bo),_o=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return Object(b.c)(e,t),e}(bo);function Oo(t,e){for(var n=jo(e),r=function(t){n.some(function(e){return gi(e,t)})||n.push(t)},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var So=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return Object(b.c)(e,t),e}(bo);function Do(t,e){for(var n=jo(e),r=function(t){n=n.filter(function(e){return!gi(e,t)})},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var No=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).R=e,r.A=n,r}return Object(b.c)(e,t),e}(bo);function Ao(t){return si(t.integerValue||t.doubleValue)}function jo(t){return _i(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var ko=function(t,e){this.field=t,this.transform=e},Co=function(t,e){this.version=t,this.transformResults=e},xo=function(){function t(t,e){this.updateTime=t,this.exists=e}return t.none=function(){return new t},t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},t}();function Ro(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}var Po=function(){};function Lo(t,e,n){t instanceof Uo?function(t,e,n){var r=t.value.clone(),i=Go(t.fieldTransforms,e,n.transformResults);r.setAll(i),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof Bo?function(t,e,n){if(Ro(t.precondition,e)){var r=Go(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(Ko(t)),i.setAll(r),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}else e.convertToUnknownDocument(n.version)}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function Fo(t,e,n){t instanceof Uo?function(t,e,n){if(Ro(t.precondition,e)){var r=t.value.clone(),i=Qo(t.fieldTransforms,n,e);r.setAll(i),e.convertToFoundDocument(qo(e),r).setHasLocalMutations()}}(t,e,n):t instanceof Bo?function(t,e,n){if(Ro(t.precondition,e)){var r=Qo(t.fieldTransforms,n,e),i=e.data;i.setAll(Ko(t)),i.setAll(r),e.convertToFoundDocument(qo(e),i).setHasLocalMutations()}}(t,e,n):function(t,e){Ro(t.precondition,e)&&e.convertToNoDocument(Wr.min())}(t,e)}function Mo(t,e){for(var n=null,r=0,i=t.fieldTransforms;r<i.length;r++){var o=i[r],s=e.data.field(o.field),a=To(o.transform,s||null);null!=a&&(null==n&&(n=Ai.empty()),n.set(o.field,a))}return n||null}function Vo(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&Qr(t,e,function(t,e){return function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof _o&&e instanceof _o||t instanceof So&&e instanceof So?Qr(t.elements,e.elements,gi):t instanceof No&&e instanceof No?gi(t.A,e.A):t instanceof Eo&&e instanceof Eo}(t.transform,e.transform)}(t,e)})}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}function qo(t){return t.isFoundDocument()?t.version:Wr.min()}var Uo=function(t){function e(e,n,r,i){void 0===i&&(i=[]);var o=this;return(o=t.call(this)||this).key=e,o.value=n,o.precondition=r,o.fieldTransforms=i,o.type=0,o}return Object(b.c)(e,t),e}(Po),Bo=function(t){function e(e,n,r,i,o){void 0===o&&(o=[]);var s=this;return(s=t.call(this)||this).key=e,s.data=n,s.fieldMask=r,s.precondition=i,s.fieldTransforms=o,s.type=1,s}return Object(b.c)(e,t),e}(Po);function Ko(t){var e=new Map;return t.fieldMask.fields.forEach(function(n){if(!n.isEmpty()){var r=t.data.field(n);e.set(n,r)}}),e}function Go(t,e,n){var r=new Map;qr(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,a=e.data.field(o.field);r.set(o.field,Io(s,a,n[i]))}return r}function Qo(t,e,n){for(var r=new Map,i=0,o=t;i<o.length;i++){var s=o[i],a=s.transform,u=n.data.field(s.field);r.set(s.field,wo(a,u,e))}return r}var zo,Ho,Wo=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=2,r.fieldTransforms=[],r}return Object(b.c)(e,t),e}(Po),Yo=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=3,r.fieldTransforms=[],r}return Object(b.c)(e,t),e}(Po),Xo=function(t){this.count=t};function $o(t){switch(t){case kr.OK:return Vr();case kr.CANCELLED:case kr.UNKNOWN:case kr.DEADLINE_EXCEEDED:case kr.RESOURCE_EXHAUSTED:case kr.INTERNAL:case kr.UNAVAILABLE:case kr.UNAUTHENTICATED:return!1;case kr.INVALID_ARGUMENT:case kr.NOT_FOUND:case kr.ALREADY_EXISTS:case kr.PERMISSION_DENIED:case kr.FAILED_PRECONDITION:case kr.ABORTED:case kr.OUT_OF_RANGE:case kr.UNIMPLEMENTED:case kr.DATA_LOSS:return!0;default:return Vr()}}function Jo(t){if(void 0===t)return Lr("GRPC error has no .code"),kr.UNKNOWN;switch(t){case zo.OK:return kr.OK;case zo.CANCELLED:return kr.CANCELLED;case zo.UNKNOWN:return kr.UNKNOWN;case zo.DEADLINE_EXCEEDED:return kr.DEADLINE_EXCEEDED;case zo.RESOURCE_EXHAUSTED:return kr.RESOURCE_EXHAUSTED;case zo.INTERNAL:return kr.INTERNAL;case zo.UNAVAILABLE:return kr.UNAVAILABLE;case zo.UNAUTHENTICATED:return kr.UNAUTHENTICATED;case zo.INVALID_ARGUMENT:return kr.INVALID_ARGUMENT;case zo.NOT_FOUND:return kr.NOT_FOUND;case zo.ALREADY_EXISTS:return kr.ALREADY_EXISTS;case zo.PERMISSION_DENIED:return kr.PERMISSION_DENIED;case zo.FAILED_PRECONDITION:return kr.FAILED_PRECONDITION;case zo.ABORTED:return kr.ABORTED;case zo.OUT_OF_RANGE:return kr.OUT_OF_RANGE;case zo.UNIMPLEMENTED:return kr.UNIMPLEMENTED;case zo.DATA_LOSS:return kr.DATA_LOSS;default:return Vr()}}(Ho=zo||(zo={}))[Ho.OK=0]="OK",Ho[Ho.CANCELLED=1]="CANCELLED",Ho[Ho.UNKNOWN=2]="UNKNOWN",Ho[Ho.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ho[Ho.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ho[Ho.NOT_FOUND=5]="NOT_FOUND",Ho[Ho.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ho[Ho.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ho[Ho.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ho[Ho.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ho[Ho.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ho[Ho.ABORTED=10]="ABORTED",Ho[Ho.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ho[Ho.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ho[Ho.INTERNAL=13]="INTERNAL",Ho[Ho.UNAVAILABLE=14]="UNAVAILABLE",Ho[Ho.DATA_LOSS=15]="DATA_LOSS";var Zo=function(){function t(t,e){this.comparator=t,this.root=e||es.EMPTY}return t.prototype.insert=function(e,n){return new t(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,es.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator,this.root.remove(e,this.comparator).copy(null,null,es.BLACK,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),t.prototype.minKey=function(){return this.root.minKey()},t.prototype.maxKey=function(){return this.root.maxKey()},t.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},t.prototype.forEach=function(t){this.inorderTraversal(function(e,n){return t(e,n),!1})},t.prototype.toString=function(){var t=[];return this.inorderTraversal(function(e,n){return t.push(e+":"+n),!1}),"{"+t.join(", ")+"}"},t.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},t.prototype.getIterator=function(){return new ts(this.root,null,this.comparator,!1)},t.prototype.getIteratorFrom=function(t){return new ts(this.root,t,this.comparator,!1)},t.prototype.getReverseIterator=function(){return new ts(this.root,null,this.comparator,!0)},t.prototype.getReverseIteratorFrom=function(t){return new ts(this.root,t,this.comparator,!0)},t}(),ts=function(){function t(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return t.prototype.getNext=function(){var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},t.prototype.hasNext=function(){return this.nodeStack.length>0},t.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},t}(),es=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},t.prototype.minKey=function(){return this.min().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},t.prototype.removeMin=function(){if(this.left.isEmpty())return t.EMPTY;var e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(e,i.key)){if(i.right.isEmpty())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()},t.prototype.isRed=function(){return this.color},t.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},t.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},t.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},t.prototype.rotateLeft=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},t.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw Vr();if(this.right.isRed())throw Vr();var t=this.left.check();if(t!==this.right.check())throw Vr();return t+(this.isRed()?0:1)},t}();es.EMPTY=null,es.RED=!0,es.BLACK=!1,es.EMPTY=new(function(){function t(){this.size=0}return Object.defineProperty(t.prototype,"key",{get:function(){throw Vr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){throw Vr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){throw Vr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){throw Vr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){throw Vr()},enumerable:!1,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new es(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.isRed=function(){return!1},t.prototype.checkMaxDepth=function(){return!0},t.prototype.check=function(){return 0},t}());var ns=function(){function t(t){this.comparator=t,this.data=new Zo(this.comparator)}return t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.minKey()},t.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.inorderTraversal(function(e,n){return t(e),!1})},t.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}},t.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},t.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},t.prototype.getIterator=function(){return new rs(this.data.getIterator())},t.prototype.getIteratorFrom=function(t){return new rs(this.data.getIteratorFrom(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.isEmpty=function(){return this.data.isEmpty()},t.prototype.unionWith=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.getIterator(),r=e.data.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(0!==this.comparator(i,o))return!1}return!0},t.prototype.toArray=function(){var t=[];return this.forEach(function(e){t.push(e)}),t},t.prototype.toString=function(){var t=[];return this.forEach(function(e){return t.push(e)}),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.comparator);return n.data=e,n},t}(),rs=function(){function t(t){this.iter=t}return t.prototype.getNext=function(){return this.iter.getNext().key},t.prototype.hasNext=function(){return this.iter.hasNext()},t}(),is=new Zo(pi.comparator);function os(){return is}var ss=new Zo(pi.comparator);function as(){return ss}var us=new Zo(pi.comparator);function cs(){return us}var hs=new ns(pi.comparator);function ls(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=hs,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var fs=new ns(Gr);function ds(){return fs}var ps=function(){function t(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}return t.createSynthesizedRemoteEventForCurrentChange=function(e,n){var r=new Map;return r.set(e,ys.createSynthesizedTargetChangeForCurrentChange(e,n)),new t(Wr.min(),r,ds(),os(),ls())},t}(),ys=function(){function t(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}return t.createSynthesizedTargetChangeForCurrentChange=function(e,n){return new t(ri.EMPTY_BYTE_STRING,n,ls(),ls(),ls())},t}(),gs=function(t,e,n,r){this.v=t,this.removedTargetIds=e,this.key=n,this.P=r},vs=function(t,e){this.targetId=t,this.V=e},ms=function(t,e,n,r){void 0===n&&(n=ri.EMPTY_BYTE_STRING),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},bs=function(){function t(){this.S=0,this.D=Ts(),this.C=ri.EMPTY_BYTE_STRING,this.N=!1,this.F=!0}return Object.defineProperty(t.prototype,"current",{get:function(){return this.N},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this.C},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"k",{get:function(){return 0!==this.S},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"$",{get:function(){return this.F},enumerable:!1,configurable:!0}),t.prototype.O=function(t){t.approximateByteSize()>0&&(this.F=!0,this.C=t)},t.prototype.M=function(){var t=ls(),e=ls(),n=ls();return this.D.forEach(function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:Vr()}}),new ys(this.C,this.N,t,e,n)},t.prototype.L=function(){this.F=!1,this.D=Ts()},t.prototype.B=function(t,e){this.F=!0,this.D=this.D.insert(t,e)},t.prototype.q=function(t){this.F=!0,this.D=this.D.remove(t)},t.prototype.U=function(){this.S+=1},t.prototype.K=function(){this.S-=1},t.prototype.j=function(){this.F=!0,this.N=!0},t}(),ws=function(){function t(t){this.W=t,this.G=new Map,this.H=os(),this.J=Is(),this.Y=new ns(Gr)}return t.prototype.X=function(t){for(var e=0,n=t.v;e<n.length;e++){var r=n[e];t.P&&t.P.isFoundDocument()?this.Z(r,t.P):this.tt(r,t.key,t.P)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)this.tt(r=o[i],t.key,t.P)},t.prototype.et=function(t){var e=this;this.forEachTarget(t,function(n){var r=e.nt(n);switch(t.state){case 0:e.st(n)&&r.O(t.resumeToken);break;case 1:r.K(),r.k||r.L(),r.O(t.resumeToken);break;case 2:r.K(),r.k||e.removeTarget(n);break;case 3:e.st(n)&&(r.j(),r.O(t.resumeToken));break;case 4:e.st(n)&&(e.it(n),r.O(t.resumeToken));break;default:Vr()}})},t.prototype.forEachTarget=function(t,e){var n=this;t.targetIds.length>0?t.targetIds.forEach(e):this.G.forEach(function(t,r){n.st(r)&&e(r)})},t.prototype.rt=function(t){var e=t.targetId,n=t.V.count,r=this.ot(e);if(r){var i=r.target;if(Li(i))if(0===n){var o=new pi(i.path);this.tt(e,o,ki.newNoDocument(o,Wr.min()))}else qr(1===n);else this.ct(e)!==n&&(this.it(e),this.Y=this.Y.add(e))}},t.prototype.ut=function(t){var e=this,n=new Map;this.G.forEach(function(r,i){var o=e.ot(i);if(o){if(r.current&&Li(o.target)){var s=new pi(o.target.path);null!==e.H.get(s)||e.at(i,s)||e.tt(i,s,ki.newNoDocument(s,t))}r.$&&(n.set(i,r.M()),r.L())}});var r=ls();this.J.forEach(function(t,n){var i=!0;n.forEachWhile(function(t){var n=e.ot(t);return!n||2===n.purpose||(i=!1,!1)}),i&&(r=r.add(t))});var i=new ps(t,n,this.Y,this.H,r);return this.H=os(),this.J=Is(),this.Y=new ns(Gr),i},t.prototype.Z=function(t,e){if(this.st(t)){var n=this.at(t,e.key)?2:0;this.nt(t).B(e.key,n),this.H=this.H.insert(e.key,e),this.J=this.J.insert(e.key,this.ht(e.key).add(t))}},t.prototype.tt=function(t,e,n){if(this.st(t)){var r=this.nt(t);this.at(t,e)?r.B(e,1):r.q(e),this.J=this.J.insert(e,this.ht(e).delete(t)),n&&(this.H=this.H.insert(e,n))}},t.prototype.removeTarget=function(t){this.G.delete(t)},t.prototype.ct=function(t){var e=this.nt(t).M();return this.W.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},t.prototype.U=function(t){this.nt(t).U()},t.prototype.nt=function(t){var e=this.G.get(t);return e||(e=new bs,this.G.set(t,e)),e},t.prototype.ht=function(t){var e=this.J.get(t);return e||(e=new ns(Gr),this.J=this.J.insert(t,e)),e},t.prototype.st=function(t){var e=null!==this.ot(t);return e||Pr("WatchChangeAggregator","Detected inactive target",t),e},t.prototype.ot=function(t){var e=this.G.get(t);return e&&e.k?null:this.W.lt(t)},t.prototype.it=function(t){var e=this;this.G.set(t,new bs),this.W.getRemoteKeysForTarget(t).forEach(function(n){e.tt(t,n,null)})},t.prototype.at=function(t,e){return this.W.getRemoteKeysForTarget(t).has(e)},t}();function Is(){return new Zo(pi.comparator)}function Ts(){return new Zo(pi.comparator)}var Es={asc:"ASCENDING",desc:"DESCENDING"},_s={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Os=function(t,e){this.databaseId=t,this.I=e};function Ss(t,e){return t.I?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function Ds(t,e){return t.I?e.toBase64():e.toUint8Array()}function Ns(t,e){return Ss(t,e.toTimestamp())}function As(t){return qr(!!t),Wr.fromTimestamp(function(t){var e=oi(t);return new Hr(e.seconds,e.nanos)}(t))}function js(t,e){return function(t){return new Zr(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function ks(t){var e=Zr.fromString(t);return qr(ea(e)),e}function Cs(t,e){return js(t.databaseId,e.path)}function xs(t,e){var n=ks(e);if(n.get(1)!==t.databaseId.projectId)throw new Cr(kr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Cr(kr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new pi(Fs(n))}function Rs(t,e){return js(t.databaseId,e)}function Ps(t){var e=ks(t);return 4===e.length?Zr.emptyPath():Fs(e)}function Ls(t){return new Zr(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Fs(t){return qr(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function Ms(t,e,n){return{name:Cs(t,e),fields:n.value.mapValue.fields}}function Vs(t,e,n){var r=xs(t,e.name),i=As(e.updateTime),o=new Ai({mapValue:{fields:e.fields}}),s=ki.newFoundDocument(r,i,o);return n&&s.setHasCommittedMutations(),n?s.setHasCommittedMutations():s}function qs(t,e){var n;if(e instanceof Uo)n={update:Ms(t,e.key,e.value)};else if(e instanceof Wo)n={delete:Cs(t,e.key)};else if(e instanceof Bo)n={update:Ms(t,e.key,e.data),updateMask:ta(e.fieldMask)};else{if(!(e instanceof Yo))return Vr();n={verify:Cs(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(function(t){return function(t,e){var n=e.transform;if(n instanceof Eo)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof _o)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof So)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof No)return{fieldPath:e.field.canonicalString(),increment:n.A};throw Vr()}(0,t)})),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:Ns(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:Vr()}(t,e.precondition)),n}function Us(t,e){var n=e.currentDocument?function(t){return void 0!==t.updateTime?xo.updateTime(As(t.updateTime)):void 0!==t.exists?xo.exists(t.exists):xo.none()}(e.currentDocument):xo.none(),r=e.updateTransforms?e.updateTransforms.map(function(e){return function(t,e){var n=null;"setToServerValue"in e?(qr("REQUEST_TIME"===e.setToServerValue),n=new Eo):"appendMissingElements"in e?n=new _o(e.appendMissingElements.values||[]):"removeAllFromArray"in e?n=new So(e.removeAllFromArray.values||[]):"increment"in e?n=new No(t,e.increment):Vr();var r=ei.fromServerFormat(e.fieldPath);return new ko(r,n)}(t,e)}):[];if(e.update){var i=xs(t,e.update.name),o=new Ai({mapValue:{fields:e.update.fields}});if(e.updateMask){var s=function(t){return new ni((t.fieldPaths||[]).map(function(t){return ei.fromServerFormat(t)}))}(e.updateMask);return new Bo(i,o,s,n,r)}return new Uo(i,o,n,r)}if(e.delete){var a=xs(t,e.delete);return new Wo(a,n)}if(e.verify){var u=xs(t,e.verify);return new Yo(u,n)}return Vr()}function Bs(t,e){return{documents:[Rs(t,e.path)]}}function Ks(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=Rs(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=Rs(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(t){if(0!==t.length){var e=t.map(function(t){return function(t){if("=="===t.op){if(Si(t.value))return{unaryFilter:{field:Xs(t.field),op:"IS_NAN"}};if(Oi(t.value))return{unaryFilter:{field:Xs(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Si(t.value))return{unaryFilter:{field:Xs(t.field),op:"IS_NOT_NAN"}};if(Oi(t.value))return{unaryFilter:{field:Xs(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Xs(t.field),op:Ys(t.op),value:t.value}}}(t)});return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map(function(t){return function(t){return{field:Xs(t.field),direction:Ws(t.dir)}}(t)})}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var s=function(t,e){return t.I||li(e)?e:{value:e}}(t,e.limit);return null!==s&&(n.structuredQuery.limit=s),e.startAt&&(n.structuredQuery.startAt=zs(e.startAt)),e.endAt&&(n.structuredQuery.endAt=zs(e.endAt)),n}function Gs(t){var e=Ps(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){qr(1===r);var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var s=[];n.where&&(s=Qs(n.where));var a=[];n.orderBy&&(a=n.orderBy.map(function(t){return function(t){return new Wi($s(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)}));var u=null;n.limit&&(u=function(t){var e;return li(e="object"==typeof t?t.value:t)?null:e}(n.limit));var c=null;n.startAt&&(c=Hs(n.startAt));var h=null;return n.endAt&&(h=Hs(n.endAt)),Zi(e,i,a,s,u,"F",c,h)}function Qs(t){return t?void 0!==t.unaryFilter?[Zs(t)]:void 0!==t.fieldFilter?[Js(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return Qs(t)}).reduce(function(t,e){return t.concat(e)}):Vr():[]}function zs(t){return{before:t.before,values:t.position}}function Hs(t){return new zi(t.values||[],!!t.before)}function Ws(t){return Es[t]}function Ys(t){return _s[t]}function Xs(t){return{fieldPath:t.canonicalString()}}function $s(t){return ei.fromServerFormat(t.fieldPath)}function Js(t){return Fi.create($s(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return Vr()}}(t.fieldFilter.op),t.fieldFilter.value)}function Zs(t){switch(t.unaryFilter.op){case"IS_NAN":var e=$s(t.unaryFilter.field);return Fi.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=$s(t.unaryFilter.field);return Fi.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=$s(t.unaryFilter.field);return Fi.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=$s(t.unaryFilter.field);return Fi.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return Vr()}}function ta(t){var e=[];return t.fields.forEach(function(t){return e.push(t.canonicalString())}),{fieldPaths:e}}function ea(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}function na(t){for(var e="",n=0;n<t.length;n++)e.length>0&&(e=ia(e)),e=ra(t.get(n),e);return ia(e)}function ra(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=o}}return n}function ia(t){return t+"\x01\x01"}function oa(t){var e=t.length;if(qr(e>=2),2===e)return qr("\x01"===t.charAt(0)&&"\x01"===t.charAt(1)),Zr.emptyPath();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("\x01",o);switch((s<0||s>n)&&Vr(),t.charAt(s+1)){case"\x01":var a=t.substring(o,s),u=void 0;0===i.length?u=a:(u=i+=a,i=""),r.push(u);break;case"\x10":i+=t.substring(o,s),i+="\0";break;case"\x11":i+=t.substring(o,s+1);break;default:Vr()}o=s+2}return new Zr(r)}var sa=function(t,e){this.seconds=t,this.nanoseconds=e},aa=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};aa.store="owner",aa.key="owner";var ua=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};ua.store="mutationQueues",ua.keyPath="userId";var ca=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};ca.store="mutations",ca.keyPath="batchId",ca.userMutationsIndex="userMutationsIndex",ca.userMutationsKeyPath=["userId","batchId"];var ha=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,na(e)]},t.key=function(t,e,n){return[t,na(e),n]},t}();ha.store="documentMutations",ha.PLACEHOLDER=new ha;var la=function(t,e){this.path=t,this.readTime=e},fa=function(t,e){this.path=t,this.version=e},da=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};da.store="remoteDocuments",da.readTimeIndex="readTimeIndex",da.readTimeIndexPath="readTime",da.collectionReadTimeIndex="collectionReadTimeIndex",da.collectionReadTimeIndexPath=["parentPath","readTime"];var pa=function(t){this.byteSize=t};pa.store="remoteDocumentGlobal",pa.key="remoteDocumentGlobalKey";var ya=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};ya.store="targets",ya.keyPath="targetId",ya.queryTargetsIndexName="queryTargetsIndex",ya.queryTargetsKeyPath=["canonicalId","targetId"];var ga=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};ga.store="targetDocuments",ga.keyPath=["targetId","path"],ga.documentTargetsIndex="documentTargetsIndex",ga.documentTargetsKeyPath=["path","targetId"];var va=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};va.key="targetGlobalKey",va.store="targetGlobal";var ma=function(t,e){this.collectionId=t,this.parent=e};ma.store="collectionParents",ma.keyPath=["collectionId","parent"];var ba=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};ba.store="clientMetadata",ba.keyPath="clientId";var wa=function(t,e,n){this.bundleId=t,this.createTime=e,this.version=n};wa.store="bundles",wa.keyPath="bundleId";var Ia=function(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n};Ia.store="namedQueries",Ia.keyPath="name";var Ta=Object(b.f)(Object(b.f)([],Object(b.f)(Object(b.f)([],Object(b.f)(Object(b.f)([],Object(b.f)(Object(b.f)([],[ua.store,ca.store,ha.store,da.store,ya.store,aa.store,va.store,ga.store]),[ba.store])),[pa.store])),[ma.store])),[wa.store,Ia.store]),Ea="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",_a=function(){function t(){this.onCommittedListeners=[]}return t.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},t.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach(function(t){return t()})},t}(),Oa=function(){var t=this;this.promise=new Promise(function(e,n){t.resolve=e,t.reject=n})},Sa=function(){function t(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)},function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)})}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.callbackAttached&&Vr(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new t(function(t,i){r.nextCallback=function(n){r.wrapSuccess(e,n).next(t,i)},r.catchCallback=function(e){r.wrapFailure(n,e).next(t,i)}})},t.prototype.toPromise=function(){var t=this;return new Promise(function(e,n){t.next(e,n)})},t.prototype.wrapUserFunction=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(e){return t.reject(e)}},t.prototype.wrapSuccess=function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.resolve(n)},t.prototype.wrapFailure=function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.reject(n)},t.resolve=function(e){return new t(function(t,n){t(e)})},t.reject=function(e){return new t(function(t,n){n(e)})},t.waitFor=function(e){return new t(function(t,n){var r=0,i=0,o=!1;e.forEach(function(e){++r,e.next(function(){++i,o&&i===r&&t()},function(t){return n(t)})}),o=!0,i===r&&t()})},t.or=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next(function(n){return n?t.resolve(n):e()})},i=0,o=e;i<o.length;i++)r(o[i]);return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach(function(t,i){r.push(e.call(n,t,i))}),this.waitFor(r)},t}(),Da=function(){function t(t,e){var n=this;this.action=t,this.transaction=e,this.aborted=!1,this.ft=new Oa,this.transaction.oncomplete=function(){n.ft.resolve()},this.transaction.onabort=function(){e.error?n.ft.reject(new ja(t,e.error)):n.ft.resolve()},this.transaction.onerror=function(e){var r=Pa(e.target.error);n.ft.reject(new ja(t,r))}}return t.open=function(e,n,r,i){try{return new t(n,e.transaction(i,r))}catch(e){throw new ja(n,e)}},Object.defineProperty(t.prototype,"dt",{get:function(){return this.ft.promise},enumerable:!1,configurable:!0}),t.prototype.abort=function(t){t&&this.ft.reject(t),this.aborted||(Pr("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return new Ca(e)},t}(),Na=function(){function t(e,n,r){this.name=e,this.version=n,this.wt=r,12.2===t._t(Object(w.i)())&&Lr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return t.delete=function(t){return Pr("SimpleDb","Removing database:",t),xa(window.indexedDB.deleteDatabase(t)).toPromise()},t.yt=function(){if("undefined"==typeof indexedDB)return!1;if(t.gt())return!0;var e=Object(w.i)(),n=t._t(e),r=0<n&&n<10,i=t.Et(e),o=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||o)},t.gt=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Tt)},t.It=function(t,e){return t.store(e)},t._t=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},t.Et=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},t.prototype.At=function(t){return Object(b.b)(this,void 0,void 0,function(){var e,n=this;return Object(b.d)(this,function(r){switch(r.label){case 0:return this.db?[3,2]:(Pr("SimpleDb","Opening database:",this.name),e=this,[4,new Promise(function(e,r){var i=indexedDB.open(n.name,n.version);i.onsuccess=function(t){e(t.target.result)},i.onblocked=function(){r(new ja(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(e){var n=e.target.error;r("VersionError"===n.name?new Cr(kr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):new ja(t,n))},i.onupgradeneeded=function(t){Pr("SimpleDb",'Database "'+n.name+'" requires upgrade from version:',t.oldVersion),n.wt.Rt(t.target.result,i.transaction,t.oldVersion,n.version).next(function(){Pr("SimpleDb","Database upgrade to version "+n.version+" complete")})}})]);case 1:e.db=r.sent(),r.label=2;case 2:return[2,(this.bt&&(this.db.onversionchange=function(t){return n.bt(t)}),this.db)]}})})},t.prototype.vt=function(t){this.bt=t,this.db&&(this.db.onversionchange=function(e){return t(e)})},t.prototype.runTransaction=function(t,e,n,r){return Object(b.b)(this,void 0,void 0,function(){var i,o,s,a,u;return Object(b.d)(this,function(c){switch(c.label){case 0:i="readonly"===e,o=0,s=function(){var e,s,u,c,h;return Object(b.d)(this,function(l){switch(l.label){case 0:++o,l.label=1;case 1:return l.trys.push([1,4,,5]),[4,a.At(t)];case 2:return a.db=l.sent(),e=Da.open(a.db,t,i?"readonly":"readwrite",n),s=r(e).catch(function(t){return e.abort(t),Sa.reject(t)}).toPromise(),u={},s.catch(function(){}),[4,e.dt];case 3:return[2,(u.value=(l.sent(),s),u)];case 4:return Pr("SimpleDb","Transaction failed with error:",(c=l.sent()).message,"Retrying:",h="FirebaseError"!==c.name&&o<3),a.close(),h?[3,5]:[2,{value:Promise.reject(c)}];case 5:return[2]}})},a=this,c.label=1;case 1:return[5,s()];case 2:if("object"==typeof(u=c.sent()))return[2,u.value];c.label=3;case 3:return[3,1];case 4:return[2]}})})},t.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},t}(),Aa=function(){function t(t){this.Pt=t,this.Vt=!1,this.St=null}return Object.defineProperty(t.prototype,"isDone",{get:function(){return this.Vt},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Dt",{get:function(){return this.St},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.Pt=t},enumerable:!1,configurable:!0}),t.prototype.done=function(){this.Vt=!0},t.prototype.Ct=function(t){this.St=t},t.prototype.delete=function(){return xa(this.Pt.delete())},t}(),ja=function(t){function e(e,n){var r=this;return(r=t.call(this,kr.UNAVAILABLE,"IndexedDB transaction '"+e+"' failed: "+n)||this).name="IndexedDbTransactionError",r}return Object(b.c)(e,t),e}(Cr);function ka(t){return"IndexedDbTransactionError"===t.name}var Ca=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(Pr("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(Pr("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),xa(n)},t.prototype.add=function(t){return Pr("SimpleDb","ADD",this.store.name,t,t),xa(this.store.add(t))},t.prototype.get=function(t){var e=this;return xa(this.store.get(t)).next(function(n){return void 0===n&&(n=null),Pr("SimpleDb","GET",e.store.name,t,n),n})},t.prototype.delete=function(t){return Pr("SimpleDb","DELETE",this.store.name,t),xa(this.store.delete(t))},t.prototype.count=function(){return Pr("SimpleDb","COUNT",this.store.name),xa(this.store.count())},t.prototype.Nt=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.xt(n,function(t,e){r.push(e)}).next(function(){return r})},t.prototype.Ft=function(t,e){Pr("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.kt=!1;var r=this.cursor(n);return this.xt(r,function(t,e,n){return n.delete()})},t.prototype.$t=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.xt(r,e)},t.prototype.Ot=function(t){var e=this.cursor({});return new Sa(function(n,r){e.onerror=function(t){var e=Pa(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next(function(t){t?r.continue():n()}):n()}})},t.prototype.xt=function(t,e){var n=[];return new Sa(function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new Aa(i),s=e(i.primaryKey,i.value,o);if(s instanceof Sa){var a=s.catch(function(t){return o.done(),Sa.reject(t)});n.push(a)}o.isDone?r():null===o.Dt?i.continue():i.continue(o.Dt)}else r()}}).next(function(){return Sa.waitFor(n)})},t.prototype.options=function(t,e){var n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.kt?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function xa(t){return new Sa(function(e,n){t.onsuccess=function(t){e(t.target.result)},t.onerror=function(t){var e=Pa(t.target.error);n(e)}})}var Ra=!1;function Pa(t){var e=Na._t(Object(w.i)());if(e>=12.2&&e<13){var n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){var r=new Cr("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Ra||(Ra=!0,setTimeout(function(){throw r},0)),r}}return t}var La=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Mt=e,r.currentSequenceNumber=n,r}return Object(b.c)(e,t),e}(_a);function Fa(t,e){var n=Ur(t);return Na.It(n.Mt,e)}var Ma=function(){function t(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}return t.prototype.applyToRemoteDocument=function(t,e){for(var n=e.mutationResults,r=0;r<this.mutations.length;r++){var i=this.mutations[r];i.key.isEqual(t.key)&&Lo(i,t,n[r])}},t.prototype.applyToLocalView=function(t){for(var e=0,n=this.baseMutations;e<n.length;e++)(o=n[e]).key.isEqual(t.key)&&Fo(o,t,this.localWriteTime);for(var r=0,i=this.mutations;r<i.length;r++){var o;(o=i[r]).key.isEqual(t.key)&&Fo(o,t,this.localWriteTime)}},t.prototype.applyToLocalDocumentSet=function(t){var e=this;this.mutations.forEach(function(n){var r=t.get(n.key),i=r;e.applyToLocalView(i),r.isValidDocument()||i.convertToNoDocument(Wr.min())})},t.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},ls())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&Qr(this.mutations,t.mutations,function(t,e){return Vo(t,e)})&&Qr(this.baseMutations,t.baseMutations,function(t,e){return Vo(t,e)})},t}(),Va=function(){function t(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}return t.from=function(e,n,r){qr(e.mutations.length===r.length);for(var i=cs(),o=e.mutations,s=0;s<o.length;s++)i=i.insert(o[s].key,r[s].version);return new t(e,n,r,i)},t}(),qa=function(){function t(t,e,n,r,i,o,s){void 0===i&&(i=Wr.min()),void 0===o&&(o=Wr.min()),void 0===s&&(s=ri.EMPTY_BYTE_STRING),this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}return t.prototype.withSequenceNumber=function(e){return new t(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},t.prototype.withResumeToken=function(e,n){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)},t.prototype.withLastLimboFreeSnapshotVersion=function(e){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)},t}(),Ua=function(t){this.Lt=t};function Ba(t,e){if(e.document)return Vs(t.Lt,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=pi.fromSegments(e.noDocument.path),r=Ha(e.noDocument.readTime),i=ki.newNoDocument(n,r);return e.hasCommittedMutations?i.setHasCommittedMutations():i}if(e.unknownDocument){var o=pi.fromSegments(e.unknownDocument.path);return r=Ha(e.unknownDocument.version),ki.newUnknownDocument(o,r)}return Vr()}function Ka(t,e,n){var r=Ga(n),i=e.key.path.popLast().toArray();if(e.isFoundDocument()){var o=function(t,e){return{name:Cs(t,e.key),fields:e.data.value.mapValue.fields,updateTime:Ss(t,e.version.toTimestamp())}}(t.Lt,e),s=e.hasCommittedMutations;return new da(null,null,o,s,r,i)}if(e.isNoDocument()){var a=e.key.path.toArray(),u=za(e.version);return s=e.hasCommittedMutations,new da(null,new la(a,u),null,s,r,i)}if(e.isUnknownDocument()){var c=e.key.path.toArray(),h=za(e.version);return new da(new fa(c,h),null,null,!0,r,i)}return Vr()}function Ga(t){var e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function Qa(t){var e=new Hr(t[0],t[1]);return Wr.fromTimestamp(e)}function za(t){var e=t.toTimestamp();return new sa(e.seconds,e.nanoseconds)}function Ha(t){var e=new Hr(t.seconds,t.nanoseconds);return Wr.fromTimestamp(e)}function Wa(t,e){for(var n=(e.baseMutations||[]).map(function(e){return Us(t.Lt,e)}),r=0;r<e.mutations.length-1;++r)r+1<e.mutations.length&&void 0!==e.mutations[r+1].transform&&(e.mutations[r].updateTransforms=e.mutations[r+1].transform.fieldTransforms,e.mutations.splice(r+1,1),++r);var i=e.mutations.map(function(e){return Us(t.Lt,e)}),o=Hr.fromMillis(e.localWriteTimeMs);return new Ma(e.batchId,o,n,i)}function Ya(t){var e,n,r=Ha(t.readTime),i=void 0!==t.lastLimboFreeSnapshotVersion?Ha(t.lastLimboFreeSnapshotVersion):Wr.min();return void 0!==t.query.documents?(qr(1===(n=t.query).documents.length),e=ao(to(Ps(n.documents[0])))):e=function(t){return ao(Gs(t))}(t.query),new qa(e,t.targetId,0,t.lastListenSequenceNumber,r,i,ri.fromBase64String(t.resumeToken))}function Xa(t,e){var n,r=za(e.snapshotVersion),i=za(e.lastLimboFreeSnapshotVersion);n=Li(e.target)?Bs(t.Lt,e.target):Ks(t.Lt,e.target);var o=e.resumeToken.toBase64();return new ya(e.targetId,Ri(e.target),r,o,e.sequenceNumber,i,n)}function $a(t){var e=Gs({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?uo(e,e.limit,"L"):e}var Ja=function(){function t(){}return t.prototype.getBundleMetadata=function(t,e){return Za(t).get(e).next(function(t){if(t)return{id:(e=t).bundleId,createTime:Ha(e.createTime),version:e.version};var e})},t.prototype.saveBundleMetadata=function(t,e){return Za(t).put({bundleId:(n=e).id,createTime:za(As(n.createTime)),version:n.version});var n},t.prototype.getNamedQuery=function(t,e){return tu(t).get(e).next(function(t){if(t)return{name:(e=t).name,query:$a(e.bundledQuery),readTime:Ha(e.readTime)};var e})},t.prototype.saveNamedQuery=function(t,e){return tu(t).put(function(t){return{name:t.name,readTime:za(As(t.readTime)),bundledQuery:t.bundledQuery}}(e))},t}();function Za(t){return Fa(t,wa.store)}function tu(t){return Fa(t,Ia.store)}var eu=function(){function t(){this.Bt=new nu}return t.prototype.addToCollectionParentIndex=function(t,e){return this.Bt.add(e),Sa.resolve()},t.prototype.getCollectionParents=function(t,e){return Sa.resolve(this.Bt.getEntries(e))},t}(),nu=function(){function t(){this.index={}}return t.prototype.add=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new ns(Zr.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.has=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)},t.prototype.getEntries=function(t){return(this.index[t]||new ns(Zr.comparator)).toArray()},t}(),ru=function(){function t(){this.qt=new nu}return t.prototype.addToCollectionParentIndex=function(t,e){var n=this;if(!this.qt.has(e)){var r=e.lastSegment(),i=e.popLast();t.addOnCommittedListener(function(){n.qt.add(e)});var o={collectionId:r,parent:na(i)};return iu(t).put(o)}return Sa.resolve()},t.prototype.getCollectionParents=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[zr(e),""],!1,!0);return iu(t).Nt(r).next(function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(oa(o.parent))}return n})},t}();function iu(t){return Fa(t,ma.store)}var ou={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},su=function(){function t(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}return t.withCacheSize=function(e){return new t(e,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},t}();function au(t,e,n){var r=t.store(ca.store),i=t.store(ha.store),o=[],s=IDBKeyRange.only(n.batchId),a=0,u=r.$t({range:s},function(t,e,n){return a++,n.delete()});o.push(u.next(function(){qr(1===a)}));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var f=l[h],d=ha.key(e,f.key.path,n.batchId);o.push(i.delete(d)),c.push(f.key)}return Sa.waitFor(o).next(function(){return c})}function uu(t){if(!t)return 0;var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Vr();e=t.noDocument}return JSON.stringify(e).length}su.DEFAULT_COLLECTION_PERCENTILE=10,su.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,su.DEFAULT=new su(41943040,su.DEFAULT_COLLECTION_PERCENTILE,su.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),su.DISABLED=new su(-1,0,0);var cu=function(){function t(t,e,n,r){this.userId=t,this.R=e,this.Ut=n,this.referenceDelegate=r,this.Kt={}}return t.Qt=function(e,n,r,i){return qr(""!==e.uid),new t(e.isAuthenticated()?e.uid:"",n,r,i)},t.prototype.checkEmpty=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return lu(t).$t({index:ca.userMutationsIndex,range:n},function(t,n,r){e=!1,r.done()}).next(function(){return e})},t.prototype.addMutationBatch=function(t,e,n,r){var i=this,o=fu(t),s=lu(t);return s.add({}).next(function(a){qr("number"==typeof a);for(var u=new Ma(a,e,n,r),c=function(t,e,n){var r=n.baseMutations.map(function(e){return qs(t.Lt,e)}),i=n.mutations.map(function(e){return qs(t.Lt,e)});return new ca(e,n.batchId,n.localWriteTime.toMillis(),r,i)}(i.R,i.userId,u),h=[],l=new ns(function(t,e){return Gr(t.canonicalString(),e.canonicalString())}),f=0,d=r;f<d.length;f++){var p=d[f],y=ha.key(i.userId,p.key.path,a);l=l.add(p.key.path.popLast()),h.push(s.put(c)),h.push(o.put(y,ha.PLACEHOLDER))}return l.forEach(function(e){h.push(i.Ut.addToCollectionParentIndex(t,e))}),t.addOnCommittedListener(function(){i.Kt[a]=u.keys()}),Sa.waitFor(h).next(function(){return u})})},t.prototype.lookupMutationBatch=function(t,e){var n=this;return lu(t).get(e).next(function(t){return t?(qr(t.userId===n.userId),Wa(n.R,t)):null})},t.prototype.jt=function(t,e){var n=this;return this.Kt[e]?Sa.resolve(this.Kt[e]):this.lookupMutationBatch(t,e).next(function(t){if(t){var r=t.keys();return n.Kt[e]=r,r}return null})},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return lu(t).$t({index:ca.userMutationsIndex,range:i},function(t,e,i){e.userId===n.userId&&(qr(e.batchId>=r),o=Wa(n.R,e)),i.done()}).next(function(){return o})},t.prototype.getHighestUnacknowledgedBatchId=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return lu(t).$t({index:ca.userMutationsIndex,range:e,reverse:!0},function(t,e,r){n=e.batchId,r.done()}).next(function(){return n})},t.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return lu(t).Nt(ca.userMutationsIndex,n).next(function(t){return t.map(function(t){return Wa(e.R,t)})})},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=ha.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return fu(t).$t({range:i},function(r,i,s){var a=r[0],u=r[2],c=oa(r[1]);if(a===n.userId&&e.path.isEqual(c))return lu(t).get(u).next(function(t){if(!t)throw Vr();qr(t.userId===n.userId),o.push(Wa(n.R,t))});s.done()}).next(function(){return o})},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new ns(Gr),i=[];return e.forEach(function(e){var o=ha.prefixForPath(n.userId,e.path),s=IDBKeyRange.lowerBound(o),a=fu(t).$t({range:s},function(t,i,o){var s=t[0],a=t[2],u=oa(t[1]);s===n.userId&&e.path.isEqual(u)?r=r.add(a):o.done()});i.push(a)}),Sa.waitFor(i).next(function(){return n.Wt(t,r)})},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=this,r=e.path,i=r.length+1,o=ha.prefixForPath(this.userId,r),s=IDBKeyRange.lowerBound(o),a=new ns(Gr);return fu(t).$t({range:s},function(t,e,o){var s=t[0],u=t[2],c=oa(t[1]);s===n.userId&&r.isPrefixOf(c)?c.length===i&&(a=a.add(u)):o.done()}).next(function(){return n.Wt(t,a)})},t.prototype.Wt=function(t,e){var n=this,r=[],i=[];return e.forEach(function(e){i.push(lu(t).get(e).next(function(t){if(null===t)throw Vr();qr(t.userId===n.userId),r.push(Wa(n.R,t))}))}),Sa.waitFor(i).next(function(){return r})},t.prototype.removeMutationBatch=function(t,e){var n=this;return au(t.Mt,this.userId,e).next(function(r){return t.addOnCommittedListener(function(){n.Gt(e.batchId)}),Sa.forEach(r,function(e){return n.referenceDelegate.markPotentiallyOrphaned(t,e)})})},t.prototype.Gt=function(t){delete this.Kt[t]},t.prototype.performConsistencyCheck=function(t){var e=this;return this.checkEmpty(t).next(function(n){if(!n)return Sa.resolve();var r=IDBKeyRange.lowerBound(ha.prefixForUser(e.userId)),i=[];return fu(t).$t({range:r},function(t,n,r){if(t[0]===e.userId){var o=oa(t[1]);i.push(o)}else r.done()}).next(function(){qr(0===i.length)})})},t.prototype.containsKey=function(t,e){return hu(t,this.userId,e)},t.prototype.zt=function(t){var e=this;return du(t).get(this.userId).next(function(t){return t||new ua(e.userId,-1,"")})},t}();function hu(t,e,n){var r=ha.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return fu(t).$t({range:o,kt:!0},function(t,n,r){t[0]===e&&t[1]===i&&(s=!0),r.done()}).next(function(){return s})}function lu(t){return Fa(t,ca.store)}function fu(t){return Fa(t,ha.store)}function du(t){return Fa(t,ua.store)}var pu=function(){function t(t){this.Ht=t}return t.prototype.next=function(){return this.Ht+=2,this.Ht},t.Jt=function(){return new t(0)},t.Yt=function(){return new t(-1)},t}(),yu=function(){function t(t,e){this.referenceDelegate=t,this.R=e}return t.prototype.allocateTargetId=function(t){var e=this;return this.Xt(t).next(function(n){var r=new pu(n.highestTargetId);return n.highestTargetId=r.next(),e.Zt(t,n).next(function(){return n.highestTargetId})})},t.prototype.getLastRemoteSnapshotVersion=function(t){return this.Xt(t).next(function(t){return Wr.fromTimestamp(new Hr(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},t.prototype.getHighestSequenceNumber=function(t){return this.Xt(t).next(function(t){return t.highestListenSequenceNumber})},t.prototype.setTargetsMetadata=function(t,e,n){var r=this;return this.Xt(t).next(function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.Zt(t,i)})},t.prototype.addTargetData=function(t,e){var n=this;return this.te(t,e).next(function(){return n.Xt(t).next(function(r){return r.targetCount+=1,n.ee(e,r),n.Zt(t,r)})})},t.prototype.updateTargetData=function(t,e){return this.te(t,e)},t.prototype.removeTargetData=function(t,e){var n=this;return this.removeMatchingKeysForTargetId(t,e.targetId).next(function(){return gu(t).delete(e.targetId)}).next(function(){return n.Xt(t)}).next(function(e){return qr(e.targetCount>0),e.targetCount-=1,n.Zt(t,e)})},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return gu(t).$t(function(s,a){var u=Ya(a);u.sequenceNumber<=e&&null===n.get(u.targetId)&&(i++,o.push(r.removeTargetData(t,u)))}).next(function(){return Sa.waitFor(o)}).next(function(){return i})},t.prototype.forEachTarget=function(t,e){return gu(t).$t(function(t,n){var r=Ya(n);e(r)})},t.prototype.Xt=function(t){return vu(t).get(va.key).next(function(t){return qr(null!==t),t})},t.prototype.Zt=function(t,e){return vu(t).put(va.key,e)},t.prototype.te=function(t,e){return gu(t).put(Xa(this.R,e))},t.prototype.ee=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.getTargetCount=function(t){return this.Xt(t).next(function(t){return t.targetCount})},t.prototype.getTargetData=function(t,e){var n=Ri(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return gu(t).$t({range:r,index:ya.queryTargetsIndexName},function(t,n,r){var o=Ya(n);Pi(e,o.target)&&(i=o,r.done())}).next(function(){return i})},t.prototype.addMatchingKeys=function(t,e,n){var r=this,i=[],o=mu(t);return e.forEach(function(e){var s=na(e.path);i.push(o.put(new ga(n,s))),i.push(r.referenceDelegate.addReference(t,n,e))}),Sa.waitFor(i)},t.prototype.removeMatchingKeys=function(t,e,n){var r=this,i=mu(t);return Sa.forEach(e,function(e){var o=na(e.path);return Sa.waitFor([i.delete([n,o]),r.referenceDelegate.removeReference(t,n,e)])})},t.prototype.removeMatchingKeysForTargetId=function(t,e){var n=mu(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=mu(t),i=ls();return r.$t({range:n,kt:!0},function(t,e,n){var r=oa(t[1]),o=new pi(r);i=i.add(o)}).next(function(){return i})},t.prototype.containsKey=function(t,e){var n=na(e.path),r=IDBKeyRange.bound([n],[zr(n)],!1,!0),i=0;return mu(t).$t({index:ga.documentTargetsIndex,kt:!0,range:r},function(t,e,n){0!==t[0]&&(i++,n.done())}).next(function(){return i>0})},t.prototype.lt=function(t,e){return gu(t).get(e).next(function(t){return t?Ya(t):null})},t}();function gu(t){return Fa(t,ya.store)}function vu(t){return Fa(t,va.store)}function mu(t){return Fa(t,ga.store)}function bu(t){return Object(b.b)(this,void 0,void 0,function(){return Object(b.d)(this,function(e){if(t.code!==kr.FAILED_PRECONDITION||t.message!==Ea)throw t;return Pr("LocalStore","Unexpectedly lost primary lease"),[2]})})}function wu(t,e){var n=t[1],r=e[1],i=Gr(t[0],e[0]);return 0===i?Gr(n,r):i}var Iu=function(){function t(t){this.ne=t,this.buffer=new ns(wu),this.se=0}return t.prototype.ie=function(){return++this.se},t.prototype.re=function(t){var e=[t,this.ie()];if(this.buffer.size<this.ne)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();wu(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),t}(),Tu=function(){function t(t,e){this.garbageCollector=t,this.asyncQueue=e,this.oe=!1,this.ce=null}return t.prototype.start=function(t){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.ue(t)},t.prototype.stop=function(){this.ce&&(this.ce.cancel(),this.ce=null)},Object.defineProperty(t.prototype,"started",{get:function(){return null!==this.ce},enumerable:!1,configurable:!0}),t.prototype.ue=function(t){var e=this,n=this.oe?3e5:6e4;Pr("LruGarbageCollector","Garbage collection scheduled in "+n+"ms"),this.ce=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",n,function(){return Object(b.b)(e,void 0,void 0,function(){var e;return Object(b.d)(this,function(n){switch(n.label){case 0:this.ce=null,this.oe=!0,n.label=1;case 1:return n.trys.push([1,3,,7]),[4,t.collectGarbage(this.garbageCollector)];case 2:return n.sent(),[3,7];case 3:return ka(e=n.sent())?(Pr("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,bu(e)];case 5:n.sent(),n.label=6;case 6:return[3,7];case 7:return[4,this.ue(t)];case 8:return n.sent(),[2]}})})})},t}(),Eu=function(){function t(t,e){this.ae=t,this.params=e}return t.prototype.calculateTargetCount=function(t,e){return this.ae.he(t).next(function(t){return Math.floor(e/100*t)})},t.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return Sa.resolve(jr.o);var r=new Iu(e);return this.ae.forEachTarget(t,function(t){return r.re(t.sequenceNumber)}).next(function(){return n.ae.le(t,function(t){return r.re(t)})}).next(function(){return r.maxValue})},t.prototype.removeTargets=function(t,e,n){return this.ae.removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){return this.ae.removeOrphanedDocuments(t,e)},t.prototype.collect=function(t,e){var n=this;return-1===this.params.cacheSizeCollectionThreshold?(Pr("LruGarbageCollector","Garbage collection skipped; disabled"),Sa.resolve(ou)):this.getCacheSize(t).next(function(r){return r<n.params.cacheSizeCollectionThreshold?(Pr("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.cacheSizeCollectionThreshold),ou):n.fe(t,e)})},t.prototype.getCacheSize=function(t){return this.ae.getCacheSize(t)},t.prototype.fe=function(t,e){var n,r,i,o,s,a,u,c=this,h=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(function(e){return e>c.params.maximumSequenceNumbersToCollect?(Pr("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+c.params.maximumSequenceNumbersToCollect+" from "+e),r=c.params.maximumSequenceNumbersToCollect):r=e,o=Date.now(),c.nthSequenceNumber(t,r)}).next(function(r){return n=r,s=Date.now(),c.removeTargets(t,n,e)}).next(function(e){return i=e,a=Date.now(),c.removeOrphanedDocuments(t,n)}).next(function(t){return u=Date.now(),Rr()<=I.a.DEBUG&&Pr("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(o-h)+"ms\n\tDetermined least recently used "+r+" in "+(s-o)+"ms\n\tRemoved "+i+" targets in "+(a-s)+"ms\n\tRemoved "+t+" documents in "+(u-a)+"ms\nTotal Duration: "+(u-h)+"ms"),Sa.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:t})})},t}(),_u=function(){function t(t,e){this.db=t,this.garbageCollector=function(t,e){return new Eu(t,e)}(this,e)}return t.prototype.he=function(t){var e=this.de(t);return this.db.getTargetCache().getTargetCount(t).next(function(t){return e.next(function(e){return t+e})})},t.prototype.de=function(t){var e=0;return this.le(t,function(t){e++}).next(function(){return e})},t.prototype.forEachTarget=function(t,e){return this.db.getTargetCache().forEachTarget(t,e)},t.prototype.le=function(t,e){return this.we(t,function(t,n){return e(n)})},t.prototype.addReference=function(t,e,n){return Ou(t,n)},t.prototype.removeReference=function(t,e,n){return Ou(t,n)},t.prototype.removeTargets=function(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)},t.prototype.markPotentiallyOrphaned=function(t,e){return Ou(t,e)},t.prototype._e=function(t,e){return function(t,e){var n=!1;return du(t).Ot(function(r){return hu(t,r,e).next(function(t){return t&&(n=!0),Sa.resolve(!t)})}).next(function(){return n})}(t,e)},t.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],o=0;return this.we(t,function(s,a){if(a<=e){var u=n._e(t,s).next(function(e){if(!e)return o++,r.getEntry(t,s).next(function(){return r.removeEntry(s),mu(t).delete([0,na(s.path)])})});i.push(u)}}).next(function(){return Sa.waitFor(i)}).next(function(){return r.apply(t)}).next(function(){return o})},t.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)},t.prototype.updateLimboDocument=function(t,e){return Ou(t,e)},t.prototype.we=function(t,e){var n,r=mu(t),i=jr.o;return r.$t({index:ga.documentTargetsIndex},function(t,r){var o=r.path,s=r.sequenceNumber;0===t[0]?(i!==jr.o&&e(new pi(oa(n)),i),i=s,n=o):i=jr.o}).next(function(){i!==jr.o&&e(new pi(oa(n)),i)})},t.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},t}();function Ou(t,e){return mu(t).put(function(t,e){return new ga(0,na(t.path),e)}(e,t.currentSequenceNumber))}var Su=function(){function t(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}return t.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[1];if(this.equalsFn(o[0],t))return s}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){Xr(this.inner,function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];t(o[0],o[1])}})},t.prototype.isEmpty=function(){return $r(this.inner)},t}(),Du=function(){function t(){this.changes=new Su(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),this.changesApplied=!1}return t.prototype.getReadTime=function(t){var e=this.changes.get(t);return e?e.readTime:Wr.min()},t.prototype.addEntry=function(t,e){this.assertNotApplied(),this.changes.set(t.key,{document:t,readTime:e})},t.prototype.removeEntry=function(t,e){void 0===e&&(e=null),this.assertNotApplied(),this.changes.set(t,{document:ki.newInvalidDocument(t),readTime:e})},t.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?Sa.resolve(n.document):this.getFromCache(t,e)},t.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},t.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},t.prototype.assertNotApplied=function(){},t}(),Nu=function(){function t(t,e){this.R=t,this.Ut=e}return t.prototype.addEntry=function(t,e,n){return ku(t).put(Cu(e),n)},t.prototype.removeEntry=function(t,e){var n=ku(t),r=Cu(e);return n.delete(r)},t.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next(function(r){return r.byteSize+=e,n.me(t,r)})},t.prototype.getEntry=function(t,e){var n=this;return ku(t).get(Cu(e)).next(function(t){return n.ye(e,t)})},t.prototype.ge=function(t,e){var n=this;return ku(t).get(Cu(e)).next(function(t){return{document:n.ye(e,t),size:uu(t)}})},t.prototype.getEntries=function(t,e){var n=this,r=os();return this.pe(t,e,function(t,e){var i=n.ye(t,e);r=r.insert(t,i)}).next(function(){return r})},t.prototype.Ee=function(t,e){var n=this,r=os(),i=new Zo(pi.comparator);return this.pe(t,e,function(t,e){var o=n.ye(t,e);r=r.insert(t,o),i=i.insert(t,uu(e))}).next(function(){return{documents:r,Te:i}})},t.prototype.pe=function(t,e,n){if(e.isEmpty())return Sa.resolve();var r=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),i=e.getIterator(),o=i.getNext();return ku(t).$t({range:r},function(t,e,r){for(var s=pi.fromSegments(t);o&&pi.comparator(o,s)<0;)n(o,null),o=i.getNext();o&&o.isEqual(s)&&(n(o,e),o=i.hasNext()?i.getNext():null),o?r.Ct(o.path.toArray()):r.done()}).next(function(){for(;o;)n(o,null),o=i.hasNext()?i.getNext():null})},t.prototype.getDocumentsMatchingQuery=function(t,e,n){var r=this,i=os(),o=e.path.length+1,s={};if(n.isEqual(Wr.min())){var a=e.path.toArray();s.range=IDBKeyRange.lowerBound(a)}else{var u=e.path.toArray(),c=Ga(n);s.range=IDBKeyRange.lowerBound([u,c],!0),s.index=da.collectionReadTimeIndex}return ku(t).$t(s,function(t,n,s){if(t.length===o){var a=Ba(r.R,n);e.path.isPrefixOf(a.key.path)?fo(e,a)&&(i=i.insert(a.key,a)):s.done()}}).next(function(){return i})},t.prototype.newChangeBuffer=function(t){return new Au(this,!!t&&t.trackRemovals)},t.prototype.getSize=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},t.prototype.getMetadata=function(t){return ju(t).get(pa.key).next(function(t){return qr(!!t),t})},t.prototype.me=function(t,e){return ju(t).put(pa.key,e)},t.prototype.ye=function(t,e){if(e){var n=Ba(this.R,e);if(!n.isNoDocument()||!n.version.isEqual(Wr.min()))return n}return ki.newInvalidDocument(t)},t}(),Au=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Ie=e,r.trackRemovals=n,r.Ae=new Su(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),r}return Object(b.c)(e,t),e.prototype.applyChanges=function(t){var e=this,n=[],r=0,i=new ns(function(t,e){return Gr(t.canonicalString(),e.canonicalString())});return this.changes.forEach(function(o,s){var a=e.Ae.get(o);if(s.document.isValidDocument()){var u=Ka(e.Ie.R,s.document,e.getReadTime(o));i=i.add(o.path.popLast());var c=uu(u);r+=c-a,n.push(e.Ie.addEntry(t,o,u))}else if(r-=a,e.trackRemovals){var h=Ka(e.Ie.R,ki.newNoDocument(o,Wr.min()),e.getReadTime(o));n.push(e.Ie.addEntry(t,o,h))}else n.push(e.Ie.removeEntry(t,o))}),i.forEach(function(r){n.push(e.Ie.Ut.addToCollectionParentIndex(t,r))}),n.push(this.Ie.updateMetadata(t,r)),Sa.waitFor(n)},e.prototype.getFromCache=function(t,e){var n=this;return this.Ie.ge(t,e).next(function(t){return n.Ae.set(e,t.size),t.document})},e.prototype.getAllFromCache=function(t,e){var n=this;return this.Ie.Ee(t,e).next(function(t){var e=t.documents;return t.Te.forEach(function(t,e){n.Ae.set(t,e)}),e})},e}(Du);function ju(t){return Fa(t,pa.store)}function ku(t){return Fa(t,da.store)}function Cu(t){return t.path.toArray()}var xu=function(){function t(t){this.R=t}return t.prototype.Rt=function(t,e,n,r){var i=this;qr(n<r&&n>=0&&r<=11);var o=new Da("createOrUpgrade",e);n<1&&r>=1&&(function(t){t.createObjectStore(aa.store)}(t),function(t){t.createObjectStore(ua.store,{keyPath:ua.keyPath}),t.createObjectStore(ca.store,{keyPath:ca.keyPath,autoIncrement:!0}).createIndex(ca.userMutationsIndex,ca.userMutationsKeyPath,{unique:!0}),t.createObjectStore(ha.store)}(t),Ru(t),function(t){t.createObjectStore(da.store)}(t));var s=Sa.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore(ga.store),t.deleteObjectStore(ya.store),t.deleteObjectStore(va.store)}(t),Ru(t)),s=s.next(function(){return function(t){var e=t.store(va.store),n=new va(0,0,Wr.min().toTimestamp(),0);return e.put(va.key,n)}(o)})),n<4&&r>=4&&(0!==n&&(s=s.next(function(){return function(t,e){return e.store(ca.store).Nt().next(function(n){t.deleteObjectStore(ca.store),t.createObjectStore(ca.store,{keyPath:ca.keyPath,autoIncrement:!0}).createIndex(ca.userMutationsIndex,ca.userMutationsKeyPath,{unique:!0});var r=e.store(ca.store),i=n.map(function(t){return r.put(t)});return Sa.waitFor(i)})}(t,o)})),s=s.next(function(){!function(t){t.createObjectStore(ba.store,{keyPath:ba.keyPath})}(t)})),n<5&&r>=5&&(s=s.next(function(){return i.Re(o)})),n<6&&r>=6&&(s=s.next(function(){return function(t){t.createObjectStore(pa.store)}(t),i.be(o)})),n<7&&r>=7&&(s=s.next(function(){return i.ve(o)})),n<8&&r>=8&&(s=s.next(function(){return i.Pe(t,o)})),n<9&&r>=9&&(s=s.next(function(){!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){var e=t.objectStore(da.store);e.createIndex(da.readTimeIndex,da.readTimeIndexPath,{unique:!1}),e.createIndex(da.collectionReadTimeIndex,da.collectionReadTimeIndexPath,{unique:!1})}(e)})),n<10&&r>=10&&(s=s.next(function(){return i.Ve(o)})),n<11&&r>=11&&(s=s.next(function(){!function(t){t.createObjectStore(wa.store,{keyPath:wa.keyPath})}(t),function(t){t.createObjectStore(Ia.store,{keyPath:Ia.keyPath})}(t)})),s},t.prototype.be=function(t){var e=0;return t.store(da.store).$t(function(t,n){e+=uu(n)}).next(function(){var n=new pa(e);return t.store(pa.store).put(pa.key,n)})},t.prototype.Re=function(t){var e=this,n=t.store(ua.store),r=t.store(ca.store);return n.Nt().next(function(n){return Sa.forEach(n,function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.Nt(ca.userMutationsIndex,i).next(function(r){return Sa.forEach(r,function(r){qr(r.userId===n.userId);var i=Wa(e.R,r);return au(t,n.userId,i).next(function(){})})})})})},t.prototype.ve=function(t){var e=t.store(ga.store),n=t.store(da.store);return t.store(va.store).get(va.key).next(function(t){var r=[];return n.$t(function(n,i){var o=new Zr(n),s=function(t){return[0,na(t)]}(o);r.push(e.get(s).next(function(n){return n?Sa.resolve():function(n){return e.put(new ga(0,na(n),t.highestListenSequenceNumber))}(o)}))}).next(function(){return Sa.waitFor(r)})})},t.prototype.Pe=function(t,e){t.createObjectStore(ma.store,{keyPath:ma.keyPath});var n=e.store(ma.store),r=new nu,i=function(t){if(r.add(t)){var e=t.lastSegment(),i=t.popLast();return n.put({collectionId:e,parent:na(i)})}};return e.store(da.store).$t({kt:!0},function(t,e){var n=new Zr(t);return i(n.popLast())}).next(function(){return e.store(ha.store).$t({kt:!0},function(t,e){var n=oa(t[1]);return i(n.popLast())})})},t.prototype.Ve=function(t){var e=this,n=t.store(ya.store);return n.$t(function(t,r){var i=Ya(r),o=Xa(e.R,i);return n.put(o)})},t}();function Ru(t){t.createObjectStore(ga.store,{keyPath:ga.keyPath}).createIndex(ga.documentTargetsIndex,ga.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(ya.store,{keyPath:ya.keyPath}).createIndex(ya.queryTargetsIndexName,ya.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(va.store)}var Pu="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Lu=function(){function t(e,n,r,i,o,s,a,u,c,h){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.Se=o,this.window=s,this.document=a,this.De=c,this.Ce=h,this.Ne=null,this.xe=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Fe=null,this.inForeground=!1,this.ke=null,this.$e=null,this.Oe=Number.NEGATIVE_INFINITY,this.Me=function(t){return Promise.resolve()},!t.yt())throw new Cr(kr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new _u(this,i),this.Le=n+"main",this.R=new Ua(u),this.Be=new Na(this.Le,11,new xu(this.R)),this.qe=new yu(this.referenceDelegate,this.R),this.Ut=new ru,this.Ue=function(t,e){return new Nu(t,e)}(this.R,this.Ut),this.Ke=new Ja,this.window&&this.window.localStorage?this.Qe=this.window.localStorage:(this.Qe=null,!1===h&&Lr("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return t.prototype.start=function(){var t=this;return this.je().then(function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new Cr(kr.FAILED_PRECONDITION,Pu);return t.We(),t.Ge(),t.ze(),t.runTransaction("getHighestListenSequenceNumber","readonly",function(e){return t.qe.getHighestSequenceNumber(e)})}).then(function(e){t.Ne=new jr(e,t.De)}).then(function(){t.xe=!0}).catch(function(e){return t.Be&&t.Be.close(),Promise.reject(e)})},t.prototype.He=function(t){var e=this;return this.Me=function(n){return Object(b.b)(e,void 0,void 0,function(){return Object(b.d)(this,function(e){return this.started?[2,t(n)]:[2]})})},t(this.isPrimary)},t.prototype.setDatabaseDeletedListener=function(t){var e=this;this.Be.vt(function(n){return Object(b.b)(e,void 0,void 0,function(){return Object(b.d)(this,function(e){switch(e.label){case 0:return null===n.newVersion?[4,t()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})})},t.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Se.enqueueAndForget(function(){return Object(b.b)(e,void 0,void 0,function(){return Object(b.d)(this,function(t){switch(t.label){case 0:return this.started?[4,this.je()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},t.prototype.je=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",function(e){return Mu(e).put(new ba(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next(function(){if(t.isPrimary)return t.Je(e).next(function(e){e||(t.isPrimary=!1,t.Se.enqueueRetryable(function(){return t.Me(!1)}))})}).next(function(){return t.Ye(e)}).next(function(n){return t.isPrimary&&!n?t.Xe(e).next(function(){return!1}):!!n&&t.Ze(e).next(function(){return!0})})}).catch(function(e){if(ka(e))return Pr("IndexedDbPersistence","Failed to extend owner lease: ",e),t.isPrimary;if(!t.allowTabSynchronization)throw e;return Pr("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(function(e){t.isPrimary!==e&&t.Se.enqueueRetryable(function(){return t.Me(e)}),t.isPrimary=e})},t.prototype.Je=function(t){var e=this;return Fu(t).get(aa.key).next(function(t){return Sa.resolve(e.tn(t))})},t.prototype.en=function(t){return Mu(t).delete(this.clientId)},t.prototype.nn=function(){return Object(b.b)(this,void 0,void 0,function(){var t,e,n,r=this;return Object(b.d)(this,function(i){switch(i.label){case 0:return!this.isPrimary||this.sn(this.Oe,18e5)?[3,2]:(this.Oe=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(t){var e=Fa(t,ba.store);return e.Nt().next(function(t){var n=r.rn(t,18e5),i=t.filter(function(t){return-1===n.indexOf(t)});return Sa.forEach(i,function(t){return e.delete(t.clientId)}).next(function(){return i})})}).catch(function(){return[]})]);case 1:if(t=i.sent(),this.Qe)for(e=0,n=t;e<n.length;e++)this.Qe.removeItem(this.on(n[e].clientId));i.label=2;case 2:return[2]}})})},t.prototype.ze=function(){var t=this;this.$e=this.Se.enqueueAfterDelay("client_metadata_refresh",4e3,function(){return t.je().then(function(){return t.nn()}).then(function(){return t.ze()})})},t.prototype.tn=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.Ye=function(t){var e=this;return this.Ce?Sa.resolve(!0):Fu(t).get(aa.key).next(function(n){if(null!==n&&e.sn(n.leaseTimestampMs,5e3)&&!e.cn(n.ownerId)){if(e.tn(n)&&e.networkEnabled)return!0;if(!e.tn(n)){if(!n.allowTabSynchronization)throw new Cr(kr.FAILED_PRECONDITION,Pu);return!1}}return!(!e.networkEnabled||!e.inForeground)||Mu(t).Nt().next(function(t){return void 0===e.rn(t,5e3).find(function(t){return!(e.clientId===t.clientId||!(!e.networkEnabled&&t.networkEnabled||!e.inForeground&&t.inForeground&&e.networkEnabled===t.networkEnabled))})})}).next(function(t){return e.isPrimary!==t&&Pr("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},t.prototype.shutdown=function(){return Object(b.b)(this,void 0,void 0,function(){var t=this;return Object(b.d)(this,function(e){switch(e.label){case 0:return this.xe=!1,this.un(),this.$e&&(this.$e.cancel(),this.$e=null),this.an(),this.hn(),[4,this.Be.runTransaction("shutdown","readwrite",[aa.store,ba.store],function(e){var n=new La(e,jr.o);return t.Xe(n).next(function(){return t.en(n)})})];case 1:return e.sent(),this.Be.close(),this.ln(),[2]}})})},t.prototype.rn=function(t,e){var n=this;return t.filter(function(t){return n.sn(t.updateTimeMs,e)&&!n.cn(t.clientId)})},t.prototype.fn=function(){var t=this;return this.runTransaction("getActiveClients","readonly",function(e){return Mu(e).Nt().next(function(e){return t.rn(e,18e5).map(function(t){return t.clientId})})})},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.getMutationQueue=function(t){return cu.Qt(t,this.R,this.Ut,this.referenceDelegate)},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getBundleCache=function(){return this.Ke},t.prototype.runTransaction=function(t,e,n){var r,i=this;return Pr("IndexedDbPersistence","Starting transaction:",t),this.Be.runTransaction(t,"readonly"===e?"readonly":"readwrite",Ta,function(o){return r=new La(o,i.Ne?i.Ne.next():jr.o),"readwrite-primary"===e?i.Je(r).next(function(t){return!!t||i.Ye(r)}).next(function(e){if(!e)throw Lr("Failed to obtain primary lease for action '"+t+"'."),i.isPrimary=!1,i.Se.enqueueRetryable(function(){return i.Me(!1)}),new Cr(kr.FAILED_PRECONDITION,Ea);return n(r)}).next(function(t){return i.Ze(r).next(function(){return t})}):i.dn(r).next(function(){return n(r)})}).then(function(t){return r.raiseOnCommittedEvent(),t})},t.prototype.dn=function(t){var e=this;return Fu(t).get(aa.key).next(function(t){if(null!==t&&e.sn(t.leaseTimestampMs,5e3)&&!e.cn(t.ownerId)&&!e.tn(t)&&!(e.Ce||e.allowTabSynchronization&&t.allowTabSynchronization))throw new Cr(kr.FAILED_PRECONDITION,Pu)})},t.prototype.Ze=function(t){var e=new aa(this.clientId,this.allowTabSynchronization,Date.now());return Fu(t).put(aa.key,e)},t.yt=function(){return Na.yt()},t.prototype.Xe=function(t){var e=this,n=Fu(t);return n.get(aa.key).next(function(t){return e.tn(t)?(Pr("IndexedDbPersistence","Releasing primary lease."),n.delete(aa.key)):Sa.resolve()})},t.prototype.sn=function(t,e){var n=Date.now();return!(t<n-e||t>n&&(Lr("Detected an update time that is in the future: "+t+" > "+n),1))},t.prototype.We=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ke=function(){t.Se.enqueueAndForget(function(){return t.inForeground="visible"===t.document.visibilityState,t.je()})},this.document.addEventListener("visibilitychange",this.ke),this.inForeground="visible"===this.document.visibilityState)},t.prototype.an=function(){this.ke&&(this.document.removeEventListener("visibilitychange",this.ke),this.ke=null)},t.prototype.Ge=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Fe=function(){e.un(),Object(w.q)()&&navigator.appVersion.match("Version/14")&&e.Se.enterRestrictedMode(!0),e.Se.enqueueAndForget(function(){return e.shutdown()})},this.window.addEventListener("pagehide",this.Fe))},t.prototype.hn=function(){this.Fe&&(this.window.removeEventListener("pagehide",this.Fe),this.Fe=null)},t.prototype.cn=function(t){var e;try{var n=null!==(null===(e=this.Qe)||void 0===e?void 0:e.getItem(this.on(t)));return Pr("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(t){return Lr("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},t.prototype.un=function(){if(this.Qe)try{this.Qe.setItem(this.on(this.clientId),String(Date.now()))}catch(t){Lr("Failed to set zombie client id.",t)}},t.prototype.ln=function(){if(this.Qe)try{this.Qe.removeItem(this.on(this.clientId))}catch(t){}},t.prototype.on=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t}();function Fu(t){return Fa(t,aa.store)}function Mu(t){return Fa(t,ba.store)}function Vu(t,e){var n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var qu=function(t,e){this.progress=t,this.wn=e},Uu=function(){function t(t,e,n){this.Ue=t,this._n=e,this.Ut=n}return t.prototype.mn=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKey(t,e).next(function(r){return n.yn(t,e,r)})},t.prototype.yn=function(t,e,n){return this.Ue.getEntry(t,e).next(function(t){for(var e=0,r=n;e<r.length;e++)r[e].applyToLocalView(t);return t})},t.prototype.gn=function(t,e){t.forEach(function(t,n){for(var r=0,i=e;r<i.length;r++)i[r].applyToLocalView(n)})},t.prototype.pn=function(t,e){var n=this;return this.Ue.getEntries(t,e).next(function(e){return n.En(t,e).next(function(){return e})})},t.prototype.En=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKeys(t,e).next(function(t){return n.gn(e,t)})},t.prototype.getDocumentsMatchingQuery=function(t,e,n){return function(t){return pi.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.Tn(t,e.path):oo(e)?this.In(t,e,n):this.An(t,e,n)},t.prototype.Tn=function(t,e){return this.mn(t,new pi(e)).next(function(t){var e=as();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e})},t.prototype.In=function(t,e,n){var r=this,i=e.collectionGroup,o=as();return this.Ut.getCollectionParents(t,i).next(function(s){return Sa.forEach(s,function(s){var a=function(t,e){return new Ji(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,s.child(i));return r.An(t,a,n).next(function(t){t.forEach(function(t,e){o=o.insert(t,e)})})}).next(function(){return o})})},t.prototype.An=function(t,e,n){var r,i,o=this;return this.Ue.getDocumentsMatchingQuery(t,e,n).next(function(n){return r=n,o._n.getAllMutationBatchesAffectingQuery(t,e)}).next(function(e){return o.Rn(t,i=e,r).next(function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],s=0,a=o.mutations;s<a.length;s++){var u=a[s],c=u.key,h=r.get(c);null==h&&(h=ki.newInvalidDocument(c),r=r.insert(c,h)),Fo(u,h,o.localWriteTime),h.isFoundDocument()||(r=r.remove(c))}})}).next(function(){return r.forEach(function(t,n){fo(e,n)||(r=r.remove(t))}),r})},t.prototype.Rn=function(t,e,n){for(var r=ls(),i=0,o=e;i<o.length;i++)for(var s=0,a=o[i].mutations;s<a.length;s++){var u=a[s];u instanceof Bo&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.Ue.getEntries(t,r).next(function(t){return t.forEach(function(t,e){e.isFoundDocument()&&(c=c.insert(t,e))}),c})},t}(),Bu=function(){function t(t,e,n,r){this.targetId=t,this.fromCache=e,this.bn=n,this.vn=r}return t.Pn=function(e,n){for(var r=ls(),i=ls(),o=0,s=n.docChanges;o<s.length;o++){var a=s[o];switch(a.type){case 0:r=r.add(a.doc.key);break;case 1:i=i.add(a.doc.key)}}return new t(e,n.fromCache,r,i)},t}(),Ku=function(){function t(){}return t.prototype.Vn=function(t){this.Sn=t},t.prototype.getDocumentsMatchingQuery=function(t,e,n,r){var i=this;return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}(e)||n.isEqual(Wr.min())?this.Dn(t,e):this.Sn.pn(t,r).next(function(o){var s=i.Cn(e,o);return(eo(e)||no(e))&&i.Nn(e.limitType,s,r,n)?i.Dn(t,e):(Rr()<=I.a.DEBUG&&Pr("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),lo(e)),i.Sn.getDocumentsMatchingQuery(t,e,n).next(function(t){return s.forEach(function(e){t=t.insert(e.key,e)}),t}))})},t.prototype.Cn=function(t,e){var n=new ns(po(t));return e.forEach(function(e,r){fo(t,r)&&(n=n.add(r))}),n},t.prototype.Nn=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)},t.prototype.Dn=function(t,e){return Rr()<=I.a.DEBUG&&Pr("QueryEngine","Using full collection scan to execute query:",lo(e)),this.Sn.getDocumentsMatchingQuery(t,e,Wr.min())},t}(),Gu=function(){function t(t,e,n,r){this.persistence=t,this.xn=e,this.R=r,this.Fn=new Zo(Gr),this.kn=new Su(function(t){return Ri(t)},Pi),this.$n=Wr.min(),this._n=t.getMutationQueue(n),this.On=t.getRemoteDocumentCache(),this.qe=t.getTargetCache(),this.Mn=new Uu(this.On,this._n,this.persistence.getIndexManager()),this.Ke=t.getBundleCache(),this.xn.Vn(this.Mn)}return t.prototype.collectGarbage=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(n){return t.collect(n,e.Fn)})},t}();function Qu(t,e,n,r){return new Gu(t,e,n,r)}function zu(t,e){return Object(b.b)(this,void 0,void 0,function(){var n,r,i,o;return Object(b.d)(this,function(s){switch(s.label){case 0:return n=Ur(t),r=n._n,i=n.Mn,[4,n.persistence.runTransaction("Handle user change","readonly",function(t){var o;return n._n.getAllMutationBatches(t).next(function(s){return o=s,r=n.persistence.getMutationQueue(e),i=new Uu(n.On,r,n.persistence.getIndexManager()),r.getAllMutationBatches(t)}).next(function(e){for(var n=[],r=[],s=ls(),a=0,u=o;a<u.length;a++){var c=u[a];n.push(c.batchId);for(var h=0,l=c.mutations;h<l.length;h++)s=s.add(l[h].key)}for(var f=0,d=e;f<d.length;f++){var p=d[f];r.push(p.batchId);for(var y=0,g=p.mutations;y<g.length;y++)s=s.add(g[y].key)}return i.pn(t,s).next(function(t){return{Ln:t,removedBatchIds:n,addedBatchIds:r}})})})];case 1:return o=s.sent(),[2,(n._n=r,n.Mn=i,n.xn.Vn(n.Mn),o)]}})})}function Hu(t,e){var n=Ur(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var r=e.batch.keys(),i=n.On.newChangeBuffer({trackRemovals:!0});return function(t,e,n,r){var i=n.batch,o=i.keys(),s=Sa.resolve();return o.forEach(function(t){s=s.next(function(){return r.getEntry(e,t)}).next(function(e){var o=n.docVersions.get(t);qr(null!==o),e.version.compareTo(o)<0&&(i.applyToRemoteDocument(e,n),e.isValidDocument()&&r.addEntry(e,n.commitVersion))})}),s.next(function(){return t._n.removeMutationBatch(e,i)})}(n,t,e,i).next(function(){return i.apply(t)}).next(function(){return n._n.performConsistencyCheck(t)}).next(function(){return n.Mn.pn(t,r)})})}function Wu(t){var e=Ur(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.qe.getLastRemoteSnapshotVersion(t)})}function Yu(t,e){var n=Ur(t),r=e.snapshotVersion,i=n.Fn;return n.persistence.runTransaction("Apply remote event","readwrite-primary",function(t){var o=n.On.newChangeBuffer({trackRemovals:!0});i=n.Fn;var s=[];e.targetChanges.forEach(function(e,o){var a=i.get(o);if(a){s.push(n.qe.removeMatchingKeys(t,e.removedDocuments,o).next(function(){return n.qe.addMatchingKeys(t,e.addedDocuments,o)}));var u=e.resumeToken;if(u.approximateByteSize()>0){var c=a.withResumeToken(u,r).withSequenceNumber(t.currentSequenceNumber);i=i.insert(o,c),function(t,e,n){return qr(e.resumeToken.approximateByteSize()>0),0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(a,c,e)&&s.push(n.qe.updateTargetData(t,c))}}});var a=os();if(e.documentUpdates.forEach(function(r,i){e.resolvedLimboDocuments.has(r)&&s.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))}),s.push(Xu(t,o,e.documentUpdates,r,void 0).next(function(t){a=t})),!r.isEqual(Wr.min())){var u=n.qe.getLastRemoteSnapshotVersion(t).next(function(e){return n.qe.setTargetsMetadata(t,t.currentSequenceNumber,r)});s.push(u)}return Sa.waitFor(s).next(function(){return o.apply(t)}).next(function(){return n.Mn.En(t,a)}).next(function(){return a})}).then(function(t){return n.Fn=i,t})}function Xu(t,e,n,r,i){var o=ls();return n.forEach(function(t){return o=o.add(t)}),e.getEntries(t,o).next(function(t){var o=os();return n.forEach(function(n,s){var a=t.get(n),u=(null==i?void 0:i.get(n))||r;s.isNoDocument()&&s.version.isEqual(Wr.min())?(e.removeEntry(n,u),o=o.insert(n,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(e.addEntry(s,u),o=o.insert(n,s)):Pr("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",s.version)}),o})}function $u(t,e){var n=Ur(t);return n.persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===e&&(e=-1),n._n.getNextMutationBatchAfterBatchId(t,e)})}function Ju(t,e){var n=Ur(t);return n.persistence.runTransaction("Allocate target","readwrite",function(t){var r;return n.qe.getTargetData(t,e).next(function(i){return i?Sa.resolve(r=i):n.qe.allocateTargetId(t).next(function(i){return r=new qa(e,i,0,t.currentSequenceNumber),n.qe.addTargetData(t,r).next(function(){return r})})})}).then(function(t){var r=n.Fn.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Fn=n.Fn.insert(t.targetId,t),n.kn.set(e,t.targetId)),t})}function Zu(t,e,n){return Object(b.b)(this,void 0,void 0,function(){var r,i,o,s;return Object(b.d)(this,function(a){switch(a.label){case 0:r=Ur(t),i=r.Fn.get(e),o=n?"readwrite":"readwrite-primary",a.label=1;case 1:return a.trys.push([1,4,,5]),n?[3,3]:[4,r.persistence.runTransaction("Release target",o,function(t){return r.persistence.referenceDelegate.removeTarget(t,i)})];case 2:a.sent(),a.label=3;case 3:return[3,5];case 4:if(!ka(s=a.sent()))throw s;return Pr("LocalStore","Failed to update sequence numbers for target "+e+": "+s),[3,5];case 5:return r.Fn=r.Fn.remove(e),r.kn.delete(i.target),[2]}})})}function tc(t,e,n){var r=Ur(t),i=Wr.min(),o=ls();return r.persistence.runTransaction("Execute query","readonly",function(t){return function(t,e,n){var r=Ur(t),i=r.kn.get(n);return void 0!==i?Sa.resolve(r.Fn.get(i)):r.qe.getTargetData(e,n)}(r,t,ao(e)).next(function(e){if(e)return i=e.lastLimboFreeSnapshotVersion,r.qe.getMatchingKeysForTargetId(t,e.targetId).next(function(t){o=t})}).next(function(){return r.xn.getDocumentsMatchingQuery(t,e,n?i:Wr.min(),n?o:ls())}).next(function(t){return{documents:t,Bn:o}})})}function ec(t,e){var n=Ur(t),r=Ur(n.qe),i=n.Fn.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",function(t){return r.lt(t,e).next(function(t){return t?t.target:null})})}function nc(t){var e=Ur(t);return e.persistence.runTransaction("Get new document changes","readonly",function(t){return function(t,e,n){var r=Ur(t),i=os(),o=Ga(n),s=ku(e),a=IDBKeyRange.lowerBound(o,!0);return s.$t({index:da.readTimeIndex,range:a},function(t,e){var n=Ba(r.R,e);i=i.insert(n.key,n),o=e.readTime}).next(function(){return{wn:i,readTime:Qa(o)}})}(e.On,t,e.$n)}).then(function(t){var n=t.wn;return e.$n=t.readTime,n})}function rc(t){return Object(b.b)(this,void 0,void 0,function(){var e;return Object(b.d)(this,function(n){return[2,(e=Ur(t)).persistence.runTransaction("Synchronize last document change read time","readonly",function(t){return function(t){var e=ku(t),n=Wr.min();return e.$t({index:da.readTimeIndex,reverse:!0},function(t,e,r){e.readTime&&(n=Qa(e.readTime)),r.done()}).next(function(){return n})}(t)}).then(function(t){e.$n=t})]})})}function ic(t,e,n,r){return Object(b.b)(this,void 0,void 0,function(){var i,o,s,a,u,c,h,l,f,d;return Object(b.d)(this,function(p){switch(p.label){case 0:for(i=Ur(t),o=ls(),s=os(),a=cs(),u=0,c=n;u<c.length;u++)l=e.qn((h=c[u]).metadata.name),h.document&&(o=o.add(l)),s=s.insert(l,e.Un(h)),a=a.insert(l,e.Kn(h.metadata.readTime));return f=i.On.newChangeBuffer({trackRemovals:!0}),[4,Ju(i,function(t){return ao(to(Zr.fromString("__bundle__/docs/"+t)))}(r))];case 1:return d=p.sent(),[2,i.persistence.runTransaction("Apply bundle documents","readwrite",function(t){return Xu(t,f,s,Wr.min(),a).next(function(e){return f.apply(t),e}).next(function(e){return i.qe.removeMatchingKeysForTargetId(t,d.targetId).next(function(){return i.qe.addMatchingKeys(t,o,d.targetId)}).next(function(){return i.Mn.En(t,e)}).next(function(){return e})})})]}})})}function oc(t,e,n){return void 0===n&&(n=ls()),Object(b.b)(this,void 0,void 0,function(){var r,i;return Object(b.d)(this,function(o){switch(o.label){case 0:return[4,Ju(t,ao($a(e.bundledQuery)))];case 1:return r=o.sent(),[2,(i=Ur(t)).persistence.runTransaction("Save named query","readwrite",function(t){var o=As(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return i.Ke.saveNamedQuery(t,e);var s=r.withResumeToken(ri.EMPTY_BYTE_STRING,o);return i.Fn=i.Fn.insert(s.targetId,s),i.qe.updateTargetData(t,s).next(function(){return i.qe.removeMatchingKeysForTargetId(t,r.targetId)}).next(function(){return i.qe.addMatchingKeys(t,n,r.targetId)}).next(function(){return i.Ke.saveNamedQuery(t,e)})})]}})})}var sc=function(){function t(t){this.R=t,this.Qn=new Map,this.jn=new Map}return t.prototype.getBundleMetadata=function(t,e){return Sa.resolve(this.Qn.get(e))},t.prototype.saveBundleMetadata=function(t,e){var n;return this.Qn.set(e.id,{id:(n=e).id,version:n.version,createTime:As(n.createTime)}),Sa.resolve()},t.prototype.getNamedQuery=function(t,e){return Sa.resolve(this.jn.get(e))},t.prototype.saveNamedQuery=function(t,e){return this.jn.set(e.name,function(t){return{name:t.name,query:$a(t.bundledQuery),readTime:As(t.readTime)}}(e)),Sa.resolve()},t}(),ac=function(){function t(){this.Wn=new ns(uc.Gn),this.zn=new ns(uc.Hn)}return t.prototype.isEmpty=function(){return this.Wn.isEmpty()},t.prototype.addReference=function(t,e){var n=new uc(t,e);this.Wn=this.Wn.add(n),this.zn=this.zn.add(n)},t.prototype.Jn=function(t,e){var n=this;t.forEach(function(t){return n.addReference(t,e)})},t.prototype.removeReference=function(t,e){this.Yn(new uc(t,e))},t.prototype.Xn=function(t,e){var n=this;t.forEach(function(t){return n.removeReference(t,e)})},t.prototype.Zn=function(t){var e=this,n=new pi(new Zr([])),r=new uc(n,t),i=new uc(n,t+1),o=[];return this.zn.forEachInRange([r,i],function(t){e.Yn(t),o.push(t.key)}),o},t.prototype.ts=function(){var t=this;this.Wn.forEach(function(e){return t.Yn(e)})},t.prototype.Yn=function(t){this.Wn=this.Wn.delete(t),this.zn=this.zn.delete(t)},t.prototype.es=function(t){var e=new pi(new Zr([])),n=new uc(e,t),r=new uc(e,t+1),i=ls();return this.zn.forEachInRange([n,r],function(t){i=i.add(t.key)}),i},t.prototype.containsKey=function(t){var e=new uc(t,0),n=this.Wn.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},t}(),uc=function(){function t(t,e){this.key=t,this.ns=e}return t.Gn=function(t,e){return pi.comparator(t.key,e.key)||Gr(t.ns,e.ns)},t.Hn=function(t,e){return Gr(t.ns,e.ns)||pi.comparator(t.key,e.key)},t}(),cc=function(){function t(t,e){this.Ut=t,this.referenceDelegate=e,this._n=[],this.ss=1,this.rs=new ns(uc.Gn)}return t.prototype.checkEmpty=function(t){return Sa.resolve(0===this._n.length)},t.prototype.addMutationBatch=function(t,e,n,r){var i=this.ss;this.ss++;var o=new Ma(i,e,n,r);this._n.push(o);for(var s=0,a=r;s<a.length;s++){var u=a[s];this.rs=this.rs.add(new uc(u.key,i)),this.Ut.addToCollectionParentIndex(t,u.key.path.popLast())}return Sa.resolve(o)},t.prototype.lookupMutationBatch=function(t,e){return Sa.resolve(this.os(e))},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this.cs(e+1),r=n<0?0:n;return Sa.resolve(this._n.length>r?this._n[r]:null)},t.prototype.getHighestUnacknowledgedBatchId=function(){return Sa.resolve(0===this._n.length?-1:this.ss-1)},t.prototype.getAllMutationBatches=function(t){return Sa.resolve(this._n.slice())},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new uc(e,0),i=new uc(e,Number.POSITIVE_INFINITY),o=[];return this.rs.forEachInRange([r,i],function(t){var e=n.os(t.ns);o.push(e)}),Sa.resolve(o)},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new ns(Gr);return e.forEach(function(t){var e=new uc(t,0),i=new uc(t,Number.POSITIVE_INFINITY);n.rs.forEachInRange([e,i],function(t){r=r.add(t.ns)})}),Sa.resolve(this.us(r))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=e.path,r=n.length+1,i=n;pi.isDocumentKey(i)||(i=i.child(""));var o=new uc(new pi(i),0),s=new ns(Gr);return this.rs.forEachWhile(function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(s=s.add(t.ns)),!0)},o),Sa.resolve(this.us(s))},t.prototype.us=function(t){var e=this,n=[];return t.forEach(function(t){var r=e.os(t);null!==r&&n.push(r)}),n},t.prototype.removeMutationBatch=function(t,e){var n=this;qr(0===this.hs(e.batchId,"removed")),this._n.shift();var r=this.rs;return Sa.forEach(e.mutations,function(i){var o=new uc(i.key,e.batchId);return r=r.delete(o),n.referenceDelegate.markPotentiallyOrphaned(t,i.key)}).next(function(){n.rs=r})},t.prototype.Gt=function(t){},t.prototype.containsKey=function(t,e){var n=new uc(e,0),r=this.rs.firstAfterOrEqual(n);return Sa.resolve(e.isEqual(r&&r.key))},t.prototype.performConsistencyCheck=function(t){return Sa.resolve()},t.prototype.hs=function(t,e){return this.cs(t)},t.prototype.cs=function(t){return 0===this._n.length?0:t-this._n[0].batchId},t.prototype.os=function(t){var e=this.cs(t);return e<0||e>=this._n.length?null:this._n[e]},t}(),hc=function(){function t(t,e){this.Ut=t,this.ls=e,this.docs=new Zo(pi.comparator),this.size=0}return t.prototype.addEntry=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.ls(e);return this.docs=this.docs.insert(r,{document:e.clone(),size:s,readTime:n}),this.size+=s-o,this.Ut.addToCollectionParentIndex(t,r.path.popLast())},t.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},t.prototype.getEntry=function(t,e){var n=this.docs.get(e);return Sa.resolve(n?n.document.clone():ki.newInvalidDocument(e))},t.prototype.getEntries=function(t,e){var n=this,r=os();return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.document.clone():ki.newInvalidDocument(t))}),Sa.resolve(r)},t.prototype.getDocumentsMatchingQuery=function(t,e,n){for(var r=os(),i=new pi(e.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var s=o.getNext(),a=s.value,u=a.document,c=a.readTime;if(!e.path.isPrefixOf(s.key.path))break;c.compareTo(n)<=0||fo(e,u)&&(r=r.insert(u.key,u.clone()))}return Sa.resolve(r)},t.prototype.fs=function(t,e){return Sa.forEach(this.docs,function(t){return e(t)})},t.prototype.newChangeBuffer=function(t){return new lc(this)},t.prototype.getSize=function(t){return Sa.resolve(this.size)},t}(),lc=function(t){function e(e){var n=this;return(n=t.call(this)||this).Ie=e,n}return Object(b.c)(e,t),e.prototype.applyChanges=function(t){var e=this,n=[];return this.changes.forEach(function(r,i){i.document.isValidDocument()?n.push(e.Ie.addEntry(t,i.document,e.getReadTime(r))):e.Ie.removeEntry(r)}),Sa.waitFor(n)},e.prototype.getFromCache=function(t,e){return this.Ie.getEntry(t,e)},e.prototype.getAllFromCache=function(t,e){return this.Ie.getEntries(t,e)},e}(Du),fc=function(){function t(t){this.persistence=t,this.ds=new Su(function(t){return Ri(t)},Pi),this.lastRemoteSnapshotVersion=Wr.min(),this.highestTargetId=0,this.ws=0,this._s=new ac,this.targetCount=0,this.ys=pu.Jt()}return t.prototype.forEachTarget=function(t,e){return this.ds.forEach(function(t,n){return e(n)}),Sa.resolve()},t.prototype.getLastRemoteSnapshotVersion=function(t){return Sa.resolve(this.lastRemoteSnapshotVersion)},t.prototype.getHighestSequenceNumber=function(t){return Sa.resolve(this.ws)},t.prototype.allocateTargetId=function(t){return this.highestTargetId=this.ys.next(),Sa.resolve(this.highestTargetId)},t.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.ws&&(this.ws=e),Sa.resolve()},t.prototype.te=function(t){this.ds.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.ys=new pu(e),this.highestTargetId=e),t.sequenceNumber>this.ws&&(this.ws=t.sequenceNumber)},t.prototype.addTargetData=function(t,e){return this.te(e),this.targetCount+=1,Sa.resolve()},t.prototype.updateTargetData=function(t,e){return this.te(e),Sa.resolve()},t.prototype.removeTargetData=function(t,e){return this.ds.delete(e.target),this._s.Zn(e.targetId),this.targetCount-=1,Sa.resolve()},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return this.ds.forEach(function(s,a){a.sequenceNumber<=e&&null===n.get(a.targetId)&&(r.ds.delete(s),o.push(r.removeMatchingKeysForTargetId(t,a.targetId)),i++)}),Sa.waitFor(o).next(function(){return i})},t.prototype.getTargetCount=function(t){return Sa.resolve(this.targetCount)},t.prototype.getTargetData=function(t,e){var n=this.ds.get(e)||null;return Sa.resolve(n)},t.prototype.addMatchingKeys=function(t,e,n){return this._s.Jn(e,n),Sa.resolve()},t.prototype.removeMatchingKeys=function(t,e,n){this._s.Xn(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(function(e){i.push(r.markPotentiallyOrphaned(t,e))}),Sa.waitFor(i)},t.prototype.removeMatchingKeysForTargetId=function(t,e){return this._s.Zn(e),Sa.resolve()},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=this._s.es(e);return Sa.resolve(n)},t.prototype.containsKey=function(t,e){return Sa.resolve(this._s.containsKey(e))},t}(),dc=function(){function t(t,e){var n=this;this.gs={},this.Ne=new jr(0),this.xe=!1,this.xe=!0,this.referenceDelegate=t(this),this.qe=new fc(this),this.Ut=new eu,this.Ue=function(t,e){return new hc(t,function(t){return n.referenceDelegate.ps(t)})}(this.Ut),this.R=new Ua(e),this.Ke=new sc(this.R)}return t.prototype.start=function(){return Promise.resolve()},t.prototype.shutdown=function(){return this.xe=!1,Promise.resolve()},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.setDatabaseDeletedListener=function(){},t.prototype.setNetworkEnabled=function(){},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getMutationQueue=function(t){var e=this.gs[t.toKey()];return e||(e=new cc(this.Ut,this.referenceDelegate),this.gs[t.toKey()]=e),e},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getBundleCache=function(){return this.Ke},t.prototype.runTransaction=function(t,e,n){var r=this;Pr("MemoryPersistence","Starting transaction:",t);var i=new pc(this.Ne.next());return this.referenceDelegate.Es(),n(i).next(function(t){return r.referenceDelegate.Ts(i).next(function(){return t})}).toPromise().then(function(t){return i.raiseOnCommittedEvent(),t})},t.prototype.Is=function(t,e){return Sa.or(Object.values(this.gs).map(function(n){return function(){return n.containsKey(t,e)}}))},t}(),pc=function(t){function e(e){var n=this;return(n=t.call(this)||this).currentSequenceNumber=e,n}return Object(b.c)(e,t),e}(_a),yc=function(){function t(t){this.persistence=t,this.As=new ac,this.Rs=null}return t.bs=function(e){return new t(e)},Object.defineProperty(t.prototype,"vs",{get:function(){if(this.Rs)return this.Rs;throw Vr()},enumerable:!1,configurable:!0}),t.prototype.addReference=function(t,e,n){return this.As.addReference(n,e),this.vs.delete(n.toString()),Sa.resolve()},t.prototype.removeReference=function(t,e,n){return this.As.removeReference(n,e),this.vs.add(n.toString()),Sa.resolve()},t.prototype.markPotentiallyOrphaned=function(t,e){return this.vs.add(e.toString()),Sa.resolve()},t.prototype.removeTarget=function(t,e){var n=this;this.As.Zn(e.targetId).forEach(function(t){return n.vs.add(t.toString())});var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(function(t){t.forEach(function(t){return n.vs.add(t.toString())})}).next(function(){return r.removeTargetData(t,e)})},t.prototype.Es=function(){this.Rs=new Set},t.prototype.Ts=function(t){var e=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Sa.forEach(this.vs,function(r){var i=pi.fromPath(r);return e.Ps(t,i).next(function(t){t||n.removeEntry(i)})}).next(function(){return e.Rs=null,n.apply(t)})},t.prototype.updateLimboDocument=function(t,e){var n=this;return this.Ps(t,e).next(function(t){t?n.vs.delete(e.toString()):n.vs.add(e.toString())})},t.prototype.ps=function(t){return 0},t.prototype.Ps=function(t,e){var n=this;return Sa.or([function(){return Sa.resolve(n.As.containsKey(e))},function(){return n.persistence.getTargetCache().containsKey(t,e)},function(){return n.persistence.Is(t,e)}])},t}(),gc=function(){function t(t){this.uid=t}return t.prototype.isAuthenticated=function(){return null!=this.uid},t.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t}();function vc(t,e){return"firestore_clients_"+t+"_"+e}function mc(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.isAuthenticated()&&(r+="_"+e.uid),r}function bc(t,e){return"firestore_targets_"+t+"_"+e}gc.UNAUTHENTICATED=new gc(null),gc.GOOGLE_CREDENTIALS=new gc("google-credentials-uid"),gc.FIRST_PARTY=new gc("first-party-uid");var wc=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}return t.Vs=function(e,n,r){var i,o=JSON.parse(r),s="object"==typeof o&&-1!==["pending","acknowledged","rejected"].indexOf(o.state)&&(void 0===o.error||"object"==typeof o.error);return s&&o.error&&(s="string"==typeof o.error.message&&"string"==typeof o.error.code)&&(i=new Cr(o.error.code,o.error.message)),s?new t(e,n,o.state,i):(Lr("SharedClientState","Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Ic=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n}return t.Vs=function(e,n){var r,i=JSON.parse(n),o="object"==typeof i&&-1!==["not-current","current","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new Cr(i.error.code,i.error.message)),o?new t(e,i.state,r):(Lr("SharedClientState","Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Tc=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.Vs=function(e,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,o=ds(),s=0;i&&s<r.activeTargetIds.length;++s)i=di(r.activeTargetIds[s]),o=o.add(r.activeTargetIds[s]);return i?new t(e,o):(Lr("SharedClientState","Failed to parse client data for instance '"+e+"': "+n),null)},t}(),Ec=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.Vs=function(e){var n=JSON.parse(e);return"object"==typeof n&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new t(n.clientId,n.onlineState):(Lr("SharedClientState","Failed to parse online state: "+e),null)},t}(),_c=function(){function t(){this.activeTargetIds=ds()}return t.prototype.Ds=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.Cs=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.Ss=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),Oc=function(){function t(t,e,n,r,i){this.window=t,this.Se=e,this.persistenceKey=n,this.Ns=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.xs=this.Fs.bind(this),this.ks=new Zo(Gr),this.started=!1,this.$s=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Os=vc(this.persistenceKey,this.Ns),this.Ms=function(t){return"firestore_sequence_number_"+t}(this.persistenceKey),this.ks=this.ks.insert(this.Ns,new _c),this.Ls=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.Bs=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.qs=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.Us=function(t){return"firestore_online_state_"+t}(this.persistenceKey),this.Ks=function(t){return"firestore_bundle_loaded_"+t}(this.persistenceKey),this.window.addEventListener("storage",this.xs)}return t.yt=function(t){return!(!t||!t.localStorage)},t.prototype.start=function(){return Object(b.b)(this,void 0,void 0,function(){var t,e,n,r,i,o,s,a,u,c,h=this;return Object(b.d)(this,function(l){switch(l.label){case 0:return[4,this.syncEngine.fn()];case 1:for(t=l.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this.Ns&&(i=this.getItem(vc(this.persistenceKey,r)))&&(o=Tc.Vs(r,i))&&(this.ks=this.ks.insert(o.clientId,o));for(this.Qs(),(s=this.storage.getItem(this.Us))&&(a=this.js(s))&&this.Ws(a),u=0,c=this.$s;u<c.length;u++)this.Fs(c[u]);return this.$s=[],this.window.addEventListener("pagehide",function(){return h.shutdown()}),this.started=!0,[2]}})})},t.prototype.writeSequenceNumber=function(t){this.setItem(this.Ms,JSON.stringify(t))},t.prototype.getAllActiveQueryTargets=function(){return this.Gs(this.ks)},t.prototype.isActiveQueryTarget=function(t){var e=!1;return this.ks.forEach(function(n,r){r.activeTargetIds.has(t)&&(e=!0)}),e},t.prototype.addPendingMutation=function(t){this.zs(t,"pending")},t.prototype.updateMutationState=function(t,e,n){this.zs(t,e,n),this.Hs(t)},t.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(bc(this.persistenceKey,t));if(n){var r=Ic.Vs(t,n);r&&(e=r.state)}}return this.Js.Ds(t),this.Qs(),e},t.prototype.removeLocalQueryTarget=function(t){this.Js.Cs(t),this.Qs()},t.prototype.isLocalQueryTarget=function(t){return this.Js.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){this.removeItem(bc(this.persistenceKey,t))},t.prototype.updateQueryState=function(t,e,n){this.Ys(t,e,n)},t.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach(function(t){r.Hs(t)}),this.currentUser=t,n.forEach(function(t){r.addPendingMutation(t)})},t.prototype.setOnlineState=function(t){this.Xs(t)},t.prototype.notifyBundleLoaded=function(){this.Zs()},t.prototype.shutdown=function(){this.started&&(this.window.removeEventListener("storage",this.xs),this.removeItem(this.Os),this.started=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return Pr("SharedClientState","READ",t,e),e},t.prototype.setItem=function(t,e){Pr("SharedClientState","SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){Pr("SharedClientState","REMOVE",t),this.storage.removeItem(t)},t.prototype.Fs=function(t){var e=this,n=t;if(n.storageArea===this.storage){if(Pr("SharedClientState","EVENT",n.key,n.newValue),n.key===this.Os)return void Lr("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Se.enqueueRetryable(function(){return Object(b.b)(e,void 0,void 0,function(){var t,e,r,i,o,s;return Object(b.d)(this,function(a){if(this.started){if(null!==n.key)if(this.Ls.test(n.key)){if(null==n.newValue)return t=this.ti(n.key),[2,this.ei(t,null)];if(e=this.ni(n.key,n.newValue))return[2,this.ei(e.clientId,e)]}else if(this.Bs.test(n.key)){if(null!==n.newValue&&(r=this.si(n.key,n.newValue)))return[2,this.ii(r)]}else if(this.qs.test(n.key)){if(null!==n.newValue&&(i=this.ri(n.key,n.newValue)))return[2,this.oi(i)]}else if(n.key===this.Us){if(null!==n.newValue&&(o=this.js(n.newValue)))return[2,this.Ws(o)]}else if(n.key===this.Ms)(s=function(t){var e=jr.o;if(null!=t)try{var n=JSON.parse(t);qr("number"==typeof n),e=n}catch(t){Lr("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(n.newValue))!==jr.o&&this.sequenceNumberHandler(s);else if(n.key===this.Ks)return[2,this.syncEngine.ci()]}else this.$s.push(n);return[2]})})})}},Object.defineProperty(t.prototype,"Js",{get:function(){return this.ks.get(this.Ns)},enumerable:!1,configurable:!0}),t.prototype.Qs=function(){this.setItem(this.Os,this.Js.Ss())},t.prototype.zs=function(t,e,n){var r=new wc(this.currentUser,t,e,n),i=mc(this.persistenceKey,this.currentUser,t);this.setItem(i,r.Ss())},t.prototype.Hs=function(t){var e=mc(this.persistenceKey,this.currentUser,t);this.removeItem(e)},t.prototype.Xs=function(t){this.storage.setItem(this.Us,JSON.stringify({clientId:this.Ns,onlineState:t}))},t.prototype.Ys=function(t,e,n){var r=bc(this.persistenceKey,t),i=new Ic(t,e,n);this.setItem(r,i.Ss())},t.prototype.Zs=function(){this.setItem(this.Ks,"value-not-used")},t.prototype.ti=function(t){var e=this.Ls.exec(t);return e?e[1]:null},t.prototype.ni=function(t,e){var n=this.ti(t);return Tc.Vs(n,e)},t.prototype.si=function(t,e){var n=this.Bs.exec(t),r=Number(n[1]);return wc.Vs(new gc(void 0!==n[2]?n[2]:null),r,e)},t.prototype.ri=function(t,e){var n=this.qs.exec(t),r=Number(n[1]);return Ic.Vs(r,e)},t.prototype.js=function(t){return Ec.Vs(t)},t.prototype.ii=function(t){return Object(b.b)(this,void 0,void 0,function(){return Object(b.d)(this,function(e){return t.user.uid===this.currentUser.uid?[2,this.syncEngine.ui(t.batchId,t.state,t.error)]:(Pr("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])})})},t.prototype.oi=function(t){return this.syncEngine.ai(t.targetId,t.state,t.error)},t.prototype.ei=function(t,e){var n=this,r=e?this.ks.insert(t,e):this.ks.remove(t),i=this.Gs(this.ks),o=this.Gs(r),s=[],a=[];return o.forEach(function(t){i.has(t)||s.push(t)}),i.forEach(function(t){o.has(t)||a.push(t)}),this.syncEngine.hi(s,a).then(function(){n.ks=r})},t.prototype.Ws=function(t){this.ks.get(t.clientId)&&this.onlineStateHandler(t.onlineState)},t.prototype.Gs=function(t){var e=ds();return t.forEach(function(t,n){e=e.unionWith(n.activeTargetIds)}),e},t}(),Sc=function(){function t(){this.li=new _c,this.fi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return t.prototype.addPendingMutation=function(t){},t.prototype.updateMutationState=function(t,e,n){},t.prototype.addLocalQueryTarget=function(t){return this.li.Ds(t),this.fi[t]||"not-current"},t.prototype.updateQueryState=function(t,e,n){this.fi[t]=e},t.prototype.removeLocalQueryTarget=function(t){this.li.Cs(t)},t.prototype.isLocalQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){delete this.fi[t]},t.prototype.getAllActiveQueryTargets=function(){return this.li.activeTargetIds},t.prototype.isActiveQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.start=function(){return this.li=new _c,Promise.resolve()},t.prototype.handleUserChange=function(t,e,n){},t.prototype.setOnlineState=function(t){},t.prototype.shutdown=function(){},t.prototype.writeSequenceNumber=function(t){},t.prototype.notifyBundleLoaded=function(){},t}(),Dc=function(){function t(){}return t.prototype.di=function(t){},t.prototype.shutdown=function(){},t}(),Nc=function(){function t(){var t=this;this.wi=function(){return t._i()},this.mi=function(){return t.yi()},this.gi=[],this.pi()}return t.prototype.di=function(t){this.gi.push(t)},t.prototype.shutdown=function(){window.removeEventListener("online",this.wi),window.removeEventListener("offline",this.mi)},t.prototype.pi=function(){window.addEventListener("online",this.wi),window.addEventListener("offline",this.mi)},t.prototype._i=function(){Pr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(0)},t.prototype.yi=function(){Pr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(1)},t.yt=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),Ac={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},jc=function(){function t(t){this.Ei=t.Ei,this.Ti=t.Ti}return t.prototype.Ii=function(t){this.Ai=t},t.prototype.Ri=function(t){this.bi=t},t.prototype.onMessage=function(t){this.vi=t},t.prototype.close=function(){this.Ti()},t.prototype.send=function(t){this.Ei(t)},t.prototype.Pi=function(){this.Ai()},t.prototype.Vi=function(t){this.bi(t)},t.prototype.Si=function(t){this.vi(t)},t}(),kc=function(t){function e(e){var n=this;return(n=t.call(this,e)||this).forceLongPolling=e.forceLongPolling,n.autoDetectLongPolling=e.autoDetectLongPolling,n.useFetchStreams=e.useFetchStreams,n}return Object(b.c)(e,t),e.prototype.ki=function(t,e,n,r){return new Promise(function(i,o){var s=new Ar;s.listenOnce(Or.COMPLETE,function(){try{switch(s.getLastErrorCode()){case _r.NO_ERROR:var e=s.getResponseJson();Pr("Connection","XHR received:",JSON.stringify(e)),i(e);break;case _r.TIMEOUT:Pr("Connection",'RPC "'+t+'" timed out'),o(new Cr(kr.DEADLINE_EXCEEDED,"Request time out"));break;case _r.HTTP_ERROR:var n=s.getStatus();if(Pr("Connection",'RPC "'+t+'" failed with status:',n,"response text:",s.getResponseText()),n>0){var r=s.getResponseJson().error;if(r&&r.status&&r.message){var a=function(t){var e=t.toLowerCase().replace(/_/g,"-");return Object.values(kr).indexOf(e)>=0?e:kr.UNKNOWN}(r.status);o(new Cr(a,r.message))}else o(new Cr(kr.UNKNOWN,"Server responded with status "+s.getStatus()))}else o(new Cr(kr.UNAVAILABLE,"Connection failed."));break;default:Vr()}}finally{Pr("Connection",'RPC "'+t+'" completed.')}});var a=JSON.stringify(r);s.send(e,"POST",a,n,15)})},e.prototype.Oi=function(t,e){var n=[this.Di,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=new br,i=fe(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new Dr({})),this.Fi(o.initMessageHeaders,e),Object(w.n)()||Object(w.p)()||Object(w.l)()||Object(w.m)()||Object(w.r)()||Object(w.k)()||(o.httpHeadersOverwriteParam="$httpHeaders");var s=n.join("");Pr("Connection","Creating WebChannel: "+s,o);var a=r.createWebChannel(s,o),u=!1,c=!1,h=new jc({Ei:function(t){c?Pr("Connection","Not sending because WebChannel is closed:",t):(u||(Pr("Connection","Opening WebChannel transport."),a.open(),u=!0),Pr("Connection","WebChannel sending:",t),a.send(t))},Ti:function(){return a.close()}}),l=function(t,e,n){t.listen(e,function(t){try{n(t)}catch(t){setTimeout(function(){throw t},0)}})};return l(a,Nr.EventType.OPEN,function(){c||Pr("Connection","WebChannel transport opened.")}),l(a,Nr.EventType.CLOSE,function(){c||(c=!0,Pr("Connection","WebChannel transport closed"),h.Vi())}),l(a,Nr.EventType.ERROR,function(t){c||(c=!0,Fr("Connection","WebChannel transport errored:",t),h.Vi(new Cr(kr.UNAVAILABLE,"The operation could not be completed")))}),l(a,Nr.EventType.MESSAGE,function(t){var e;if(!c){var n=t.data[0];qr(!!n);var r=n.error||(null===(e=n[0])||void 0===e?void 0:e.error);if(r){Pr("Connection","WebChannel received error:",r);var i=r.status,o=function(t){var e=zo[t];if(void 0!==e)return Jo(e)}(i),s=r.message;void 0===o&&(o=kr.INTERNAL,s="Unknown error status: "+i+" with message "+r.message),c=!0,h.Vi(new Cr(o,s)),a.close()}else Pr("Connection","WebChannel received:",n),h.Si(n)}}),l(i,Sr.STAT_EVENT,function(t){10===t.stat?Pr("Connection","Detected buffering proxy"):11===t.stat&&Pr("Connection","Detected no buffering proxy")}),setTimeout(function(){h.Pi()},0),h},e}(function(){function t(t){this.databaseInfo=t,this.databaseId=t.databaseId,this.Di=(t.ssl?"https":"http")+"://"+t.host,this.Ci="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}return t.prototype.Ni=function(t,e,n,r){var i=this.xi(t,e);Pr("RestConnection","Sending: ",i,n);var o={};return this.Fi(o,r),this.ki(t,i,o,n).then(function(t){return Pr("RestConnection","Received: ",t),t},function(e){throw Fr("RestConnection",t+" failed with error: ",e,"url: ",i,"request:",n),e})},t.prototype.$i=function(t,e,n,r){return this.Ni(t,e,n,r)},t.prototype.Fi=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.8.0",t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n])},t.prototype.xi=function(t,e){return this.Di+"/v1/"+e+":"+Ac[t]},t}());function Cc(){return"undefined"!=typeof window?window:null}function xc(){return"undefined"!=typeof document?document:null}function Rc(t){return new Os(t,!0)}var Pc=function(){function t(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Se=t,this.timerId=e,this.Mi=n,this.Li=r,this.Bi=i,this.qi=0,this.Ui=null,this.Ki=Date.now(),this.reset()}return t.prototype.reset=function(){this.qi=0},t.prototype.Qi=function(){this.qi=this.Bi},t.prototype.ji=function(t){var e=this;this.cancel();var n=Math.floor(this.qi+this.Wi()),r=Math.max(0,Date.now()-this.Ki),i=Math.max(0,n-r);i>0&&Pr("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.qi+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Ui=this.Se.enqueueAfterDelay(this.timerId,i,function(){return e.Ki=Date.now(),t()}),this.qi*=this.Li,this.qi<this.Mi&&(this.qi=this.Mi),this.qi>this.Bi&&(this.qi=this.Bi)},t.prototype.Gi=function(){null!==this.Ui&&(this.Ui.skipDelay(),this.Ui=null)},t.prototype.cancel=function(){null!==this.Ui&&(this.Ui.cancel(),this.Ui=null)},t.prototype.Wi=function(){return(Math.random()-.5)*this.qi},t}(),Lc=function(){function t(t,e,n,r,i,o){this.Se=t,this.zi=n,this.Hi=r,this.Ji=i,this.listener=o,this.state=0,this.Yi=0,this.Xi=null,this.stream=null,this.Zi=new Pc(t,e)}return t.prototype.tr=function(){return 1===this.state||2===this.state||4===this.state},t.prototype.er=function(){return 2===this.state},t.prototype.start=function(){3!==this.state?this.auth():this.nr()},t.prototype.stop=function(){return Object(b.b)(this,void 0,void 0,function(){return Object(b.d)(this,function(t){switch(t.label){case 0:return this.tr()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},t.prototype.sr=function(){this.state=0,this.Zi.reset()},t.prototype.ir=function(){var t=this;this.er()&&null===this.Xi&&(this.Xi=this.Se.enqueueAfterDelay(this.zi,6e4,function(){return t.rr()}))},t.prototype.cr=function(t){this.ur(),this.stream.send(t)},t.prototype.rr=function(){return Object(b.b)(this,void 0,void 0,function(){return Object(b.d)(this,function(t){return this.er()?[2,this.close(0)]:[2]})})},t.prototype.ur=function(){this.Xi&&(this.Xi.cancel(),this.Xi=null)},t.prototype.close=function(t,e){return Object(b.b)(this,void 0,void 0,function(){return Object(b.d)(this,function(n){switch(n.label){case 0:return this.ur(),this.Zi.cancel(),this.Yi++,3!==t?this.Zi.reset():e&&e.code===kr.RESOURCE_EXHAUSTED?(Lr(e.toString()),Lr("Using maximum backoff delay to prevent overloading the backend."),this.Zi.Qi()):e&&e.code===kr.UNAUTHENTICATED&&this.Ji.invalidateToken(),null!==this.stream&&(this.ar(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Ri(e)];case 1:return n.sent(),[2]}})})},t.prototype.ar=function(){},t.prototype.auth=function(){var t=this;this.state=1;var e=this.hr(this.Yi),n=this.Yi;this.Ji.getToken().then(function(e){t.Yi===n&&t.lr(e)},function(n){e(function(){var e=new Cr(kr.UNKNOWN,"Fetching auth token failed: "+n.message);return t.dr(e)})})},t.prototype.lr=function(t){var e=this,n=this.hr(this.Yi);this.stream=this.wr(t),this.stream.Ii(function(){n(function(){return e.state=2,e.listener.Ii()})}),this.stream.Ri(function(t){n(function(){return e.dr(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},t.prototype.nr=function(){var t=this;this.state=4,this.Zi.ji(function(){return Object(b.b)(t,void 0,void 0,function(){return Object(b.d)(this,function(t){return this.state=0,this.start(),[2]})})})},t.prototype.dr=function(t){return Pr("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},t.prototype.hr=function(t){var e=this;return function(n){e.Se.enqueueAndForget(function(){return e.Yi===t?n():(Pr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},t}(),Fc=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle",n,r,o)||this).R=i,s}return Object(b.c)(e,t),e.prototype.wr=function(t){return this.Hi.Oi("Listen",t)},e.prototype.onMessage=function(t){this.Zi.reset();var e=function(t,e){var n;if("targetChange"in e){var r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:Vr()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=function(t,e){return t.I?(qr(void 0===e||"string"==typeof e),ri.fromBase64String(e||"")):(qr(void 0===e||e instanceof Uint8Array),ri.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),s=(a=e.targetChange.cause)&&function(t){var e=void 0===t.code?kr.UNKNOWN:Jo(t.code);return new Cr(e,t.message||"")}(a);n=new ms(r,i,o,s||null)}else if("documentChange"in e){i=xs(t,(r=e.documentChange).document.name),o=As(r.document.updateTime);var a=new Ai({mapValue:{fields:r.document.fields}}),u=(s=ki.newFoundDocument(i,o,a),r.targetIds||[]);n=new gs(u,r.removedTargetIds||[],s.key,s)}else if("documentDelete"in e)i=xs(t,(r=e.documentDelete).document),o=r.readTime?As(r.readTime):Wr.min(),a=ki.newNoDocument(i,o),n=new gs([],s=r.removedTargetIds||[],a.key,a);else if("documentRemove"in e)i=xs(t,(r=e.documentRemove).document),n=new gs([],o=r.removedTargetIds||[],i,null);else{if(!("filter"in e))return Vr();var c=e.filter;i=new Xo(r=c.count||0),n=new vs(o=c.targetId,i)}return n}(this.R,t),n=function(t){if(!("targetChange"in t))return Wr.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length?Wr.min():e.readTime?As(e.readTime):Wr.min()}(t);return this.listener._r(e,n)},e.prototype.mr=function(t){var e={};e.database=Ls(this.R),e.addTarget=function(t,e){var n,r=e.target;return(n=Li(r)?{documents:Bs(t,r)}:{query:Ks(t,r)}).targetId=e.targetId,e.resumeToken.approximateByteSize()>0?n.resumeToken=Ds(t,e.resumeToken):e.snapshotVersion.compareTo(Wr.min())>0&&(n.readTime=Ss(t,e.snapshotVersion.toTimestamp())),n}(this.R,t);var n=function(t,e){var n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Vr()}}(0,e.purpose);return null==n?null:{"goog-listen-tags":n}}(0,t);n&&(e.labels=n),this.cr(e)},e.prototype.yr=function(t){var e={};e.database=Ls(this.R),e.removeTarget=t,this.cr(e)},e}(Lc),Mc=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"write_stream_connection_backoff","write_stream_idle",n,r,o)||this).R=i,s.gr=!1,s}return Object(b.c)(e,t),Object.defineProperty(e.prototype,"pr",{get:function(){return this.gr},enumerable:!1,configurable:!0}),e.prototype.start=function(){this.gr=!1,this.lastStreamToken=void 0,t.prototype.start.call(this)},e.prototype.ar=function(){this.gr&&this.Er([])},e.prototype.wr=function(t){return this.Hi.Oi("Write",t)},e.prototype.onMessage=function(t){if(qr(!!t.streamToken),this.lastStreamToken=t.streamToken,this.gr){this.Zi.reset();var e=function(t,e){return t&&t.length>0?(qr(void 0!==e),t.map(function(t){return function(t,e){var n=As(t.updateTime?t.updateTime:e);return n.isEqual(Wr.min())&&(n=As(e)),new Co(n,t.transformResults||[])}(t,e)})):[]}(t.writeResults,t.commitTime),n=As(t.commitTime);return this.listener.Tr(n,e)}return qr(!t.writeResults||0===t.writeResults.length),this.gr=!0,this.listener.Ir()},e.prototype.Ar=function(){var t={};t.database=Ls(this.R),this.cr(t)},e.prototype.Er=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map(function(t){return qs(e.R,t)})};this.cr(n)},e}(Lc),Vc=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).credentials=e,i.Hi=n,i.R=r,i.Rr=!1,i}return Object(b.c)(e,t),e.prototype.br=function(){if(this.Rr)throw new Cr(kr.FAILED_PRECONDITION,"The client has already been terminated.")},e.prototype.Ni=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then(function(i){return r.Hi.Ni(t,e,n,i)}).catch(function(t){throw"FirebaseError"===t.name?(t.code===kr.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new Cr(kr.UNKNOWN,t.toString())})},e.prototype.$i=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then(function(i){return r.Hi.$i(t,e,n,i)}).catch(function(t){throw"FirebaseError"===t.name?(t.code===kr.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new Cr(kr.UNKNOWN,t.toString())})},e.prototype.terminate=function(){this.Rr=!0},e}(function(){}),qc=function(){function t(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.vr=0,this.Pr=null,this.Vr=!0}return t.prototype.Sr=function(){var t=this;0===this.vr&&(this.Dr("Unknown"),this.Pr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,function(){return t.Pr=null,t.Cr("Backend didn't respond within 10 seconds."),t.Dr("Offline"),Promise.resolve()}))},t.prototype.Nr=function(t){"Online"===this.state?this.Dr("Unknown"):(this.vr++,this.vr>=1&&(this.Fr(),this.Cr("Connection failed 1 times. Most recent error: "+t.toString()),this.Dr("Offline")))},t.prototype.set=function(t){this.Fr(),this.vr=0,"Online"===t&&(this.Vr=!1),this.Dr(t)},t.prototype.Dr=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},t.prototype.Cr=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Vr?(Lr(e),this.Vr=!1):Pr("OnlineStateTracker",e)},t.prototype.Fr=function(){null!==this.Pr&&(this.Pr.cancel(),this.Pr=null)},t}(),Uc=function(t,e,n,r,i){var o=this;this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.kr=[],this.$r=new Map,this.Or=new Set,this.Mr=[],this.Lr=i,this.Lr.di(function(t){n.enqueueAndForget(function(){return Object(b.b)(o,void 0,void 0,function(){return Object(b.d)(this,function(t){switch(t.label){case 0:return Xc(this)?(Pr("RemoteStore","Restarting streams for network reachability change."),[4,function(t){return Object(b.b)(this,void 0,void 0,function(){var e;return Object(b.d)(this,function(n){switch(n.label){case 0:return(e=Ur(t)).Or.add(4),[4,Kc(e)];case 1:return n.sent(),e.Br.set("Unknown"),e.Or.delete(4),[4,Bc(e)];case 2:return n.sent(),[2]}})})}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.Br=new qc(n,r)};function Bc(t){return Object(b.b)(this,void 0,void 0,function(){var e,n;return Object(b.d)(this,function(r){switch(r.label){case 0:if(!Xc(t))return[3,4];e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function Kc(t){return Object(b.b)(this,void 0,void 0,function(){var e,n;return Object(b.d)(this,function(r){switch(r.label){case 0:e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function Gc(t,e){var n=Ur(t);n.$r.has(e.targetId)||(n.$r.set(e.targetId,e),Yc(n)?Wc(n):lh(n).er()&&zc(n,e))}function Qc(t,e){var n=Ur(t),r=lh(n);n.$r.delete(e),r.er()&&Hc(n,e),0===n.$r.size&&(r.er()?r.ir():Xc(n)&&n.Br.set("Unknown"))}function zc(t,e){t.qr.U(e.targetId),lh(t).mr(e)}function Hc(t,e){t.qr.U(e),lh(t).yr(e)}function Wc(t){t.qr=new ws({getRemoteKeysForTarget:function(e){return t.remoteSyncer.getRemoteKeysForTarget(e)},lt:function(e){return t.$r.get(e)||null}}),lh(t).start(),t.Br.Sr()}function Yc(t){return Xc(t)&&!lh(t).tr()&&t.$r.size>0}function Xc(t){return 0===Ur(t).Or.size}function $c(t){t.qr=void 0}function Jc(t){return Object(b.b)(this,void 0,void 0,function(){return Object(b.d)(this,function(e){return t.$r.forEach(function(e,n){zc(t,e)}),[2]})})}function Zc(t,e){return Object(b.b)(this,void 0,void 0,function(){return Object(b.d)(this,function(n){return $c(t),Yc(t)?(t.Br.Nr(e),Wc(t)):t.Br.set("Unknown"),[2]})})}function th(t,e,n){return Object(b.b)(this,void 0,void 0,function(){var r,i,o;return Object(b.d)(this,function(s){switch(s.label){case 0:if(t.Br.set("Online"),!(e instanceof ms&&2===e.state&&e.cause))return[3,6];s.label=1;case 1:return s.trys.push([1,3,,5]),[4,function(t,e){return Object(b.b)(this,void 0,void 0,function(){var n,r,i,o;return Object(b.d)(this,function(s){switch(s.label){case 0:n=e.cause,r=0,i=e.targetIds,s.label=1;case 1:return r<i.length?t.$r.has(o=i[r])?[4,t.remoteSyncer.rejectListen(o,n)]:[3,3]:[3,5];case 2:s.sent(),t.$r.delete(o),t.qr.removeTarget(o),s.label=3;case 3:s.label=4;case 4:return r++,[3,1];case 5:return[2]}})})}(t,e)];case 2:return s.sent(),[3,5];case 3:return r=s.sent(),Pr("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),[4,eh(t,r)];case 4:return s.sent(),[3,5];case 5:return[3,13];case 6:if(e instanceof gs?t.qr.X(e):e instanceof vs?t.qr.rt(e):t.qr.et(e),n.isEqual(Wr.min()))return[3,13];s.label=7;case 7:return s.trys.push([7,11,,13]),[4,Wu(t.localStore)];case 8:return i=s.sent(),n.compareTo(i)>=0?[4,function(t,e){var n=t.qr.ut(e);return n.targetChanges.forEach(function(n,r){if(n.resumeToken.approximateByteSize()>0){var i=t.$r.get(r);i&&t.$r.set(r,i.withResumeToken(n.resumeToken,e))}}),n.targetMismatches.forEach(function(e){var n=t.$r.get(e);if(n){t.$r.set(e,n.withResumeToken(ri.EMPTY_BYTE_STRING,n.snapshotVersion)),Hc(t,e);var r=new qa(n.target,e,1,n.sequenceNumber);zc(t,r)}}),t.remoteSyncer.applyRemoteEvent(n)}(t,n)]:[3,10];case 9:s.sent(),s.label=10;case 10:return[3,13];case 11:return Pr("RemoteStore","Failed to raise snapshot:",o=s.sent()),[4,eh(t,o)];case 12:return s.sent(),[3,13];case 13:return[2]}})})}function eh(t,e,n){return Object(b.b)(this,void 0,void 0,function(){var r=this;return Object(b.d)(this,function(i){switch(i.label){case 0:if(!ka(e))throw e;return t.Or.add(1),[4,Kc(t)];case 1:return i.sent(),t.Br.set("Offline"),n||(n=function(){return Wu(t.localStore)}),t.asyncQueue.enqueueRetryable(function(){return Object(b.b)(r,void 0,void 0,function(){return Object(b.d)(this,function(e){switch(e.label){case 0:return Pr("RemoteStore","Retrying IndexedDB access"),[4,n()];case 1:return e.sent(),t.Or.delete(1),[4,Bc(t)];case 2:return e.sent(),[2]}})})}),[2]}})})}function nh(t,e){return e().catch(function(n){return eh(t,n,e)})}function rh(t){return Object(b.b)(this,void 0,void 0,function(){var e,n,r,i,o;return Object(b.d)(this,function(s){switch(s.label){case 0:e=Ur(t),n=fh(e),r=e.kr.length>0?e.kr[e.kr.length-1].batchId:-1,s.label=1;case 1:if(!function(t){return Xc(t)&&t.kr.length<10}(e))return[3,7];s.label=2;case 2:return s.trys.push([2,4,,6]),[4,$u(e.localStore,r)];case 3:return null===(i=s.sent())?(0===e.kr.length&&n.ir(),[3,7]):(r=i.batchId,function(t,e){t.kr.push(e);var n=fh(t);n.er()&&n.pr&&n.Er(e.mutations)}(e,i),[3,6]);case 4:return o=s.sent(),[4,eh(e,o)];case 5:return s.sent(),[3,6];case 6:return[3,1];case 7:return ih(e)&&oh(e),[2]}})})}function ih(t){return Xc(t)&&!fh(t).tr()&&t.kr.length>0}function oh(t){fh(t).start()}function sh(t){return Object(b.b)(this,void 0,void 0,function(){return Object(b.d)(this,function(e){return fh(t).Ar(),[2]})})}function ah(t){return Object(b.b)(this,void 0,void 0,function(){var e,n,r;return Object(b.d)(this,function(i){for(e=fh(t),n=0,r=t.kr;n<r.length;n++)e.Er(r[n].mutations);return[2]})})}function uh(t,e,n){return Object(b.b)(this,void 0,void 0,function(){var r,i;return Object(b.d)(this,function(o){switch(o.label){case 0:return r=t.kr.shift(),i=Va.from(r,e,n),[4,nh(t,function(){return t.remoteSyncer.applySuccessfulWrite(i)})];case 1:return o.sent(),[4,rh(t)];case 2:return o.sent(),[2]}})})}function ch(t,e){return Object(b.b)(this,void 0,void 0,function(){return Object(b.d)(this,function(n){switch(n.label){case 0:return e&&fh(t).pr?[4,function(t,e){return Object(b.b)(this,void 0,void 0,function(){var n,r;return Object(b.d)(this,function(i){switch(i.label){case 0:return $o(r=e.code)&&r!==kr.ABORTED?(n=t.kr.shift(),fh(t).sr(),[4,nh(t,function(){return t.remoteSyncer.rejectFailedWrite(n.batchId,e)})]):[3,3];case 1:return i.sent(),[4,rh(t)];case 2:i.sent(),i.label=3;case 3:return[2]}})})}(t,e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return ih(t)&&oh(t),[2]}})})}function hh(t,e){return Object(b.b)(this,void 0,void 0,function(){var n;return Object(b.d)(this,function(r){switch(r.label){case 0:return n=Ur(t),e?(n.Or.delete(2),[4,Bc(n)]):[3,2];case 1:return r.sent(),[3,5];case 2:return e?[3,4]:(n.Or.add(2),[4,Kc(n)]);case 3:r.sent(),n.Br.set("Unknown"),r.label=4;case 4:r.label=5;case 5:return[2]}})})}function lh(t){var e=this;return t.Ur||(t.Ur=function(t,e,n){var r=Ur(t);return r.br(),new Fc(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:Jc.bind(null,t),Ri:Zc.bind(null,t),_r:th.bind(null,t)}),t.Mr.push(function(n){return Object(b.b)(e,void 0,void 0,function(){return Object(b.d)(this,function(e){switch(e.label){case 0:return n?(t.Ur.sr(),Yc(t)?Wc(t):t.Br.set("Unknown"),[3,3]):[3,1];case 1:return[4,t.Ur.stop()];case 2:e.sent(),$c(t),e.label=3;case 3:return[2]}})})})),t.Ur}function fh(t){var e=this;return t.Kr||(t.Kr=function(t,e,n){var r=Ur(t);return r.br(),new Mc(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:sh.bind(null,t),Ri:ch.bind(null,t),Ir:ah.bind(null,t),Tr:uh.bind(null,t)}),t.Mr.push(function(n){return Object(b.b)(e,void 0,void 0,function(){return Object(b.d)(this,function(e){switch(e.label){case 0:return n?(t.Kr.sr(),[4,rh(t)]):[3,2];case 1:return e.sent(),[3,4];case 2:return[4,t.Kr.stop()];case 3:e.sent(),t.kr.length>0&&(Pr("RemoteStore","Stopping write stream with "+t.kr.length+" pending writes"),t.kr=[]),e.label=4;case 4:return[2]}})})})),t.Kr}var dh=function(){function t(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Oa,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(function(t){})}return t.createAndSchedule=function(e,n,r,i,o){var s=new t(e,n,Date.now()+r,i,o);return s.start(r),s},t.prototype.start=function(t){var e=this;this.timerHandle=setTimeout(function(){return e.handleDelayElapsed()},t)},t.prototype.skipDelay=function(){return this.handleDelayElapsed()},t.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Cr(kr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget(function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then(function(e){return t.deferred.resolve(e)})):Promise.resolve()})},t.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},t}();function ph(t,e){if(Lr("AsyncQueue",e+": "+t),ka(t))return new Cr(kr.UNAVAILABLE,e+": "+t);throw t}var yh=function(){function t(t){this.comparator=t?function(e,n){return t(e,n)||pi.comparator(e.key,n.key)}:function(t,e){return pi.comparator(t.key,e.key)},this.keyedMap=as(),this.sortedSet=new Zo(this.comparator)}return t.emptySet=function(e){return new t(e.comparator)},t.prototype.has=function(t){return null!=this.keyedMap.get(t)},t.prototype.get=function(t){return this.keyedMap.get(t)},t.prototype.first=function(){return this.sortedSet.minKey()},t.prototype.last=function(){return this.sortedSet.maxKey()},t.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},t.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t){this.sortedSet.inorderTraversal(function(e,n){return t(e),!1})},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach(function(e){t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r},t}(),gh=function(){function t(){this.Qr=new Zo(pi.comparator)}return t.prototype.track=function(t){var e=t.doc.key,n=this.Qr.get(e);n?0!==t.type&&3===n.type?this.Qr=this.Qr.insert(e,t):3===t.type&&1!==n.type?this.Qr=this.Qr.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Qr=this.Qr.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Qr=this.Qr.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Qr=this.Qr.remove(e):1===t.type&&2===n.type?this.Qr=this.Qr.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Qr=this.Qr.insert(e,{type:2,doc:t.doc}):Vr():this.Qr=this.Qr.insert(e,t)},t.prototype.jr=function(){var t=[];return this.Qr.inorderTraversal(function(e,n){t.push(n)}),t},t}(),vh=function(){function t(t,e,n,r,i,o,s,a){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=s,this.excludesMetadataChanges=a}return t.fromInitialDocuments=function(e,n,r,i){var o=[];return n.forEach(function(t){o.push({type:0,doc:t})}),new t(e,n,yh.emptySet(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&co(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),mh=function(){this.Wr=void 0,this.listeners=[]},bh=function(){this.queries=new Su(function(t){return ho(t)},co),this.onlineState="Unknown",this.Gr=new Set};function wh(t,e){return Object(b.b)(this,void 0,void 0,function(){var n,r,i,o,s,a,u;return Object(b.d)(this,function(c){switch(c.label){case 0:if(n=Ur(t),i=!1,(o=n.queries.get(r=e.query))||(i=!0,o=new mh),!i)return[3,4];c.label=1;case 1:return c.trys.push([1,3,,4]),s=o,[4,n.onListen(r)];case 2:return s.Wr=c.sent(),[3,4];case 3:return a=c.sent(),u=ph(a,"Initialization of query '"+lo(e.query)+"' failed"),[2,void e.onError(u)];case 4:return n.queries.set(r,o),o.listeners.push(e),e.zr(n.onlineState),o.Wr&&e.Hr(o.Wr)&&_h(n),[2]}})})}function Ih(t,e){return Object(b.b)(this,void 0,void 0,function(){var n,r,i,o,s;return Object(b.d)(this,function(a){return n=Ur(t),i=!1,(o=n.queries.get(r=e.query))&&(s=o.listeners.indexOf(e))>=0&&(o.listeners.splice(s,1),i=0===o.listeners.length),i?[2,(n.queries.delete(r),n.onUnlisten(r))]:[2]})})}function Th(t,e){for(var n=Ur(t),r=!1,i=0,o=e;i<o.length;i++){var s=o[i],a=n.queries.get(s.query);if(a){for(var u=0,c=a.listeners;u<c.length;u++)c[u].Hr(s)&&(r=!0);a.Wr=s}}r&&_h(n)}function Eh(t,e,n){var r=Ur(t),i=r.queries.get(e);if(i)for(var o=0,s=i.listeners;o<s.length;o++)s[o].onError(n);r.queries.delete(e)}function _h(t){t.Gr.forEach(function(t){t.next()})}var Oh=function(){function t(t,e,n){this.query=t,this.Jr=e,this.Yr=!1,this.Xr=null,this.onlineState="Unknown",this.options=n||{}}return t.prototype.Hr=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new vh(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.Yr?this.Zr(t)&&(this.Jr.next(t),o=!0):this.eo(t,this.onlineState)&&(this.no(t),o=!0),this.Xr=t,o},t.prototype.onError=function(t){this.Jr.error(t)},t.prototype.zr=function(t){this.onlineState=t;var e=!1;return this.Xr&&!this.Yr&&this.eo(this.Xr,t)&&(this.no(this.Xr),e=!0),e},t.prototype.eo=function(t,e){return!t.fromCache||!(this.options.so&&"Offline"!==e||t.docs.isEmpty()&&"Offline"!==e)},t.prototype.Zr=function(t){return t.docChanges.length>0||!!(t.syncStateChanged||this.Xr&&this.Xr.hasPendingWrites!==t.hasPendingWrites)&&!0===this.options.includeMetadataChanges},t.prototype.no=function(t){t=vh.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.Yr=!0,this.Jr.next(t)},t}(),Sh=function(){function t(t,e){this.payload=t,this.byteLength=e}return t.prototype.io=function(){return"metadata"in this.payload},t}(),Dh=function(){function t(t){this.R=t}return t.prototype.qn=function(t){return xs(this.R,t)},t.prototype.Un=function(t){return t.metadata.exists?Vs(this.R,t.document,!1):ki.newNoDocument(this.qn(t.metadata.name),this.Kn(t.metadata.readTime))},t.prototype.Kn=function(t){return As(t)},t}();!function(){function t(t,e,n){this.ro=t,this.localStore=e,this.R=n,this.queries=[],this.documents=[],this.progress=function(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}(t)}t.prototype.oo=function(t){this.progress.bytesLoaded+=t.byteLength;var e=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e),e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null},t.prototype.co=function(t){for(var e=new Map,n=new Dh(this.R),r=0,i=t;r<i.length;r++){var o=i[r];if(o.metadata.queries)for(var s=n.qn(o.metadata.name),a=0,u=o.metadata.queries;a<u.length;a++){var c=u[a],h=(e.get(c)||ls()).add(s);e.set(c,h)}}return e},t.prototype.complete=function(){return Object(b.b)(this,void 0,void 0,function(){var t,e,n,r,i;return Object(b.d)(this,function(o){switch(o.label){case 0:return[4,ic(this.localStore,new Dh(this.R),this.documents,this.ro.id)];case 1:t=o.sent(),e=this.co(this.documents),n=0,r=this.queries,o.label=2;case 2:return n<r.length?[4,oc(this.localStore,i=r[n],e.get(i.name))]:[3,5];case 3:o.sent(),o.label=4;case 4:return n++,[3,2];case 5:return[2,(this.progress.taskState="Success",new qu(Object.assign({},this.progress),t))]}})})}}();var Nh=function(t){this.key=t},Ah=function(t){this.key=t},jh=function(){function t(t,e){this.query=t,this.uo=e,this.ao=null,this.current=!1,this.ho=ls(),this.mutatedKeys=ls(),this.lo=po(t),this.fo=new yh(this.lo)}return Object.defineProperty(t.prototype,"wo",{get:function(){return this.uo},enumerable:!1,configurable:!0}),t.prototype._o=function(t,e){var n=this,r=e?e.mo:new gh,i=e?e.fo:this.fo,o=e?e.mutatedKeys:this.mutatedKeys,s=i,a=!1,u=eo(this.query)&&i.size===this.query.limit?i.last():null,c=no(this.query)&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal(function(t,e){var h=i.get(t),l=fo(n.query,e)?e:null,f=!!h&&n.mutatedKeys.has(h.key),d=!!l&&(l.hasLocalMutations||n.mutatedKeys.has(l.key)&&l.hasCommittedMutations),p=!1;h&&l?h.data.isEqual(l.data)?f!==d&&(r.track({type:3,doc:l}),p=!0):n.yo(h,l)||(r.track({type:2,doc:l}),p=!0,(u&&n.lo(l,u)>0||c&&n.lo(l,c)<0)&&(a=!0)):!h&&l?(r.track({type:0,doc:l}),p=!0):h&&!l&&(r.track({type:1,doc:h}),p=!0,(u||c)&&(a=!0)),p&&(l?(s=s.add(l),o=d?o.add(t):o.delete(t)):(s=s.delete(t),o=o.delete(t)))}),eo(this.query)||no(this.query))for(;s.size>this.query.limit;){var h=eo(this.query)?s.last():s.first();s=s.delete(h.key),o=o.delete(h.key),r.track({type:1,doc:h})}return{fo:s,mo:r,Nn:a,mutatedKeys:o}},t.prototype.yo=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},t.prototype.applyChanges=function(t,e,n){var r=this,i=this.fo;this.fo=t.fo,this.mutatedKeys=t.mutatedKeys;var o=t.mo.jr();o.sort(function(t,e){return function(t,e){var n=function(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Vr()}};return n(t)-n(e)}(t.type,e.type)||r.lo(t.doc,e.doc)}),this.po(n);var s=e?this.Eo():[],a=0===this.ho.size&&this.current?1:0,u=a!==this.ao;return this.ao=a,0!==o.length||u?{snapshot:new vh(this.query,t.fo,i,o,t.mutatedKeys,0===a,u,!1),To:s}:{To:s}},t.prototype.zr=function(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({fo:this.fo,mo:new gh,mutatedKeys:this.mutatedKeys,Nn:!1},!1)):{To:[]}},t.prototype.Io=function(t){return!this.uo.has(t)&&!!this.fo.has(t)&&!this.fo.get(t).hasLocalMutations},t.prototype.po=function(t){var e=this;t&&(t.addedDocuments.forEach(function(t){return e.uo=e.uo.add(t)}),t.modifiedDocuments.forEach(function(t){}),t.removedDocuments.forEach(function(t){return e.uo=e.uo.delete(t)}),this.current=t.current)},t.prototype.Eo=function(){var t=this;if(!this.current)return[];var e=this.ho;this.ho=ls(),this.fo.forEach(function(e){t.Io(e.key)&&(t.ho=t.ho.add(e.key))});var n=[];return e.forEach(function(e){t.ho.has(e)||n.push(new Ah(e))}),this.ho.forEach(function(t){e.has(t)||n.push(new Nh(t))}),n},t.prototype.Ao=function(t){this.uo=t.Bn,this.ho=ls();var e=this._o(t.documents);return this.applyChanges(e,!0)},t.prototype.Ro=function(){return vh.fromInitialDocuments(this.query,this.fo,this.mutatedKeys,0===this.ao)},t}(),kh=function(t,e,n){this.query=t,this.targetId=e,this.view=n},Ch=function(t){this.key=t,this.bo=!1},xh=function(){function t(t,e,n,r,i,o){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.vo={},this.Po=new Su(function(t){return ho(t)},co),this.Vo=new Map,this.So=new Set,this.Do=new Zo(pi.comparator),this.Co=new Map,this.No=new ac,this.xo={},this.Fo=new Map,this.ko=pu.Yt(),this.onlineState="Unknown",this.$o=void 0}return Object.defineProperty(t.prototype,"isPrimaryClient",{get:function(){return!0===this.$o},enumerable:!1,configurable:!0}),t}();function Rh(t,e){return Object(b.b)(this,void 0,void 0,function(){var n,r,i,o,s;return Object(b.d)(this,function(a){switch(a.label){case 0:return n=cl(t),(i=n.Po.get(e))?(n.sharedClientState.addLocalQueryTarget(i.targetId),r=i.view.Ro(),[3,4]):[3,1];case 1:return[4,Ju(n.localStore,ao(e))];case 2:return o=a.sent(),s=n.sharedClientState.addLocalQueryTarget(o.targetId),[4,Ph(n,e,o.targetId,"current"===s)];case 3:r=a.sent(),n.isPrimaryClient&&Gc(n.remoteStore,o),a.label=4;case 4:return[2,r]}})})}function Ph(t,e,n,r){return Object(b.b)(this,void 0,void 0,function(){var i,o,s,a,u,c;return Object(b.d)(this,function(h){switch(h.label){case 0:return t.Oo=function(e,n,r){return function(t,e,n,r){return Object(b.b)(this,void 0,void 0,function(){var i,o,s;return Object(b.d)(this,function(a){switch(a.label){case 0:return(i=e.view._o(n)).Nn?[4,tc(t.localStore,e.query,!1).then(function(t){return e.view._o(t.documents,i)})]:[3,2];case 1:i=a.sent(),a.label=2;case 2:return o=r&&r.targetChanges.get(e.targetId),s=e.view.applyChanges(i,t.isPrimaryClient,o),[2,(Wh(t,e.targetId,s.To),s.snapshot)]}})})}(t,e,n,r)},[4,tc(t.localStore,e,!0)];case 1:return i=h.sent(),o=new jh(e,i.Bn),s=o._o(i.documents),a=ys.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState),u=o.applyChanges(s,t.isPrimaryClient,a),Wh(t,n,u.To),c=new kh(e,n,o),[2,(t.Po.set(e,c),t.Vo.has(n)?t.Vo.get(n).push(e):t.Vo.set(n,[e]),u.snapshot)]}})})}function Lh(t,e){return Object(b.b)(this,void 0,void 0,function(){var n,r,i;return Object(b.d)(this,function(o){switch(o.label){case 0:return n=Ur(t),r=n.Po.get(e),(i=n.Vo.get(r.targetId)).length>1?[2,(n.Vo.set(r.targetId,i.filter(function(t){return!co(t,e)})),void n.Po.delete(e))]:n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)?[3,2]:[4,Zu(n.localStore,r.targetId,!1).then(function(){n.sharedClientState.clearQueryState(r.targetId),Qc(n.remoteStore,r.targetId),zh(n,r.targetId)}).catch(bu)]):[3,3];case 1:o.sent(),o.label=2;case 2:return[3,5];case 3:return zh(n,r.targetId),[4,Zu(n.localStore,r.targetId,!0)];case 4:o.sent(),o.label=5;case 5:return[2]}})})}function Fh(t,e,n){return Object(b.b)(this,void 0,void 0,function(){var r,i,o,s;return Object(b.d)(this,function(a){switch(a.label){case 0:r=hl(t),a.label=1;case 1:return a.trys.push([1,5,,6]),[4,function(t,e){var n,r=Ur(t),i=Hr.now(),o=e.reduce(function(t,e){return t.add(e.key)},ls());return r.persistence.runTransaction("Locally write mutations","readwrite",function(t){return r.Mn.pn(t,o).next(function(o){n=o;for(var s=[],a=0,u=e;a<u.length;a++){var c=u[a],h=Mo(c,n.get(c.key));null!=h&&s.push(new Bo(c.key,h,ji(h.value.mapValue),xo.exists(!0)))}return r._n.addMutationBatch(t,i,s,e)})}).then(function(t){return t.applyToLocalDocumentSet(n),{batchId:t.batchId,changes:n}})}(r.localStore,e)];case 2:return i=a.sent(),r.sharedClientState.addPendingMutation(i.batchId),function(t,e,n){var r=t.xo[t.currentUser.toKey()];r||(r=new Zo(Gr)),r=r.insert(e,n),t.xo[t.currentUser.toKey()]=r}(r,i.batchId,n),[4,$h(r,i.changes)];case 3:return a.sent(),[4,rh(r.remoteStore)];case 4:return a.sent(),[3,6];case 5:return o=a.sent(),s=ph(o,"Failed to persist write"),n.reject(s),[3,6];case 6:return[2]}})})}function Mh(t,e){return Object(b.b)(this,void 0,void 0,function(){var n,r;return Object(b.d)(this,function(i){switch(i.label){case 0:n=Ur(t),i.label=1;case 1:return i.trys.push([1,4,,6]),[4,Yu(n.localStore,e)];case 2:return r=i.sent(),e.targetChanges.forEach(function(t,e){var r=n.Co.get(e);r&&(qr(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?r.bo=!0:t.modifiedDocuments.size>0?qr(r.bo):t.removedDocuments.size>0&&(qr(r.bo),r.bo=!1))}),[4,$h(n,r,e)];case 3:return i.sent(),[3,6];case 4:return[4,bu(i.sent())];case 5:return i.sent(),[3,6];case 6:return[2]}})})}function Vh(t,e,n){var r=Ur(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){var i=[];r.Po.forEach(function(t,n){var r=n.view.zr(e);r.snapshot&&i.push(r.snapshot)}),function(t,e){var n=Ur(t);n.onlineState=e;var r=!1;n.queries.forEach(function(t,n){for(var i=0,o=n.listeners;i<o.length;i++)o[i].zr(e)&&(r=!0)}),r&&_h(n)}(r.eventManager,e),i.length&&r.vo._r(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function qh(t,e,n){return Object(b.b)(this,void 0,void 0,function(){var r,i,o,s,a,u;return Object(b.d)(this,function(c){switch(c.label){case 0:return(r=Ur(t)).sharedClientState.updateQueryState(e,"rejected",n),i=r.Co.get(e),(o=i&&i.key)?(s=(s=new Zo(pi.comparator)).insert(o,ki.newNoDocument(o,Wr.min())),a=ls().add(o),u=new ps(Wr.min(),new Map,new ns(Gr),s,a),[4,Mh(r,u)]):[3,2];case 1:return c.sent(),r.Do=r.Do.remove(o),r.Co.delete(e),Xh(r),[3,4];case 2:return[4,Zu(r.localStore,e,!1).then(function(){return zh(r,e,n)}).catch(bu)];case 3:c.sent(),c.label=4;case 4:return[2]}})})}function Uh(t,e){return Object(b.b)(this,void 0,void 0,function(){var n,r,i;return Object(b.d)(this,function(o){switch(o.label){case 0:n=Ur(t),r=e.batch.batchId,o.label=1;case 1:return o.trys.push([1,4,,6]),[4,Hu(n.localStore,e)];case 2:return i=o.sent(),Qh(n,r,null),Gh(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),[4,$h(n,i)];case 3:return o.sent(),[3,6];case 4:return[4,bu(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}})})}function Bh(t,e,n){return Object(b.b)(this,void 0,void 0,function(){var r,i;return Object(b.d)(this,function(o){switch(o.label){case 0:r=Ur(t),o.label=1;case 1:return o.trys.push([1,4,,6]),[4,function(t,e){var n=Ur(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",function(t){var r;return n._n.lookupMutationBatch(t,e).next(function(e){return qr(null!==e),r=e.keys(),n._n.removeMutationBatch(t,e)}).next(function(){return n._n.performConsistencyCheck(t)}).next(function(){return n.Mn.pn(t,r)})})}(r.localStore,e)];case 2:return i=o.sent(),Qh(r,e,n),Gh(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),[4,$h(r,i)];case 3:return o.sent(),[3,6];case 4:return[4,bu(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}})})}function Kh(t,e){return Object(b.b)(this,void 0,void 0,function(){var n,r,i,o,s;return Object(b.d)(this,function(a){switch(a.label){case 0:Xc((n=Ur(t)).remoteStore)||Pr("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,function(t){var e=Ur(t);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(t){return e._n.getHighestUnacknowledgedBatchId(t)})}(n.localStore)];case 2:return-1===(r=a.sent())?[2,void e.resolve()]:((i=n.Fo.get(r)||[]).push(e),n.Fo.set(r,i),[3,4]);case 3:return o=a.sent(),s=ph(o,"Initialization of waitForPendingWrites() operation failed"),e.reject(s),[3,4];case 4:return[2]}})})}function Gh(t,e){(t.Fo.get(e)||[]).forEach(function(t){t.resolve()}),t.Fo.delete(e)}function Qh(t,e,n){var r=Ur(t),i=r.xo[r.currentUser.toKey()];if(i){var o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.xo[r.currentUser.toKey()]=i}}function zh(t,e,n){void 0===n&&(n=null),t.sharedClientState.removeLocalQueryTarget(e);for(var r=0,i=t.Vo.get(e);r<i.length;r++){var o=i[r];t.Po.delete(o),n&&t.vo.Mo(o,n)}t.Vo.delete(e),t.isPrimaryClient&&t.No.Zn(e).forEach(function(e){t.No.containsKey(e)||Hh(t,e)})}function Hh(t,e){t.So.delete(e.path.canonicalString());var n=t.Do.get(e);null!==n&&(Qc(t.remoteStore,n),t.Do=t.Do.remove(e),t.Co.delete(n),Xh(t))}function Wh(t,e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];o instanceof Nh?(t.No.addReference(o.key,e),Yh(t,o)):o instanceof Ah?(Pr("SyncEngine","Document no longer in limbo: "+o.key),t.No.removeReference(o.key,e),t.No.containsKey(o.key)||Hh(t,o.key)):Vr()}}function Yh(t,e){var n=e.key,r=n.path.canonicalString();t.Do.get(n)||t.So.has(r)||(Pr("SyncEngine","New document in limbo: "+n),t.So.add(r),Xh(t))}function Xh(t){for(;t.So.size>0&&t.Do.size<t.maxConcurrentLimboResolutions;){var e=t.So.values().next().value;t.So.delete(e);var n=new pi(Zr.fromString(e)),r=t.ko.next();t.Co.set(r,new Ch(n)),t.Do=t.Do.insert(n,r),Gc(t.remoteStore,new qa(ao(to(n.path)),r,2,jr.o))}}function $h(t,e,n){return Object(b.b)(this,void 0,void 0,function(){var r,i,o,s;return Object(b.d)(this,function(a){switch(a.label){case 0:return r=Ur(t),i=[],o=[],s=[],r.Po.isEmpty()?[3,3]:(r.Po.forEach(function(t,a){s.push(r.Oo(a,e,n).then(function(t){if(t){r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,t.fromCache?"not-current":"current"),i.push(t);var e=Bu.Pn(a.targetId,t);o.push(e)}}))}),[4,Promise.all(s)]);case 1:return a.sent(),r.vo._r(i),[4,function(t,e){return Object(b.b)(this,void 0,void 0,function(){var n,r,i,o,s,a,u,c;return Object(b.d)(this,function(h){switch(h.label){case 0:n=Ur(t),h.label=1;case 1:return h.trys.push([1,3,,4]),[4,n.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(t){return Sa.forEach(e,function(e){return Sa.forEach(e.bn,function(r){return n.persistence.referenceDelegate.addReference(t,e.targetId,r)}).next(function(){return Sa.forEach(e.vn,function(r){return n.persistence.referenceDelegate.removeReference(t,e.targetId,r)})})})})];case 2:return h.sent(),[3,4];case 3:if(!ka(r=h.sent()))throw r;return Pr("LocalStore","Failed to update sequence numbers: "+r),[3,4];case 4:for(i=0,o=e;i<o.length;i++)a=(s=o[i]).targetId,s.fromCache||(u=n.Fn.get(a),c=u.withLastLimboFreeSnapshotVersion(u.snapshotVersion),n.Fn=n.Fn.insert(a,c));return[2]}})})}(r.localStore,o)];case 2:a.sent(),a.label=3;case 3:return[2]}})})}function Jh(t,e){return Object(b.b)(this,void 0,void 0,function(){var n,r;return Object(b.d)(this,function(i){switch(i.label){case 0:return(n=Ur(t)).currentUser.isEqual(e)?[3,3]:(Pr("SyncEngine","User change. New user:",e.toKey()),[4,zu(n.localStore,e)]);case 1:return r=i.sent(),n.currentUser=e,function(t,e){t.Fo.forEach(function(t){t.forEach(function(t){t.reject(new Cr(kr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),t.Fo.clear()}(n),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),[4,$h(n,r.Ln)];case 2:i.sent(),i.label=3;case 3:return[2]}})})}function Zh(t,e){var n=Ur(t),r=n.Co.get(e);if(r&&r.bo)return ls().add(r.key);var i=ls(),o=n.Vo.get(e);if(!o)return i;for(var s=0,a=o;s<a.length;s++){var u=n.Po.get(a[s]);i=i.unionWith(u.view.wo)}return i}function tl(t,e){return Object(b.b)(this,void 0,void 0,function(){var n,r,i;return Object(b.d)(this,function(o){switch(o.label){case 0:return[4,tc((n=Ur(t)).localStore,e.query,!0)];case 1:return r=o.sent(),i=e.view.Ao(r),[2,(n.isPrimaryClient&&Wh(n,e.targetId,i.To),i)]}})})}function el(t){return Object(b.b)(this,void 0,void 0,function(){var e;return Object(b.d)(this,function(n){return[2,nc((e=Ur(t)).localStore).then(function(t){return $h(e,t)})]})})}function nl(t,e,n,r){return Object(b.b)(this,void 0,void 0,function(){var i,o;return Object(b.d)(this,function(s){switch(s.label){case 0:return[4,function(t,e){var n=Ur(t),r=Ur(n._n);return n.persistence.runTransaction("Lookup mutation documents","readonly",function(t){return r.jt(t,e).next(function(e){return e?n.Mn.pn(t,e):Sa.resolve(null)})})}((i=Ur(t)).localStore,e)];case 1:return null===(o=s.sent())?[3,6]:"pending"!==n?[3,3]:[4,rh(i.remoteStore)];case 2:return s.sent(),[3,4];case 3:"acknowledged"===n||"rejected"===n?(Qh(i,e,r||null),Gh(i,e),function(t,e){Ur(Ur(t)._n).Gt(e)}(i.localStore,e)):Vr(),s.label=4;case 4:return[4,$h(i,o)];case 5:return s.sent(),[3,7];case 6:Pr("SyncEngine","Cannot apply mutation batch with id: "+e),s.label=7;case 7:return[2]}})})}function rl(t,e){return Object(b.b)(this,void 0,void 0,function(){var n,r,i,o,s,a,u;return Object(b.d)(this,function(c){switch(c.label){case 0:return cl(n=Ur(t)),hl(n),!0!==e||!0===n.$o?[3,3]:(r=n.sharedClientState.getAllActiveQueryTargets(),[4,il(n,r.toArray())]);case 1:return i=c.sent(),n.$o=!0,[4,hh(n.remoteStore,!0)];case 2:for(c.sent(),o=0,s=i;o<s.length;o++)Gc(n.remoteStore,s[o]);return[3,7];case 3:return!1!==e||!1===n.$o?[3,7]:(a=[],u=Promise.resolve(),n.Vo.forEach(function(t,e){n.sharedClientState.isLocalQueryTarget(e)?a.push(e):u=u.then(function(){return zh(n,e),Zu(n.localStore,e,!0)}),Qc(n.remoteStore,e)}),[4,u]);case 4:return c.sent(),[4,il(n,a)];case 5:return c.sent(),function(t){var e=Ur(t);e.Co.forEach(function(t,n){Qc(e.remoteStore,n)}),e.No.ts(),e.Co=new Map,e.Do=new Zo(pi.comparator)}(n),n.$o=!1,[4,hh(n.remoteStore,!1)];case 6:c.sent(),c.label=7;case 7:return[2]}})})}function il(t,e,n){return Object(b.b)(this,void 0,void 0,function(){var n,r,i,o,s,a,u,c,h,l,f,d,p;return Object(b.d)(this,function(y){switch(y.label){case 0:n=Ur(t),r=[],i=[],o=0,s=e,y.label=1;case 1:return o<s.length?(u=void 0,(c=n.Vo.get(a=s[o]))&&0!==c.length?[4,Ju(n.localStore,ao(c[0]))]:[3,7]):[3,13];case 2:u=y.sent(),h=0,l=c,y.label=3;case 3:return h<l.length?(f=n.Po.get(l[h]),[4,tl(n,f)]):[3,6];case 4:(d=y.sent()).snapshot&&i.push(d.snapshot),y.label=5;case 5:return h++,[3,3];case 6:return[3,11];case 7:return[4,ec(n.localStore,a)];case 8:return p=y.sent(),[4,Ju(n.localStore,p)];case 9:return u=y.sent(),[4,Ph(n,ol(p),a,!1)];case 10:y.sent(),y.label=11;case 11:r.push(u),y.label=12;case 12:return o++,[3,1];case 13:return[2,(n.vo._r(i),r)]}})})}function ol(t){return Zi(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function sl(t){var e=Ur(t);return Ur(Ur(e.localStore).persistence).fn()}function al(t,e,n,r){return Object(b.b)(this,void 0,void 0,function(){var i,o,s;return Object(b.d)(this,function(a){switch(a.label){case 0:return(i=Ur(t)).$o?(Pr("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!i.Vo.has(e))return[3,8];switch(n){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,nc(i.localStore)];case 3:return o=a.sent(),s=ps.createSynthesizedRemoteEventForCurrentChange(e,"current"===n),[4,$h(i,o,s)];case 4:return a.sent(),[3,8];case 5:return[4,Zu(i.localStore,e,!0)];case 6:return a.sent(),zh(i,e,r),[3,8];case 7:Vr(),a.label=8;case 8:return[2]}})})}function ul(t,e,n){return Object(b.b)(this,void 0,void 0,function(){var r,i,o,s,a,u,c,h,l;return Object(b.d)(this,function(f){switch(f.label){case 0:if(!(r=cl(t)).$o)return[3,10];i=0,o=e,f.label=1;case 1:return i<o.length?r.Vo.has(s=o[i])?(Pr("SyncEngine","Adding an already active target "+s),[3,5]):[4,ec(r.localStore,s)]:[3,6];case 2:return a=f.sent(),[4,Ju(r.localStore,a)];case 3:return u=f.sent(),[4,Ph(r,ol(a),u.targetId,!1)];case 4:f.sent(),Gc(r.remoteStore,u),f.label=5;case 5:return i++,[3,1];case 6:c=function(t){return Object(b.d)(this,function(e){switch(e.label){case 0:return r.Vo.has(t)?[4,Zu(r.localStore,t,!1).then(function(){Qc(r.remoteStore,t),zh(r,t)}).catch(bu)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})},h=0,l=n,f.label=7;case 7:return h<l.length?[5,c(l[h])]:[3,10];case 8:f.sent(),f.label=9;case 9:return h++,[3,7];case 10:return[2]}})})}function cl(t){var e=Ur(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=Mh.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Zh.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=qh.bind(null,e),e.vo._r=Th.bind(null,e.eventManager),e.vo.Mo=Eh.bind(null,e.eventManager),e}function hl(t){var e=Ur(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Uh.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Bh.bind(null,e),e}var ll=function(){function t(){this.synchronizeTabs=!1}return t.prototype.initialize=function(t){return Object(b.b)(this,void 0,void 0,function(){return Object(b.d)(this,function(e){switch(e.label){case 0:return this.R=Rc(t.databaseInfo.databaseId),this.sharedClientState=this.Bo(t),this.persistence=this.qo(t),[4,this.persistence.start()];case 1:return e.sent(),this.gcScheduler=this.Uo(t),this.localStore=this.Ko(t),[2]}})})},t.prototype.Uo=function(t){return null},t.prototype.Ko=function(t){return Qu(this.persistence,new Ku,t.initialUser,this.R)},t.prototype.qo=function(t){return new dc(yc.bs,this.R)},t.prototype.Bo=function(t){return new Sc},t.prototype.terminate=function(){return Object(b.b)(this,void 0,void 0,function(){return Object(b.d)(this,function(t){switch(t.label){case 0:return this.gcScheduler&&this.gcScheduler.stop(),[4,this.sharedClientState.shutdown()];case 1:return t.sent(),[4,this.persistence.shutdown()];case 2:return t.sent(),[2]}})})},t}(),fl=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).Qo=e,i.cacheSizeBytes=n,i.forceOwnership=r,i.synchronizeTabs=!1,i}return Object(b.c)(e,t),e.prototype.initialize=function(e){return Object(b.b)(this,void 0,void 0,function(){return Object(b.d)(this,function(n){switch(n.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return n.sent(),[4,rc(this.localStore)];case 2:return n.sent(),[4,this.Qo.initialize(this,e)];case 3:return n.sent(),[4,hl(this.Qo.syncEngine)];case 4:return n.sent(),[4,rh(this.Qo.remoteStore)];case 5:return n.sent(),[2]}})})},e.prototype.Ko=function(t){return Qu(this.persistence,new Ku,t.initialUser,this.R)},e.prototype.Uo=function(t){return new Tu(this.persistence.referenceDelegate.garbageCollector,t.asyncQueue)},e.prototype.qo=function(t){var e=Vu(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?su.withCacheSize(this.cacheSizeBytes):su.DEFAULT;return new Lu(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,Cc(),xc(),this.R,this.sharedClientState,!!this.forceOwnership)},e.prototype.Bo=function(t){return new Sc},e}(ll),dl=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n,!1)||this).Qo=e,r.cacheSizeBytes=n,r.synchronizeTabs=!0,r}return Object(b.c)(e,t),e.prototype.initialize=function(e){return Object(b.b)(this,void 0,void 0,function(){var n,r=this;return Object(b.d)(this,function(i){switch(i.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return i.sent(),n=this.Qo.syncEngine,this.sharedClientState instanceof Oc?(this.sharedClientState.syncEngine={ui:nl.bind(null,n),ai:al.bind(null,n),hi:ul.bind(null,n),fn:sl.bind(null,n),ci:el.bind(null,n)},[4,this.sharedClientState.start()]):[3,3];case 2:i.sent(),i.label=3;case 3:return[4,this.persistence.He(function(t){return Object(b.b)(r,void 0,void 0,function(){return Object(b.d)(this,function(e){switch(e.label){case 0:return[4,rl(this.Qo.syncEngine,t)];case 1:return e.sent(),this.gcScheduler&&(t&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):t||this.gcScheduler.stop()),[2]}})})})];case 4:return i.sent(),[2]}})})},e.prototype.Bo=function(t){var e=Cc();if(!Oc.yt(e))throw new Cr(kr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=Vu(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new Oc(e,t.asyncQueue,n,t.clientId,t.initialUser)},e}(fl),pl=function(){function t(){}return t.prototype.initialize=function(t,e){return Object(b.b)(this,void 0,void 0,function(){var n=this;return Object(b.d)(this,function(r){switch(r.label){case 0:return this.localStore?[3,2]:(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(t){return Vh(n.syncEngine,t,1)},this.remoteStore.remoteSyncer.handleCredentialChange=Jh.bind(null,this.syncEngine),[4,hh(this.remoteStore,this.syncEngine.isPrimaryClient)]);case 1:r.sent(),r.label=2;case 2:return[2]}})})},t.prototype.createEventManager=function(t){return new bh},t.prototype.createDatastore=function(t){var e=Rc(t.databaseInfo.databaseId),n=new kc(t.databaseInfo);return function(t,e,n){return new Vc(t,e,n)}(t.credentials,n,e)},t.prototype.createRemoteStore=function(t){var e,n,r,i,o,s=this;return e=this.localStore,n=this.datastore,r=t.asyncQueue,i=function(t){return Vh(s.syncEngine,t,0)},o=Nc.yt()?new Nc:new Dc,new Uc(e,n,r,i,o)},t.prototype.createSyncEngine=function(t,e){return function(t,e,n,r,i,o,s){var a=new xh(t,e,n,r,i,o);return s&&(a.$o=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)},t.prototype.terminate=function(){return function(t){return Object(b.b)(this,void 0,void 0,function(){var e;return Object(b.d)(this,function(n){switch(n.label){case 0:return e=Ur(t),Pr("RemoteStore","RemoteStore shutting down."),e.Or.add(5),[4,Kc(e)];case 1:return n.sent(),e.Lr.shutdown(),e.Br.set("Unknown"),[2]}})})}(this.remoteStore)},t}(),yl=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.observer.next&&this.jo(this.observer.next,t)},t.prototype.error=function(t){this.observer.error?this.jo(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},t.prototype.Wo=function(){this.muted=!0},t.prototype.jo=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},t}(),gl=(function(){function t(t,e){var n=this;this.Go=t,this.R=e,this.metadata=new Oa,this.buffer=new Uint8Array,this.zo=new TextDecoder("utf-8"),this.Ho().then(function(t){t&&t.io()?n.metadata.resolve(t.payload.metadata):n.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             "+JSON.stringify(null==t?void 0:t.payload)))},function(t){return n.metadata.reject(t)})}t.prototype.close=function(){return this.Go.cancel()},t.prototype.getMetadata=function(){return Object(b.b)(this,void 0,void 0,function(){return Object(b.d)(this,function(t){return[2,this.metadata.promise]})})},t.prototype.Lo=function(){return Object(b.b)(this,void 0,void 0,function(){return Object(b.d)(this,function(t){switch(t.label){case 0:return[4,this.getMetadata()];case 1:return[2,(t.sent(),this.Ho())]}})})},t.prototype.Ho=function(){return Object(b.b)(this,void 0,void 0,function(){var t,e,n,r;return Object(b.d)(this,function(i){switch(i.label){case 0:return[4,this.Jo()];case 1:return null===(t=i.sent())?[2,null]:(e=this.zo.decode(t),n=Number(e),isNaN(n)&&this.Yo("length string ("+e+") is not valid number"),[4,this.Xo(n)]);case 2:return r=i.sent(),[2,new Sh(JSON.parse(r),t.length+n)]}})})},t.prototype.Zo=function(){return this.buffer.findIndex(function(t){return t==="{".charCodeAt(0)})},t.prototype.Jo=function(){return Object(b.b)(this,void 0,void 0,function(){var t,e;return Object(b.d)(this,function(n){switch(n.label){case 0:return this.Zo()<0?[4,this.tc()]:[3,3];case 1:if(n.sent())return[3,3];n.label=2;case 2:return[3,0];case 3:return 0===this.buffer.length?[2,null]:((t=this.Zo())<0&&this.Yo("Reached the end of bundle when a length string is expected."),e=this.buffer.slice(0,t),[2,(this.buffer=this.buffer.slice(t),e)])}})})},t.prototype.Xo=function(t){return Object(b.b)(this,void 0,void 0,function(){var e;return Object(b.d)(this,function(n){switch(n.label){case 0:return this.buffer.length<t?[4,this.tc()]:[3,3];case 1:n.sent()&&this.Yo("Reached the end of bundle when more is expected."),n.label=2;case 2:return[3,0];case 3:return e=this.zo.decode(this.buffer.slice(0,t)),[2,(this.buffer=this.buffer.slice(t),e)]}})})},t.prototype.Yo=function(t){throw this.Go.cancel(),new Error("Invalid bundle format: "+t)},t.prototype.tc=function(){return Object(b.b)(this,void 0,void 0,function(){var t,e;return Object(b.d)(this,function(n){switch(n.label){case 0:return[4,this.Go.read()];case 1:return(t=n.sent()).done||((e=new Uint8Array(this.buffer.length+t.value.length)).set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e),[2,t.done]}})})}}(),function(){function t(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}return t.prototype.lookup=function(t){return Object(b.b)(this,void 0,void 0,function(){var e,n=this;return Object(b.d)(this,function(r){switch(r.label){case 0:if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new Cr(kr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(t,e){return Object(b.b)(this,void 0,void 0,function(){var n,r,i,o,s,a;return Object(b.d)(this,function(u){switch(u.label){case 0:return n=Ur(t),r=Ls(n.R)+"/documents",i={documents:e.map(function(t){return Cs(n.R,t)})},[4,n.$i("BatchGetDocuments",r,i)];case 1:return o=u.sent(),s=new Map,o.forEach(function(t){var e=function(t,e){return"found"in e?function(t,e){qr(!!e.found);var n=xs(t,e.found.name),r=As(e.found.updateTime),i=new Ai({mapValue:{fields:e.found.fields}});return ki.newFoundDocument(n,r,i)}(t,e):"missing"in e?function(t,e){qr(!!e.missing),qr(!!e.readTime);var n=xs(t,e.missing),r=As(e.readTime);return ki.newNoDocument(n,r)}(t,e):Vr()}(n.R,t);s.set(e.key.toString(),e)}),a=[],[2,(e.forEach(function(t){var e=s.get(t.toString());qr(!!e),a.push(e)}),a)]}})})}(this.datastore,t)];case 1:return[2,((e=r.sent()).forEach(function(t){return n.recordVersion(t)}),e)]}})})},t.prototype.set=function(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.update=function(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())},t.prototype.delete=function(t){this.write(new Wo(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.commit=function(){return Object(b.b)(this,void 0,void 0,function(){var t,e=this;return Object(b.d)(this,function(n){switch(n.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return t=this.readVersions,this.mutations.forEach(function(e){t.delete(e.key.toString())}),t.forEach(function(t,n){var r=pi.fromPath(n);e.mutations.push(new Yo(r,e.precondition(r)))}),[4,function(t,e){return Object(b.b)(this,void 0,void 0,function(){var n,r,i;return Object(b.d)(this,function(o){switch(o.label){case 0:return n=Ur(t),r=Ls(n.R)+"/documents",i={writes:e.map(function(t){return qs(n.R,t)})},[4,n.Ni("Commit",r,i)];case 1:return o.sent(),[2]}})})}(this.datastore,this.mutations)];case 1:return n.sent(),this.committed=!0,[2]}})})},t.prototype.recordVersion=function(t){var e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw Vr();e=Wr.min()}var n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new Cr(kr.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)},t.prototype.precondition=function(t){var e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?xo.updateTime(e):xo.none()},t.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(Wr.min()))throw new Cr(kr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return xo.updateTime(e)}return xo.exists(!0)},t.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations.push(t)},t.prototype.ensureCommitNotCalled=function(){},t}()),vl=function(){function t(t,e,n,r){this.asyncQueue=t,this.datastore=e,this.updateFunction=n,this.deferred=r,this.ec=5,this.Zi=new Pc(this.asyncQueue,"transaction_retry")}return t.prototype.run=function(){this.ec-=1,this.nc()},t.prototype.nc=function(){var t=this;this.Zi.ji(function(){return Object(b.b)(t,void 0,void 0,function(){var t,e,n=this;return Object(b.d)(this,function(r){return t=new gl(this.datastore),(e=this.sc(t))&&e.then(function(e){n.asyncQueue.enqueueAndForget(function(){return t.commit().then(function(){n.deferred.resolve(e)}).catch(function(t){n.ic(t)})})}).catch(function(t){n.ic(t)}),[2]})})})},t.prototype.sc=function(t){try{var e=this.updateFunction(t);return!li(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}},t.prototype.ic=function(t){var e=this;this.ec>0&&this.rc(t)?(this.ec-=1,this.asyncQueue.enqueueAndForget(function(){return e.nc(),Promise.resolve()})):this.deferred.reject(t)},t.prototype.rc=function(t){if("FirebaseError"===t.name){var e=t.code;return"aborted"===e||"failed-precondition"===e||!$o(e)}return!1},t}(),ml=function(){function t(t,e,n){var r=this;this.credentials=t,this.asyncQueue=e,this.databaseInfo=n,this.user=gc.UNAUTHENTICATED,this.clientId=Kr.u(),this.credentialListener=function(){return Promise.resolve()},this.credentials.setChangeListener(e,function(t){return Object(b.b)(r,void 0,void 0,function(){return Object(b.d)(this,function(e){switch(e.label){case 0:return Pr("FirestoreClient","Received user=",t.uid),[4,this.credentialListener(t)];case 1:return e.sent(),this.user=t,[2]}})})})}return t.prototype.getConfiguration=function(){return Object(b.b)(this,void 0,void 0,function(){return Object(b.d)(this,function(t){return[2,{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100}]})})},t.prototype.setCredentialChangeListener=function(t){this.credentialListener=t},t.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new Cr(kr.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.terminate=function(){var t=this;this.asyncQueue.enterRestrictedMode();var e=new Oa;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(function(){return Object(b.b)(t,void 0,void 0,function(){var t,n;return Object(b.d)(this,function(r){switch(r.label){case 0:return r.trys.push([0,5,,6]),this.onlineComponents?[4,this.onlineComponents.terminate()]:[3,2];case 1:r.sent(),r.label=2;case 2:return this.offlineComponents?[4,this.offlineComponents.terminate()]:[3,4];case 3:r.sent(),r.label=4;case 4:return this.credentials.removeChangeListener(),e.resolve(),[3,6];case 5:return t=r.sent(),n=ph(t,"Failed to shutdown persistence"),e.reject(n),[3,6];case 6:return[2]}})})}),e.promise},t}();function bl(t,e){return Object(b.b)(this,void 0,void 0,function(){var n,r,i=this;return Object(b.d)(this,function(o){switch(o.label){case 0:return t.asyncQueue.verifyOperationInProgress(),Pr("FirestoreClient","Initializing OfflineComponentProvider"),[4,t.getConfiguration()];case 1:return n=o.sent(),[4,e.initialize(n)];case 2:return o.sent(),r=n.initialUser,t.setCredentialChangeListener(function(t){return Object(b.b)(i,void 0,void 0,function(){return Object(b.d)(this,function(n){switch(n.label){case 0:return r.isEqual(t)?[3,2]:[4,zu(e.localStore,t)];case 1:n.sent(),r=t,n.label=2;case 2:return[2]}})})}),e.persistence.setDatabaseDeletedListener(function(){return t.terminate()}),t.offlineComponents=e,[2]}})})}function wl(t,e){return Object(b.b)(this,void 0,void 0,function(){var n,r;return Object(b.d)(this,function(i){switch(i.label){case 0:return t.asyncQueue.verifyOperationInProgress(),[4,Il(t)];case 1:return n=i.sent(),Pr("FirestoreClient","Initializing OnlineComponentProvider"),[4,t.getConfiguration()];case 2:return r=i.sent(),[4,e.initialize(n,r)];case 3:return i.sent(),t.setCredentialChangeListener(function(t){return function(t,e){return Object(b.b)(this,void 0,void 0,function(){var n,r;return Object(b.d)(this,function(i){switch(i.label){case 0:return(n=Ur(t)).asyncQueue.verifyOperationInProgress(),Pr("RemoteStore","RemoteStore received new credentials"),r=Xc(n),n.Or.add(3),[4,Kc(n)];case 1:return i.sent(),r&&n.Br.set("Unknown"),[4,n.remoteSyncer.handleCredentialChange(e)];case 2:return i.sent(),n.Or.delete(3),[4,Bc(n)];case 3:return i.sent(),[2]}})})}(e.remoteStore,t)}),t.onlineComponents=e,[2]}})})}function Il(t){return Object(b.b)(this,void 0,void 0,function(){return Object(b.d)(this,function(e){switch(e.label){case 0:return t.offlineComponents?[3,2]:(Pr("FirestoreClient","Using default OfflineComponentProvider"),[4,bl(t,new ll)]);case 1:e.sent(),e.label=2;case 2:return[2,t.offlineComponents]}})})}function Tl(t){return Object(b.b)(this,void 0,void 0,function(){return Object(b.d)(this,function(e){switch(e.label){case 0:return t.onlineComponents?[3,2]:(Pr("FirestoreClient","Using default OnlineComponentProvider"),[4,wl(t,new pl)]);case 1:e.sent(),e.label=2;case 2:return[2,t.onlineComponents]}})})}function El(t){return Il(t).then(function(t){return t.persistence})}function _l(t){return Il(t).then(function(t){return t.localStore})}function Ol(t){return Tl(t).then(function(t){return t.remoteStore})}function Sl(t){return Tl(t).then(function(t){return t.syncEngine})}function Dl(t){return Object(b.b)(this,void 0,void 0,function(){var e,n;return Object(b.d)(this,function(r){switch(r.label){case 0:return[4,Tl(t)];case 1:return e=r.sent(),[2,((n=e.eventManager).onListen=Rh.bind(null,e.syncEngine),n.onUnlisten=Lh.bind(null,e.syncEngine),n)]}})})}function Nl(t,e,n){var r=this;void 0===n&&(n={});var i=new Oa;return t.asyncQueue.enqueueAndForget(function(){return Object(b.b)(r,void 0,void 0,function(){var r;return Object(b.d)(this,function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new yl({next:function(o){e.enqueueAndForget(function(){return Ih(t,s)});var a=o.docs.has(n);!a&&o.fromCache?i.reject(new Cr(kr.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&o.fromCache&&r&&"server"===r.source?i.reject(new Cr(kr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:function(t){return i.reject(t)}}),s=new Oh(to(n.path),o,{includeMetadataChanges:!0,so:!0});return wh(t,s)},[4,Dl(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.asyncQueue,e,n,i])]}})})}),i.promise}function Al(t,e,n){var r=this;void 0===n&&(n={});var i=new Oa;return t.asyncQueue.enqueueAndForget(function(){return Object(b.b)(r,void 0,void 0,function(){var r;return Object(b.d)(this,function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new yl({next:function(n){e.enqueueAndForget(function(){return Ih(t,s)}),n.fromCache&&"server"===r.source?i.reject(new Cr(kr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(t){return i.reject(t)}}),s=new Oh(n,o,{includeMetadataChanges:!0,so:!0});return wh(t,s)},[4,Dl(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.asyncQueue,e,n,i])]}})})}),i.promise}var jl=function(t,e,n,r,i,o,s,a){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=s,this.useFetchStreams=a},kl=function(){function t(t,e){this.projectId=t,this.database=e||"(default)"}return Object.defineProperty(t.prototype,"isDefaultDatabase",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t}(),Cl=new Map,xl=function(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+t},Rl=function(){function t(){this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t,e){this.changeListener=e,t.enqueueRetryable(function(){return e(gc.UNAUTHENTICATED)})},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),Pl=function(){function t(t){this.token=t,this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(this.token)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t,e){var n=this;this.changeListener=e,t.enqueueRetryable(function(){return e(n.token.user)})},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),Ll=function(){function t(t){var e=this;this.currentUser=gc.UNAUTHENTICATED,this.oc=new Oa,this.cc=0,this.forceRefresh=!1,this.auth=null,this.asyncQueue=null,this.uc=function(){e.cc++,e.currentUser=e.ac(),e.oc.resolve(),e.changeListener&&e.asyncQueue.enqueueRetryable(function(){return e.changeListener(e.currentUser)})};var n=function(t){Pr("FirebaseCredentialsProvider","Auth detected"),e.auth=t,e.auth.addAuthTokenListener(e.uc)};t.onInit(function(t){return n(t)}),setTimeout(function(){if(!e.auth){var r=t.getImmediate({optional:!0});r?n(r):(Pr("FirebaseCredentialsProvider","Auth not yet detected"),e.oc.resolve())}},0)}return t.prototype.getToken=function(){var t=this,e=this.cc,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(function(n){return t.cc!==e?(Pr("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):n?(qr("string"==typeof n.accessToken),new xl(n.accessToken,t.currentUser)):null}):Promise.resolve(null)},t.prototype.invalidateToken=function(){this.forceRefresh=!0},t.prototype.setChangeListener=function(t,e){var n=this;this.asyncQueue=t,this.asyncQueue.enqueueRetryable(function(){return Object(b.b)(n,void 0,void 0,function(){return Object(b.d)(this,function(t){switch(t.label){case 0:return[4,this.oc.promise];case 1:return t.sent(),[4,e(this.currentUser)];case 2:return t.sent(),this.changeListener=e,[2]}})})})},t.prototype.removeChangeListener=function(){this.auth&&this.auth.removeAuthTokenListener(this.uc),this.changeListener=function(){return Promise.resolve()}},t.prototype.ac=function(){var t=this.auth&&this.auth.getUid();return qr(null===t||"string"==typeof t),new gc(t)},t}(),Fl=function(){function t(t,e,n){this.hc=t,this.lc=e,this.fc=n,this.type="FirstParty",this.user=gc.FIRST_PARTY}return Object.defineProperty(t.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.lc},e=this.hc.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),this.fc&&(t["X-Goog-Iam-Authorization-Token"]=this.fc),t},enumerable:!1,configurable:!0}),t}(),Ml=function(){function t(t,e,n){this.hc=t,this.lc=e,this.fc=n}return t.prototype.getToken=function(){return Promise.resolve(new Fl(this.hc,this.lc,this.fc))},t.prototype.setChangeListener=function(t,e){t.enqueueRetryable(function(){return e(gc.FIRST_PARTY)})},t.prototype.removeChangeListener=function(){},t.prototype.invalidateToken=function(){},t}();function Vl(t,e,n){if(!n)throw new Cr(kr.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function ql(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new Cr(kr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function Ul(t,e,n,r){if(!0===e&&!0===r)throw new Cr(kr.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function Bl(t){if(!pi.isDocumentKey(t))throw new Cr(kr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t+" has "+t.length+".")}function Kl(t){if(pi.isDocumentKey(t))throw new Cr(kr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t+" has "+t.length+".")}function Gl(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":Vr()}function Ql(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Cr(kr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=Gl(t);throw new Cr(kr.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+n)}return t}function zl(t,e){if(e<=0)throw new Cr(kr.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}var Hl=function(){function t(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new Cr(kr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Cr(kr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,Ul("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams},t}(),Wl=function(){function t(t,e){this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Hl({}),this._settingsFrozen=!1,t instanceof kl?(this._databaseId=t,this._credentials=new Rl):(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Cr(kr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new kl(t.options.projectId)}(t),this._credentials=new Ll(e))}return Object.defineProperty(t.prototype,"app",{get:function(){if(!this._app)throw new Cr(kr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_initialized",{get:function(){return this._settingsFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_terminated",{get:function(){return void 0!==this._terminateTask},enumerable:!1,configurable:!0}),t.prototype._setSettings=function(t){if(this._settingsFrozen)throw new Cr(kr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Hl(t),void 0!==t.credentials&&(this._credentials=function(t){if(!t)return new Rl;switch(t.type){case"gapi":var e=t.client;return qr(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Ml(e,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new Cr(kr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},t.prototype._getSettings=function(){return this._settings},t.prototype._freezeSettings=function(){return this._settingsFrozen=!0,this._settings},t.prototype._delete=function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask},t.prototype.toJSON=function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}},t.prototype._terminate=function(){return(t=Cl.get(this))&&(Pr("ComponentProvider","Removing Datastore"),Cl.delete(this),t.terminate()),Promise.resolve();var t},t}(),Yl=function(){function t(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}return Object.defineProperty(t.prototype,"_path",{get:function(){return this._key.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new $l(this.firestore,this.converter,this._key.path.popLast())},enumerable:!1,configurable:!0}),t.prototype.withConverter=function(e){return new t(this.firestore,e,this._key)},t}(),Xl=function(){function t(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}return t.prototype.withConverter=function(e){return new t(this.firestore,e,this._query)},t}(),$l=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,to(r))||this)._path=r,i.type="collection",i}return Object(b.c)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._path.popLast();return t.isEmpty()?null:new Yl(this.firestore,null,new pi(t))},enumerable:!1,configurable:!0}),e.prototype.withConverter=function(t){return new e(this.firestore,t,this._path)},e}(Xl);function Jl(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=Object(w.h)(t),Vl("collection","path",e),t instanceof Wl)return Kl(n=Zr.fromString.apply(Zr,Object(b.f)([e],r))),new $l(t,null,n);if(!(t instanceof Yl||t instanceof $l))throw new Cr(kr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Kl(n=Zr.fromString.apply(Zr,Object(b.f)([t.path],r)).child(Zr.fromString(e))),new $l(t.firestore,null,n)}function Zl(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=Object(w.h)(t),1===arguments.length&&(e=Kr.u()),Vl("doc","path",e),t instanceof Wl)return Bl(n=Zr.fromString.apply(Zr,Object(b.f)([e],r))),new Yl(t,null,new pi(n));if(!(t instanceof Yl||t instanceof $l))throw new Cr(kr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Bl(n=t._path.child(Zr.fromString.apply(Zr,Object(b.f)([e],r)))),new Yl(t.firestore,t instanceof $l?t.converter:null,new pi(n))}function tf(t,e){return t=Object(w.h)(t),e=Object(w.h)(e),(t instanceof Yl||t instanceof $l)&&(e instanceof Yl||e instanceof $l)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter}function ef(t,e){return t=Object(w.h)(t),e=Object(w.h)(e),t instanceof Xl&&e instanceof Xl&&t.firestore===e.firestore&&co(t._query,e._query)&&t.converter===e.converter}var nf=function(){function t(){var t=this;this.dc=Promise.resolve(),this.wc=[],this._c=!1,this.mc=[],this.yc=null,this.gc=!1,this.Ec=!1,this.Tc=[],this.Zi=new Pc(this,"async_queue_retry"),this.Ic=function(){var e=xc();e&&Pr("AsyncQueue","Visibility state changed to "+e.visibilityState),t.Zi.Gi()};var e=xc();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Ic)}return Object.defineProperty(t.prototype,"isShuttingDown",{get:function(){return this._c},enumerable:!1,configurable:!0}),t.prototype.enqueueAndForget=function(t){this.enqueue(t)},t.prototype.enqueueAndForgetEvenWhileRestricted=function(t){this.Ac(),this.Rc(t)},t.prototype.enterRestrictedMode=function(t){if(!this._c){this._c=!0,this.Ec=t||!1;var e=xc();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.Ic)}},t.prototype.enqueue=function(t){var e=this;if(this.Ac(),this._c)return new Promise(function(){});var n=new Oa;return this.Rc(function(){return e._c&&e.Ec?Promise.resolve():(t().then(n.resolve,n.reject),n.promise)}).then(function(){return n.promise})},t.prototype.enqueueRetryable=function(t){var e=this;this.enqueueAndForget(function(){return e.wc.push(t),e.bc()})},t.prototype.bc=function(){return Object(b.b)(this,void 0,void 0,function(){var t,e=this;return Object(b.d)(this,function(n){switch(n.label){case 0:if(0===this.wc.length)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.wc[0]()];case 2:return n.sent(),this.wc.shift(),this.Zi.reset(),[3,4];case 3:if(!ka(t=n.sent()))throw t;return Pr("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:this.wc.length>0&&this.Zi.ji(function(){return e.bc()}),n.label=5;case 5:return[2]}})})},t.prototype.Rc=function(t){var e=this,n=this.dc.then(function(){return e.gc=!0,t().catch(function(t){throw e.yc=t,e.gc=!1,Lr("INTERNAL UNHANDLED ERROR: ",function(t){var e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t}).then(function(t){return e.gc=!1,t})});return this.dc=n,n},t.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.Ac(),this.Tc.indexOf(t)>-1&&(e=0);var i=dh.createAndSchedule(this,t,e,n,function(t){return r.vc(t)});return this.mc.push(i),i},t.prototype.Ac=function(){this.yc&&Vr()},t.prototype.verifyOperationInProgress=function(){},t.prototype.Pc=function(){return Object(b.b)(this,void 0,void 0,function(){var t;return Object(b.d)(this,function(e){switch(e.label){case 0:return[4,t=this.dc];case 1:e.sent(),e.label=2;case 2:if(t!==this.dc)return[3,0];e.label=3;case 3:return[2]}})})},t.prototype.Vc=function(t){for(var e=0,n=this.mc;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},t.prototype.Sc=function(t){var e=this;return this.Pc().then(function(){e.mc.sort(function(t,e){return t.targetTimeMs-e.targetTimeMs});for(var n=0,r=e.mc;n<r.length;n++){var i=r[n];if(i.skipDelay(),"all"!==t&&i.timerId===t)break}return e.Pc()})},t.prototype.Dc=function(t){this.Tc.push(t)},t.prototype.vc=function(t){var e=this.mc.indexOf(t);this.mc.splice(e,1)},t}();function rf(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=["next","error","complete"];r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t)}!function(){function t(){this._progressObserver={},this._taskCompletionResolver=new Oa,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}t.prototype.onProgress=function(t,e,n){this._progressObserver={next:t,error:e,complete:n}},t.prototype.catch=function(t){return this._taskCompletionResolver.promise.catch(t)},t.prototype.then=function(t,e){return this._taskCompletionResolver.promise.then(t,e)},t.prototype._completeWith=function(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)},t.prototype._failWith=function(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)},t.prototype._updateProgress=function(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}}();var of=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).type="firestore",r._queue=new nf,r._persistenceKey="name"in e?e.name:"[DEFAULT]",r}return Object(b.c)(e,t),e.prototype._terminate=function(){return this._firestoreClient||af(this),this._firestoreClient.terminate()},e}(Wl);function sf(t){return t._firestoreClient||af(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function af(t){var e,n=t._freezeSettings(),r=function(t,e,n,r){return new jl(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,r.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,n);t._firestoreClient=new ml(t._credentials,t._queue,r)}function uf(t,e,n){var r=this,i=new Oa;return t.asyncQueue.enqueue(function(){return Object(b.b)(r,void 0,void 0,function(){var r;return Object(b.d)(this,function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,bl(t,n)];case 1:return o.sent(),[4,wl(t,e)];case 2:return o.sent(),i.resolve(),[3,4];case 3:if(!function(t){return"FirebaseError"===t.name?t.code===kr.FAILED_PRECONDITION||t.code===kr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(r=o.sent()))throw r;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+r),i.reject(r),[3,4];case 4:return[2]}})})}).then(function(){return i.promise})}function cf(t){if(t._initialized||t._terminated)throw new Cr(kr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var hf=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;++n)if(0===t[n].length)throw new Cr(kr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ei(t)}return t.prototype.isEqual=function(t){return this._internalPath.isEqual(t._internalPath)},t}(),lf=function(){function t(t){this._byteString=t}return t.fromBase64String=function(e){try{return new t(ri.fromBase64String(e))}catch(e){throw new Cr(kr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}},t.fromUint8Array=function(e){return new t(ri.fromUint8Array(e))},t.prototype.toBase64=function(){return this._byteString.toBase64()},t.prototype.toUint8Array=function(){return this._byteString.toUint8Array()},t.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this._byteString.isEqual(t._byteString)},t}(),ff=function(t){this._methodName=t},df=function(){function t(t,e){if(!isFinite(t)||t<-90||t>90)throw new Cr(kr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new Cr(kr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this._long},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},t.prototype.toJSON=function(){return{latitude:this._lat,longitude:this._long}},t.prototype._compareTo=function(t){return Gr(this._lat,t._lat)||Gr(this._long,t._long)},t}(),pf=/^__.*__$/,yf=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return null!==this.fieldMask?new Bo(t,this.data,this.fieldMask,e,this.fieldTransforms):new Uo(t,this.data,e,this.fieldTransforms)},t}(),gf=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return new Bo(t,this.data,this.fieldMask,e,this.fieldTransforms)},t}();function vf(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Vr()}}var mf=function(){function t(t,e,n,r,i,o){this.settings=t,this.databaseId=e,this.R=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Cc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}return Object.defineProperty(t.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Nc",{get:function(){return this.settings.Nc},enumerable:!1,configurable:!0}),t.prototype.xc=function(e){return new t(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.R,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)},t.prototype.Fc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.xc({path:n,kc:!1});return r.$c(t),r},t.prototype.Oc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.xc({path:n,kc:!1});return r.Cc(),r},t.prototype.Mc=function(t){return this.xc({path:void 0,kc:!0})},t.prototype.Lc=function(t){return Mf(t,this.settings.methodName,this.settings.Bc||!1,this.path,this.settings.qc)},t.prototype.contains=function(t){return void 0!==this.fieldMask.find(function(e){return t.isPrefixOf(e)})||void 0!==this.fieldTransforms.find(function(e){return t.isPrefixOf(e.field)})},t.prototype.Cc=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.$c(this.path.get(t))},t.prototype.$c=function(t){if(0===t.length)throw this.Lc("Document fields must not be empty");if(vf(this.Nc)&&pf.test(t))throw this.Lc('Document fields cannot begin and end with "__"')},t}(),bf=function(){function t(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.R=n||Rc(t)}return t.prototype.Uc=function(t,e,n,r){return void 0===r&&(r=!1),new mf({Nc:t,methodName:e,qc:n,path:ei.emptyPath(),kc:!1,Bc:r},this.databaseId,this.R,this.ignoreUndefinedProperties)},t}();function wf(t){var e=t._freezeSettings(),n=Rc(t._databaseId);return new bf(t._databaseId,!!e.ignoreUndefinedProperties,n)}function If(t,e,n,r,i,o){void 0===o&&(o={});var s=t.Uc(o.merge||o.mergeFields?2:0,e,n,i);Rf("Data must be an object, but it was:",s,r);var a,u,c=Cf(r,s);if(o.merge)a=new ni(s.fieldMask),u=s.fieldTransforms;else if(o.mergeFields){for(var h=[],l=0,f=o.mergeFields;l<f.length;l++){var d=Pf(e,f[l],n);if(!s.contains(d))throw new Cr(kr.INVALID_ARGUMENT,"Field '"+d+"' is specified in your field mask but missing from your input data.");Vf(h,d)||h.push(d)}a=new ni(h),u=s.fieldTransforms.filter(function(t){return a.covers(t.field)})}else a=null,u=s.fieldTransforms;return new yf(new Ai(c),a,u)}var Tf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(b.c)(e,t),e.prototype._toFieldTransform=function(t){if(2!==t.Nc)throw t.Lc(1===t.Nc?this._methodName+"() can only appear at the top level of your update data":this._methodName+"() cannot be used with set() unless you pass {merge:true}");return t.fieldMask.push(t.path),null},e.prototype.isEqual=function(t){return t instanceof e},e}(ff);function Ef(t,e,n){return new mf({Nc:3,qc:e.settings.qc,methodName:t._methodName,kc:n},e.databaseId,e.R,e.ignoreUndefinedProperties)}var _f=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(b.c)(e,t),e.prototype._toFieldTransform=function(t){return new ko(t.path,new Eo)},e.prototype.isEqual=function(t){return t instanceof e},e}(ff),Of=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Kc=n,r}return Object(b.c)(e,t),e.prototype._toFieldTransform=function(t){var e=Ef(this,t,!0),n=this.Kc.map(function(t){return kf(t,e)}),r=new _o(n);return new ko(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(ff),Sf=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Kc=n,r}return Object(b.c)(e,t),e.prototype._toFieldTransform=function(t){var e=Ef(this,t,!0),n=this.Kc.map(function(t){return kf(t,e)}),r=new So(n);return new ko(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(ff),Df=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Qc=n,r}return Object(b.c)(e,t),e.prototype._toFieldTransform=function(t){var e=new No(t.R,mo(t.R,this.Qc));return new ko(t.path,e)},e.prototype.isEqual=function(t){return this===t},e}(ff);function Nf(t,e,n,r){var i=t.Uc(1,e,n);Rf("Data must be an object, but it was:",i,r);var o=[],s=Ai.empty();Xr(r,function(t,r){var a=Ff(e,t,n);r=Object(w.h)(r);var u=i.Oc(a);if(r instanceof Tf)o.push(a);else{var c=kf(r,u);null!=c&&(o.push(a),s.set(a,c))}});var a=new ni(o);return new gf(s,a,i.fieldTransforms)}function Af(t,e,n,r,i,o){var s=t.Uc(1,e,n),a=[Pf(e,r,n)],u=[i];if(o.length%2!=0)throw new Cr(kr.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)a.push(Pf(e,o[c])),u.push(o[c+1]);for(var h=[],l=Ai.empty(),f=a.length-1;f>=0;--f)if(!Vf(h,a[f])){var d=a[f],p=u[f];p=Object(w.h)(p);var y=s.Oc(d);if(p instanceof Tf)h.push(d);else{var g=kf(p,y);null!=g&&(h.push(d),l.set(d,g))}}var v=new ni(h);return new gf(l,v,s.fieldTransforms)}function jf(t,e,n,r){return void 0===r&&(r=!1),kf(n,t.Uc(r?4:3,e))}function kf(t,e){if(xf(t=Object(w.h)(t)))return Rf("Unsupported field value:",e,t),Cf(t,e);if(t instanceof ff)return function(t,e){if(!vf(e.Nc))throw e.Lc(t._methodName+"() can only be used with update() and set()");if(!e.path)throw e.Lc(t._methodName+"() is not currently supported inside arrays");var n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.kc&&4!==e.Nc)throw e.Lc("Nested arrays are not supported");return function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=kf(o[i],e.Mc(r));null==s&&(s={nullValue:"NULL_VALUE"}),n.push(s),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=Object(w.h)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return mo(e.R,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=Hr.fromDate(t);return{timestampValue:Ss(e.R,n)}}if(t instanceof Hr)return n=new Hr(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:Ss(e.R,n)};if(t instanceof df)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof lf)return{bytesValue:Ds(e.R,t._byteString)};if(t instanceof Yl){var r=t.firestore._databaseId;if(!r.isEqual(n=e.databaseId))throw e.Lc("Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return{referenceValue:js(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.Lc("Unsupported field value: "+Gl(t))}(t,e)}function Cf(t,e){var n={};return $r(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Xr(t,function(t,r){var i=kf(r,e.Fc(t));null!=i&&(n[t]=i)}),{mapValue:{fields:n}}}function xf(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Hr||t instanceof df||t instanceof lf||t instanceof Yl||t instanceof ff)}function Rf(t,e,n){if(!xf(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){var r=Gl(n);throw e.Lc("an object"===r?t+" a custom object":t+" "+r)}}function Pf(t,e,n){if((e=Object(w.h)(e))instanceof hf)return e._internalPath;if("string"==typeof e)return Ff(t,e);throw Mf("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}var Lf=new RegExp("[~\\*/\\[\\]]");function Ff(t,e,n){if(e.search(Lf)>=0)throw Mf("Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'",t,!1,void 0,n);try{return(new(hf.bind.apply(hf,Object(b.f)([void 0],e.split(".")))))._internalPath}catch(Md){throw Mf("Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",t,!1,void 0,n)}}function Mf(t,e,n,r,i){var o=r&&!r.isEmpty(),s=void 0!==i,a="Function "+e+"() called with invalid data";n&&(a+=" (via `toFirestore()`)");var u="";return(o||s)&&(u+=" (found",o&&(u+=" in field "+r),s&&(u+=" in document "+i),u+=")"),new Cr(kr.INVALID_ARGUMENT,(a+=". ")+t+u)}function Vf(t,e){return t.some(function(t){return t.isEqual(e)})}var qf=function(){function t(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}return Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new Yl(this._firestore,this._converter,this._key)},enumerable:!1,configurable:!0}),t.prototype.exists=function(){return null!==this._document},t.prototype.data=function(){if(this._document){if(this._converter){var t=new Uf(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}},t.prototype.get=function(t){if(this._document){var e=this._document.data.field(Bf("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}},t}(),Uf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(b.c)(e,t),e.prototype.data=function(){return t.prototype.data.call(this)},e}(qf);function Bf(t,e){return"string"==typeof e?Ff(t,e):e instanceof hf?e._internalPath:e._delegate._internalPath}var Kf=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),Gf=function(t){function e(e,n,r,i,o,s){var a=this;return(a=t.call(this,e,n,r,i,s)||this)._firestore=e,a._firestoreImpl=e,a.metadata=o,a}return Object(b.c)(e,t),e.prototype.exists=function(){return t.prototype.exists.call(this)},e.prototype.data=function(t){if(void 0===t&&(t={}),this._document){if(this._converter){var e=new Qf(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}},e.prototype.get=function(t,e){if(void 0===e&&(e={}),this._document){var n=this._document.data.field(Bf("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}},e}(qf),Qf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(b.c)(e,t),e.prototype.data=function(e){return void 0===e&&(e={}),t.prototype.data.call(this,e)},e}(Gf),zf=function(){function t(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new Kf(r.hasPendingWrites,r.fromCache),this.query=n}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach(function(e){return t.push(e)}),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;this._snapshot.docs.forEach(function(r){t.call(e,new Qf(n._firestore,n._userDataWriter,r.key,r,new Kf(n._snapshot.mutatedKeys.has(r.key),n._snapshot.fromCache),n.query.converter))})},t.prototype.docChanges=function(t){void 0===t&&(t={});var e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new Cr(kr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){var n=0;return t._snapshot.docChanges.map(function(e){return{type:"added",doc:new Qf(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Kf(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter),oldIndex:-1,newIndex:n++}})}var r=t._snapshot.oldDocs;return t._snapshot.docChanges.filter(function(t){return e||3!==t.type}).map(function(e){var n=new Qf(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Kf(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter),i=-1,o=-1;return 0!==e.type&&(i=r.indexOf(e.doc.key),r=r.delete(e.doc.key)),1!==e.type&&(o=(r=r.add(e.doc)).indexOf(e.doc.key)),{type:Hf(e.type),doc:n,oldIndex:i,newIndex:o}})}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},t}();function Hf(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Vr()}}function Wf(t,e){return t instanceof Gf&&e instanceof Gf?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof zf&&e instanceof zf&&t._firestore===e._firestore&&ef(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}function Yf(t){if(no(t)&&0===t.explicitOrderBy.length)throw new Cr(kr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Xf=function(){};function $f(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0,i=e;r<i.length;r++){var o=i[r];t=o._apply(t)}return t}var Jf=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).jc=e,i.Wc=n,i.Gc=r,i.type="where",i}return Object(b.c)(e,t),e.prototype._apply=function(t){var e=wf(t.firestore),n=function(t,e,n,r,i,o,s){var a;if(i.isKeyField()){if("array-contains"===o||"array-contains-any"===o)throw new Cr(kr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o+"' queries on FieldPath.documentId().");if("in"===o||"not-in"===o){od(s,o);for(var u=[],c=0,h=s;c<h.length;c++)u.push(id(r,t,h[c]));a={arrayValue:{values:u}}}else a=id(r,t,s)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||od(s,o),a=jf(n,"where",s,"in"===o||"not-in"===o);var l=Fi.create(i,o,a);return function(t,e){if(e.g()){var n=io(t);if(null!==n&&!n.isEqual(e.field))throw new Cr(kr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");var r=ro(t);null!==r&&sd(0,e.field,r)}var i=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(e.indexOf(i.op)>=0)return i.op}return null}(t,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==i)throw new Cr(kr.INVALID_ARGUMENT,i===e.op?"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter.":"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+i.toString()+"' filters.")}(t,l),l}(t._query,0,e,t.firestore._databaseId,this.jc,this.Wc,this.Gc);return new Xl(t.firestore,t.converter,function(t,e){var n=t.filters.concat([e]);return new Ji(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}(t._query,n))},e}(Xf),Zf=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).jc=e,r.zc=n,r.type="orderBy",r}return Object(b.c)(e,t),e.prototype._apply=function(t){var e=function(t,e,n){if(null!==t.startAt)throw new Cr(kr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new Cr(kr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new Wi(e,n);return function(t,e){if(null===ro(t)){var n=io(t);null!==n&&sd(0,n,e.field)}}(t,r),r}(t._query,this.jc,this.zc);return new Xl(t.firestore,t.converter,function(t,e){var n=t.explicitOrderBy.concat([e]);return new Ji(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t._query,e))},e}(Xf),td=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Hc=n,i.Jc=r,i}return Object(b.c)(e,t),e.prototype._apply=function(t){return new Xl(t.firestore,t.converter,uo(t._query,this.Hc,this.Jc))},e}(Xf),ed=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Yc=n,i.Xc=r,i}return Object(b.c)(e,t),e.prototype._apply=function(t){var e=rd(t,this.type,this.Yc,this.Xc);return new Xl(t.firestore,t.converter,function(t,e){return new Ji(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)}(t._query,e))},e}(Xf),nd=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Yc=n,i.Xc=r,i}return Object(b.c)(e,t),e.prototype._apply=function(t){var e=rd(t,this.type,this.Yc,this.Xc);return new Xl(t.firestore,t.converter,function(t,e){return new Ji(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)}(t._query,e))},e}(Xf);function rd(t,e,n,r){if(n[0]=Object(w.h)(n[0]),n[0]instanceof qf)return function(t,e,n,r,i){if(!r)throw new Cr(kr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");for(var o=[],s=0,a=so(t);s<a.length;s++){var u=a[s];if(u.field.isKeyField())o.push(Ti(e,r.key));else{var c=r.data.field(u.field);if(ui(c))throw new Cr(kr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+u.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===c){var h=u.field.canonicalString();throw new Cr(kr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+h+"' (used as the orderBy) does not exist.")}o.push(c)}}return new zi(o,i)}(t._query,t.firestore._databaseId,e,n[0]._document,r);var i=wf(t.firestore);return function(t,e,n,r,i,o){var s=t.explicitOrderBy;if(i.length>s.length)throw new Cr(kr.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var a=[],u=0;u<i.length;u++){var c=i[u];if(s[u].field.isKeyField()){if("string"!=typeof c)throw new Cr(kr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!oo(t)&&-1!==c.indexOf("/"))throw new Cr(kr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(Zr.fromString(c));if(!pi.isDocumentKey(h))throw new Cr(kr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");var l=new pi(h);a.push(Ti(e,l))}else{var f=jf(n,r,c);a.push(f)}}return new zi(a,o)}(t._query,t.firestore._databaseId,i,e,n,r)}function id(t,e,n){if("string"==typeof(n=Object(w.h)(n))){if(""===n)throw new Cr(kr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!oo(e)&&-1!==n.indexOf("/"))throw new Cr(kr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var r=e.path.child(Zr.fromString(n));if(!pi.isDocumentKey(r))throw new Cr(kr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+r+"' is not because it has an odd number of segments ("+r.length+").");return Ti(t,new pi(r))}if(n instanceof Yl)return Ti(t,n._key);throw new Cr(kr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Gl(n)+".")}function od(t,e){if(!Array.isArray(t)||0===t.length)throw new Cr(kr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(t.length>10)throw new Cr(kr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function sd(t,e,n){if(!n.isEqual(e))throw new Cr(kr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}var ad=function(){function t(){}return t.prototype.convertValue=function(t,e){switch(void 0===e&&(e="none"),yi(t)){case 0:return null;case 1:return t.booleanValue;case 2:return si(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(ai(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw Vr()}},t.prototype.convertObject=function(t,e){var n=this,r={};return Xr(t.fields,function(t,i){r[t]=n.convertValue(i,e)}),r},t.prototype.convertGeoPoint=function(t){return new df(si(t.latitude),si(t.longitude))},t.prototype.convertArray=function(t,e){var n=this;return(t.values||[]).map(function(t){return n.convertValue(t,e)})},t.prototype.convertServerTimestamp=function(t,e){switch(e){case"previous":var n=ci(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(hi(t));default:return null}},t.prototype.convertTimestamp=function(t){var e=oi(t);return new Hr(e.seconds,e.nanos)},t.prototype.convertDocumentKey=function(t,e){var n=Zr.fromString(t);qr(ea(n));var r=new kl(n.get(1),n.get(3)),i=new pi(n.popFirst(5));return r.isEqual(e)||Lr("Document "+i+" contains a document reference within a different database ("+r.projectId+"/"+r.database+") which is not supported. It will be treated as a reference in the current database ("+e.projectId+"/"+e.database+") instead."),i},t}();function ud(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var cd=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(b.c)(e,t),e.prototype.convertBytes=function(t){return new lf(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new Yl(this.firestore,null,e)},e}(ad),hd=function(){function t(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=wf(t)}return t.prototype.set=function(t,e,n){this._verifyNotCommitted();var r=ld(t,this._firestore),i=ud(r.converter,e,n),o=If(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(o.toMutation(r._key,xo.none())),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];this._verifyNotCommitted();var o,s=ld(t,this._firestore);return o="string"==typeof(e=Object(w.h)(e))||e instanceof hf?Af(this._dataReader,"WriteBatch.update",s._key,e,n,r):Nf(this._dataReader,"WriteBatch.update",s._key,e),this._mutations.push(o.toMutation(s._key,xo.exists(!0))),this},t.prototype.delete=function(t){this._verifyNotCommitted();var e=ld(t,this._firestore);return this._mutations=this._mutations.concat(new Wo(e._key,xo.none())),this},t.prototype.commit=function(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()},t.prototype._verifyNotCommitted=function(){if(this._committed)throw new Cr(kr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}();function ld(t,e){if((t=Object(w.h)(t)).firestore!==e)throw new Cr(kr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}var fd=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(b.c)(e,t),e.prototype.convertBytes=function(t){return new lf(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new Yl(this.firestore,null,e)},e}(ad);function dd(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t=Ql(t,Yl);var o=Ql(t.firestore,of),s=wf(o);return yd(o,[("string"==typeof(e=Object(w.h)(e))||e instanceof hf?Af(s,"updateDoc",t._key,e,n,r):Nf(s,"updateDoc",t._key,e)).toMutation(t._key,xo.exists(!0))])}function pd(t){for(var e,n,r,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];t=Object(w.h)(t);var s={includeMetadataChanges:!1},a=0;"object"!=typeof i[a]||rf(i[a])||(s=i[a],a++);var u,c,h,l={includeMetadataChanges:s.includeMetadataChanges};if(rf(i[a])){var f=i[a];i[a]=null===(e=f.next)||void 0===e?void 0:e.bind(f),i[a+1]=null===(n=f.error)||void 0===n?void 0:n.bind(f),i[a+2]=null===(r=f.complete)||void 0===r?void 0:r.bind(f)}if(t instanceof Yl)c=Ql(t.firestore,of),h=to(t._key.path),u={next:function(e){i[a]&&i[a](gd(c,t,e))},error:i[a+1],complete:i[a+2]};else{var d=Ql(t,Xl);c=Ql(d.firestore,of),h=d._query;var p=new fd(c);u={next:function(t){i[a]&&i[a](new zf(c,p,d,t))},error:i[a+1],complete:i[a+2]},Yf(t._query)}return function(t,e,n,r){var i=this,o=new yl(r),s=new Oh(e,o,n);return t.asyncQueue.enqueueAndForget(function(){return Object(b.b)(i,void 0,void 0,function(){var e;return Object(b.d)(this,function(n){switch(n.label){case 0:return e=wh,[4,Dl(t)];case 1:return[2,e.apply(void 0,[n.sent(),s])]}})})}),function(){o.Wo(),t.asyncQueue.enqueueAndForget(function(){return Object(b.b)(i,void 0,void 0,function(){var e;return Object(b.d)(this,function(n){switch(n.label){case 0:return e=Ih,[4,Dl(t)];case 1:return[2,e.apply(void 0,[n.sent(),s])]}})})})}}(sf(c),h,l,u)}function yd(t,e){return function(t,e){var n=this,r=new Oa;return t.asyncQueue.enqueueAndForget(function(){return Object(b.b)(n,void 0,void 0,function(){var n;return Object(b.d)(this,function(i){switch(i.label){case 0:return n=Fh,[4,Sl(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}})})}),r.promise}(sf(t),e)}function gd(t,e,n){var r=n.docs.get(e._key),i=new fd(t);return new Gf(t,i,e._key,r,new Kf(n.hasPendingWrites,n.fromCache),e.converter)}var vd=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this)._firestore=e,r}return Object(b.c)(e,t),e.prototype.get=function(e){var n=this,r=ld(e,this._firestore),i=new fd(this._firestore);return t.prototype.get.call(this,e).then(function(t){return new Gf(n._firestore,i,r._key,t._document,new Kf(!1,!1),r.converter)})},e}(function(){function t(t,e){this._firestore=t,this._transaction=e,this._dataReader=wf(t)}return t.prototype.get=function(t){var e=this,n=ld(t,this._firestore),r=new cd(this._firestore);return this._transaction.lookup([n._key]).then(function(t){if(!t||1!==t.length)return Vr();var i=t[0];if(i.isFoundDocument())return new qf(e._firestore,r,i.key,i,n.converter);if(i.isNoDocument())return new qf(e._firestore,r,n._key,null,n.converter);throw Vr()})},t.prototype.set=function(t,e,n){var r=ld(t,this._firestore),i=ud(r.converter,e,n),o=If(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,o),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o,s=ld(t,this._firestore);return o="string"==typeof(e=Object(w.h)(e))||e instanceof hf?Af(this._dataReader,"Transaction.update",s._key,e,n,r):Nf(this._dataReader,"Transaction.update",s._key,e),this._transaction.update(s._key,o),this},t.prototype.delete=function(t){var e=ld(t,this._firestore);return this._transaction.delete(e._key),this},t}());function md(){if("undefined"==typeof Uint8Array)throw new Cr(kr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function bd(){if("undefined"==typeof atob)throw new Cr(kr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var wd=function(){function t(t){this._delegate=t}return t.fromBase64String=function(e){return bd(),new t(lf.fromBase64String(e))},t.fromUint8Array=function(e){return md(),new t(lf.fromUint8Array(e))},t.prototype.toBase64=function(){return bd(),this._delegate.toBase64()},t.prototype.toUint8Array=function(){return md(),this._delegate.toUint8Array()},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},t}(),Id=function(){function t(){}return t.prototype.enableIndexedDbPersistence=function(t,e){return function(t,e){cf(t=Ql(t,of));var n=sf(t),r=t._freezeSettings(),i=new pl;return uf(n,i,new fl(i,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t._delegate,{forceOwnership:e})},t.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(t){cf(t=Ql(t,of));var e=sf(t),n=t._freezeSettings(),r=new pl;return uf(e,r,new dl(r,n.cacheSizeBytes))}(t._delegate)},t.prototype.clearIndexedDbPersistence=function(t){return function(t){var e=this;if(t._initialized&&!t._terminated)throw new Cr(kr.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var n=new Oa;return t._queue.enqueueAndForgetEvenWhileRestricted(function(){return Object(b.b)(e,void 0,void 0,function(){var e;return Object(b.d)(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,function(t){return Object(b.b)(this,void 0,void 0,function(){return Object(b.d)(this,function(e){switch(e.label){case 0:return Na.yt()?[4,Na.delete(t+"main")]:[2,Promise.resolve()];case 1:return e.sent(),[2]}})})}(Vu(t._databaseId,t._persistenceKey))];case 1:return r.sent(),n.resolve(),[3,3];case 2:return e=r.sent(),n.reject(e),[3,3];case 3:return[2]}})})}),n.promise}(t._delegate)},t}(),Td=function(){function t(t,e,n){var r=this;this._delegate=e,this.Zc=n,this.INTERNAL={delete:function(){return r.terminate()}},t instanceof kl||(this.tu=t)}return Object.defineProperty(t.prototype,"_databaseId",{get:function(){return this._delegate._databaseId},enumerable:!1,configurable:!0}),t.prototype.settings=function(t){var e=this._delegate._getSettings();t.merge||e.host===t.host||Fr("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),t.merge&&delete(t=Object.assign(Object.assign({},e),t)).merge,this._delegate._setSettings(t)},t.prototype.useEmulator=function(t,e,n){void 0===n&&(n={}),function(t,e,n,r){void 0===r&&(r={});var i=(t=Ql(t,Wl))._getSettings();if("firestore.googleapis.com"!==i.host&&i.host!==e&&Fr("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},i),{host:e+":"+n,ssl:!1})),r.mockUserToken){var o=Object(w.d)(r.mockUserToken),s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new Cr(kr.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");t._credentials=new Pl(new xl(o,new gc(s)))}}(this._delegate,t,e,n)},t.prototype.enableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue(function(){return Object(b.b)(e,void 0,void 0,function(){var e,n;return Object(b.d)(this,function(r){switch(r.label){case 0:return[4,El(t)];case 1:return e=r.sent(),[4,Ol(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!0),function(t){var e=Ur(t);return e.Or.delete(0),Bc(e)}(n))]}})})})}(sf(Ql(this._delegate,of)))},t.prototype.disableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue(function(){return Object(b.b)(e,void 0,void 0,function(){var e,n;return Object(b.d)(this,function(r){switch(r.label){case 0:return[4,El(t)];case 1:return e=r.sent(),[4,Ol(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!1),function(t){return Object(b.b)(this,void 0,void 0,function(){var e;return Object(b.d)(this,function(n){switch(n.label){case 0:return(e=Ur(t)).Or.add(0),[4,Kc(e)];case 1:return n.sent(),e.Br.set("Offline"),[2]}})})}(n))]}})})})}(sf(Ql(this._delegate,of)))},t.prototype.enablePersistence=function(t){var e=!1,n=!1;return t&&Ul("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.Zc.enableMultiTabIndexedDbPersistence(this):this.Zc.enableIndexedDbPersistence(this,n)},t.prototype.clearPersistence=function(){return this.Zc.clearIndexedDbPersistence(this)},t.prototype.terminate=function(){return this.tu&&(this.tu._removeServiceInstance("firestore"),this.tu._removeServiceInstance("firestore-exp")),this._delegate._delete()},t.prototype.waitForPendingWrites=function(){return function(t){var e=this,n=new Oa;return t.asyncQueue.enqueueAndForget(function(){return Object(b.b)(e,void 0,void 0,function(){var e;return Object(b.d)(this,function(r){switch(r.label){case 0:return e=Kh,[4,Sl(t)];case 1:return[2,e.apply(void 0,[r.sent(),n])]}})})}),n.promise}(sf(Ql(this._delegate,of)))},t.prototype.onSnapshotsInSync=function(t){return function(t,e){return function(t,e){var n=this,r=new yl(e);return t.asyncQueue.enqueueAndForget(function(){return Object(b.b)(n,void 0,void 0,function(){var e;return Object(b.d)(this,function(n){switch(n.label){case 0:return e=function(t,e){Ur(t).Gr.add(e),e.next()},[4,Dl(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}})})}),function(){r.Wo(),t.asyncQueue.enqueueAndForget(function(){return Object(b.b)(n,void 0,void 0,function(){var e;return Object(b.d)(this,function(n){switch(n.label){case 0:return e=function(t,e){Ur(t).Gr.delete(e)},[4,Dl(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}})})})}}(sf(t=Ql(t,of)),rf(e)?e:{next:e})}(this._delegate,t)},Object.defineProperty(t.prototype,"app",{get:function(){if(!this.tu)throw new Cr(kr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.tu},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new Ld(this,Jl(this._delegate,t))}catch(t){throw Nd(t,"collection()","Firestore.collection()")}},t.prototype.doc=function(t){try{return new Dd(this,Zl(this._delegate,t))}catch(t){throw Nd(t,"doc()","Firestore.doc()")}},t.prototype.collectionGroup=function(t){try{return new xd(this,function(t,e){if(t=Ql(t,Wl),Vl("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new Cr(kr.INVALID_ARGUMENT,"Invalid collection ID '"+e+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new Xl(t,null,function(t){return new Ji(Zr.emptyPath(),t)}(e))}(this._delegate,t))}catch(t){throw Nd(t,"collectionGroup()","Firestore.collectionGroup()")}},t.prototype.runTransaction=function(t){var e=this;return function(t,e){return function(t,e){var n=this,r=new Oa;return t.asyncQueue.enqueueAndForget(function(){return Object(b.b)(n,void 0,void 0,function(){var n;return Object(b.d)(this,function(i){switch(i.label){case 0:return[4,function(t){return Tl(t).then(function(t){return t.datastore})}(t)];case 1:return n=i.sent(),new vl(t.asyncQueue,n,e,r).run(),[2]}})})}),r.promise}(sf(t),function(n){return e(new vd(t,n))})}(this._delegate,function(n){return t(new _d(e,n))})},t.prototype.batch=function(){var t=this;return sf(this._delegate),new Od(new hd(this._delegate,function(e){return yd(t._delegate,e)}))},t.prototype.loadBundle=function(t){throw new Cr(kr.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},t.prototype.namedQuery=function(t){throw new Cr(kr.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},t}(),Ed=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(b.c)(e,t),e.prototype.convertBytes=function(t){return new wd(new lf(t))},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return Dd.eu(e,this.firestore,null)},e}(ad),_d=function(){function t(t,e){this._firestore=t,this._delegate=e,this._userDataWriter=new Ed(t)}return t.prototype.get=function(t){var e=this,n=Fd(t);return this._delegate.get(n).then(function(t){return new kd(e._firestore,new Gf(e._firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,n.converter))})},t.prototype.set=function(t,e,n){var r=Fd(t);return n?(ql("Transaction.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s=Fd(t);return 2===arguments.length?this._delegate.update(s,e):(r=this._delegate).update.apply(r,Object(b.f)([s,e,n],i)),this},t.prototype.delete=function(t){var e=Fd(t);return this._delegate.delete(e),this},t}(),Od=function(){function t(t){this._delegate=t}return t.prototype.set=function(t,e,n){var r=Fd(t);return n?(ql("WriteBatch.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s=Fd(t);return 2===arguments.length?this._delegate.update(s,e):(r=this._delegate).update.apply(r,Object(b.f)([s,e,n],i)),this},t.prototype.delete=function(t){var e=Fd(t);return this._delegate.delete(e),this},t.prototype.commit=function(){return this._delegate.commit()},t}(),Sd=function(){function t(t,e,n){this._firestore=t,this._userDataWriter=e,this._delegate=n}return t.prototype.fromFirestore=function(t,e){var n=new Qf(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new Cd(this._firestore,n),null!=e?e:{})},t.prototype.toFirestore=function(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)},t.nu=function(e,n){var r=t.su,i=r.get(e);i||(i=new WeakMap,r.set(e,i));var o=i.get(n);return o||(o=new t(e,new Ed(e),n),i.set(n,o)),o},t}();Sd.su=new WeakMap;var Dd=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new Ed(t)}return t.iu=function(e,n,r){if(e.length%2!=0)throw new Cr(kr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e.canonicalString()+" has "+e.length);return new t(n,new Yl(n._delegate,r,new pi(e)))},t.eu=function(e,n,r){return new t(n,new Yl(n._delegate,r,e))},Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new Ld(this.firestore,this._delegate.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new Ld(this.firestore,Jl(this._delegate,t))}catch(t){throw Nd(t,"collection()","DocumentReference.collection()")}},t.prototype.isEqual=function(t){return(t=Object(w.h)(t))instanceof Yl&&tf(this._delegate,t)},t.prototype.set=function(t,e){e=ql("DocumentReference.set",e);try{return function(t,e,n){t=Ql(t,Yl);var r=Ql(t.firestore,of),i=ud(t.converter,e,n);return yd(r,[If(wf(r),"setDoc",t._key,i,null!==t.converter,n).toMutation(t._key,xo.none())])}(this._delegate,t,e)}catch(t){throw Nd(t,"setDoc()","DocumentReference.set()")}},t.prototype.update=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];try{return 1===arguments.length?dd(this._delegate,t):dd.apply(void 0,Object(b.f)([this._delegate,t,e],n))}catch(t){throw Nd(t,"updateDoc()","DocumentReference.update()")}},t.prototype.delete=function(){return yd(Ql((t=this._delegate).firestore,of),[new Wo(t._key,xo.none())]);var t},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=Ad(e),i=jd(e,function(e){return new kd(t.firestore,new Gf(t.firestore._delegate,t._userDataWriter,e._key,e._document,e.metadata,t._delegate.converter))});return pd(this._delegate,r,i)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=Ql(t,Yl);var e=Ql(t.firestore,of),n=sf(e),r=new fd(e);return function(t,e){var n=this,r=new Oa;return t.asyncQueue.enqueueAndForget(function(){return Object(b.b)(n,void 0,void 0,function(){var n;return Object(b.d)(this,function(i){switch(i.label){case 0:return n=function(t,e,n){return Object(b.b)(this,void 0,void 0,function(){var r,i;return Object(b.d)(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,function(t,e){var n=Ur(t);return n.persistence.runTransaction("read document","readonly",function(t){return n.Mn.mn(t,e)})}(t,e)];case 1:return(i=o.sent()).isFoundDocument()?n.resolve(i):i.isNoDocument()?n.resolve(null):n.reject(new Cr(kr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=o.sent(),i=ph(r,"Failed to get document '"+e+" from cache"),n.reject(i),[3,3];case 3:return[2]}})})},[4,_l(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}})})}),r.promise}(n,t._key).then(function(n){return new Gf(e,r,t._key,n,new Kf(null!==n&&n.hasLocalMutations,!0),t.converter)})}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=Ql(t,Yl);var e=Ql(t.firestore,of);return Nl(sf(e),t._key,{source:"server"}).then(function(n){return gd(e,t,n)})}(this._delegate):function(t){t=Ql(t,Yl);var e=Ql(t.firestore,of);return Nl(sf(e),t._key).then(function(n){return gd(e,t,n)})}(this._delegate)).then(function(t){return new kd(e.firestore,new Gf(e.firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,e._delegate.converter))})},t.prototype.withConverter=function(e){return new t(this.firestore,this._delegate.withConverter(e?Sd.nu(this.firestore,e):null))},t}();function Nd(t,e,n){return t.message=t.message.replace(e,n),t}function Ad(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if("object"==typeof r&&!rf(r))return r}return{}}function jd(t,e){var n,r,i;return{next:function(t){i.next&&i.next(e(t))},error:null===(n=(i=rf(t[0])?t[0]:rf(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]}).error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}var kd=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"ref",{get:function(){return new Dd(this._firestore,this._delegate.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"exists",{get:function(){return this._delegate.exists()},enumerable:!1,configurable:!0}),t.prototype.data=function(t){return this._delegate.data(t)},t.prototype.get=function(t,e){return this._delegate.get(t,e)},t.prototype.isEqual=function(t){return Wf(this._delegate,t._delegate)},t}(),Cd=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(b.c)(e,t),e.prototype.data=function(t){return this._delegate.data(t)},e}(kd),xd=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new Ed(t)}return t.prototype.where=function(e,n,r){try{return new t(this.firestore,$f(this._delegate,function(t,e,n){var r=e,i=Bf("where",t);return new Jf(i,r,n)}(e,n,r)))}catch(e){throw Nd(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.orderBy=function(e,n){try{return new t(this.firestore,$f(this._delegate,function(t,e){void 0===e&&(e="asc");var n=e,r=Bf("orderBy",t);return new Zf(r,n)}(e,n)))}catch(e){throw Nd(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.limit=function(e){try{return new t(this.firestore,$f(this._delegate,function(t){return zl("limit",t),new td("limit",t,"F")}(e)))}catch(e){throw Nd(e,"limit()","Query.limit()")}},t.prototype.limitToLast=function(e){try{return new t(this.firestore,$f(this._delegate,function(t){return zl("limitToLast",t),new td("limitToLast",t,"L")}(e)))}catch(e){throw Nd(e,"limitToLast()","Query.limitToLast()")}},t.prototype.startAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,$f(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new ed("startAt",t,!0)}).apply(void 0,e)))}catch(e){throw Nd(e,"startAt()","Query.startAt()")}},t.prototype.startAfter=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,$f(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new ed("startAfter",t,!1)}).apply(void 0,e)))}catch(e){throw Nd(e,"startAfter()","Query.startAfter()")}},t.prototype.endBefore=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,$f(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new nd("endBefore",t,!0)}).apply(void 0,e)))}catch(e){throw Nd(e,"endBefore()","Query.endBefore()")}},t.prototype.endAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,$f(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new nd("endAt",t,!1)}).apply(void 0,e)))}catch(e){throw Nd(e,"endAt()","Query.endAt()")}},t.prototype.isEqual=function(t){return ef(this._delegate,t._delegate)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=Ql(t,Xl);var e=Ql(t.firestore,of),n=sf(e),r=new fd(e);return function(t,e){var n=this,r=new Oa;return t.asyncQueue.enqueueAndForget(function(){return Object(b.b)(n,void 0,void 0,function(){var n;return Object(b.d)(this,function(i){switch(i.label){case 0:return n=function(t,e,n){return Object(b.b)(this,void 0,void 0,function(){var r,i,o,s,a;return Object(b.d)(this,function(u){switch(u.label){case 0:return u.trys.push([0,2,,3]),[4,tc(t,e,!0)];case 1:return a=u.sent(),r=new jh(e,a.Bn),i=r._o(a.documents),o=r.applyChanges(i,!1),n.resolve(o.snapshot),[3,3];case 2:return s=u.sent(),a=ph(s,"Failed to execute query '"+e+" against cache"),n.reject(a),[3,3];case 3:return[2]}})})},[4,_l(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}})})}),r.promise}(n,t._query).then(function(n){return new zf(e,r,t,n)})}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=Ql(t,Xl);var e=Ql(t.firestore,of),n=sf(e),r=new fd(e);return Al(n,t._query,{source:"server"}).then(function(n){return new zf(e,r,t,n)})}(this._delegate):function(t){t=Ql(t,Xl);var e=Ql(t.firestore,of),n=sf(e),r=new fd(e);return Yf(t._query),Al(n,t._query).then(function(n){return new zf(e,r,t,n)})}(this._delegate)).then(function(t){return new Pd(e.firestore,new zf(e.firestore._delegate,e._userDataWriter,e._delegate,t._snapshot))})},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=Ad(e),i=jd(e,function(e){return new Pd(t.firestore,new zf(t.firestore._delegate,t._userDataWriter,t._delegate,e._snapshot))});return pd(this._delegate,r,i)},t.prototype.withConverter=function(e){return new t(this.firestore,this._delegate.withConverter(e?Sd.nu(this.firestore,e):null))},t}(),Rd=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"type",{get:function(){return this._delegate.type},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"doc",{get:function(){return new Cd(this._firestore,this._delegate.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"oldIndex",{get:function(){return this._delegate.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"newIndex",{get:function(){return this._delegate.newIndex},enumerable:!1,configurable:!0}),t}(),Pd=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"query",{get:function(){return new xd(this._firestore,this._delegate.query)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._delegate.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return this._delegate.empty},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"docs",{get:function(){var t=this;return this._delegate.docs.map(function(e){return new Cd(t._firestore,e)})},enumerable:!1,configurable:!0}),t.prototype.docChanges=function(t){var e=this;return this._delegate.docChanges(t).map(function(t){return new Rd(e._firestore,t)})},t.prototype.forEach=function(t,e){var n=this;this._delegate.forEach(function(r){t.call(e,new Cd(n._firestore,r))})},t.prototype.isEqual=function(t){return Wf(this._delegate,t._delegate)},t}(),Ld=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).firestore=e,r._delegate=n,r}return Object(b.c)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._delegate.parent;return t?new Dd(this.firestore,t):null},enumerable:!1,configurable:!0}),e.prototype.doc=function(t){try{return new Dd(this.firestore,void 0===t?Zl(this._delegate):Zl(this._delegate,t))}catch(t){throw Nd(t,"doc()","CollectionReference.doc()")}},e.prototype.add=function(t){var e=this;return function(t,e){var n=Ql(t.firestore,of),r=Zl(t),i=ud(t.converter,e);return yd(n,[If(wf(t.firestore),"addDoc",r._key,i,null!==t.converter,{}).toMutation(r._key,xo.exists(!1))]).then(function(){return r})}(this._delegate,t).then(function(t){return new Dd(e.firestore,t)})},e.prototype.isEqual=function(t){return tf(this._delegate,t._delegate)},e.prototype.withConverter=function(t){return new e(this.firestore,this._delegate.withConverter(t?Sd.nu(this.firestore,t):null))},e}(xd);function Fd(t){return Ql(t,Yl)}var Md,Vd=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._delegate=new(hf.bind.apply(hf,Object(b.f)([void 0],t)))}return t.documentId=function(){return new t(ei.keyField().canonicalString())},t.prototype.isEqual=function(t){return(t=Object(w.h)(t))instanceof hf&&this._delegate._internalPath.isEqual(t._internalPath)},t}(),qd=function(){function t(t){this._delegate=t}return t.serverTimestamp=function(){var e=new _f("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new t(e)},t.delete=function(){var e=new Tf("deleteField");return e._methodName="FieldValue.delete",new t(e)},t.arrayUnion=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Of("arrayUnion",t)}).apply(void 0,e);return r._methodName="FieldValue.arrayUnion",new t(r)},t.arrayRemove=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Sf("arrayRemove",t)}).apply(void 0,e);return r._methodName="FieldValue.arrayRemove",new t(r)},t.increment=function(e){var n=function(t){return new Df("increment",t)}(e);return n._methodName="FieldValue.increment",new t(n)},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t}(),Ud=n("/6Yf"),Bd={Firestore:Td,GeoPoint:df,Timestamp:Hr,Blob:wd,Transaction:_d,WriteBatch:Od,DocumentReference:Dd,DocumentSnapshot:kd,Query:xd,QueryDocumentSnapshot:Cd,QuerySnapshot:Pd,CollectionReference:Ld,FieldPath:Vd,FieldValue:qd,setLogLevel:function(t){xr.setLogLevel(t)},CACHE_SIZE_UNLIMITED:-1};(function(t,e){t.INTERNAL.registerComponent(new Ud.a("firestore",function(t){return function(t,e){return new Td(t,new of(t,e),new Id)}(t.getProvider("app").getImmediate(),t.getProvider("auth-internal"))},"PUBLIC").setServiceProps(Object.assign({},Bd)))})(Md=m.a),Md.registerVersion("@firebase/firestore","2.3.9");var Kd=n("UbJi");function Gd(t,e){return function(t,e=i.b){return new o.a(n=>{let r;return null!=e?e.schedule(()=>{r=t.onSnapshot({includeMetadataChanges:!0},n)}):r=t.onSnapshot({includeMetadataChanges:!0},n),()=>{null!=r&&r()}})}(t,e)}function Qd(t,e){return Gd(t,e).pipe(Object(h.a)(t=>({payload:t,type:"query"})))}function zd(t,e){return Qd(t,e).pipe(Object(u.a)(void 0),Object(c.a)(),Object(h.a)(([t,e])=>{const n=e.payload.docChanges(),r=n.map(t=>({type:t.type,payload:t}));return t&&JSON.stringify(t.payload.metadata)!==JSON.stringify(e.payload.metadata)&&e.payload.docs.forEach((e,i)=>{const o=n.find(t=>t.doc.ref.isEqual(e.ref)),s=null==t?void 0:t.payload.docs.find(t=>t.ref.isEqual(e.ref));o&&JSON.stringify(o.doc.metadata)===JSON.stringify(e.metadata)||!o&&s&&JSON.stringify(s.metadata)===JSON.stringify(e.metadata)||r.push({type:"modified",payload:{oldIndex:i,newIndex:i,type:"modified",doc:e}})}),r}))}function Hd(t,e,n){return zd(t,n).pipe(Object(l.a)((t,n)=>function(t,e,n){return e.forEach(e=>{n.indexOf(e.type)>-1&&(t=function(t,e){switch(e.type){case"added":if(!t[e.newIndex]||!t[e.newIndex].doc.ref.isEqual(e.doc.ref))return Wd(t,e.newIndex,0,e);break;case"modified":if(null==t[e.oldIndex]||t[e.oldIndex].doc.ref.isEqual(e.doc.ref)){if(e.oldIndex!==e.newIndex){const n=t.slice();return n.splice(e.oldIndex,1),n.splice(e.newIndex,0,e),n}return Wd(t,e.newIndex,1,e)}break;case"removed":if(t[e.oldIndex]&&t[e.oldIndex].doc.ref.isEqual(e.doc.ref))return Wd(t,e.oldIndex,1)}return t}(t,e))}),t}(t,n.map(t=>t.payload),e),[]),Object(f.a)(),Object(h.a)(t=>t.map(t=>({type:t.type,payload:t}))))}function Wd(t,e,n,...r){const i=t.slice();return i.splice(e,n,...r),i}function Yd(t){return t&&0!==t.length||(t=["added","removed","modified"]),t}class Xd{constructor(t,e,n){this.ref=t,this.query=e,this.afs=n}stateChanges(t){let e=zd(this.query,this.afs.schedulers.outsideAngular);return t&&t.length>0&&(e=e.pipe(Object(h.a)(e=>e.filter(e=>t.indexOf(e.type)>-1)))),e.pipe(Object(u.a)(void 0),Object(c.a)(),Object(d.a)(([t,e])=>e.length>0||!t),Object(h.a)(([t,e])=>e),this.afs.keepUnstableUntilFirst)}auditTrail(t){return this.stateChanges(t).pipe(Object(l.a)((t,e)=>[...t,...e],[]))}snapshotChanges(t){const e=Yd(t);return Hd(this.query,e,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(t={}){return Qd(this.query,this.afs.schedulers.outsideAngular).pipe(Object(h.a)(e=>e.payload.docs.map(e=>t.idField?Object.assign(Object.assign({},e.data()),{[t.idField]:e.id}):e.data())),this.afs.keepUnstableUntilFirst)}get(t){return Object(s.a)(this.query.get(t)).pipe(Object(p.b)(this.afs.schedulers.insideAngular))}add(t){return this.ref.add(t)}doc(t){return new $d(this.ref.doc(t),this.afs)}}class $d{constructor(t,e){this.ref=t,this.afs=e}set(t,e){return this.ref.set(t,e)}update(t){return this.ref.update(t)}delete(){return this.ref.delete()}collection(t,e){const n=this.ref.collection(t),{ref:r,query:i}=rp(n,e);return new Xd(r,i,this.afs)}snapshotChanges(){return Gd(this.ref,this.afs.schedulers.outsideAngular).pipe(Object(u.a)(void 0),Object(c.a)(),Object(h.a)(([t,e])=>e.exists?(null==t?void 0:t.exists)?{payload:e,type:"modified"}:{payload:e,type:"added"}:{payload:e,type:"removed"})).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(t={}){return this.snapshotChanges().pipe(Object(h.a)(({payload:e})=>t.idField?Object.assign(Object.assign({},e.data()),{[t.idField]:e.id}):e.data()))}get(t){return Object(s.a)(this.ref.get(t)).pipe(Object(p.b)(this.afs.schedulers.insideAngular))}}class Jd{constructor(t,e){this.query=t,this.afs=e}stateChanges(t){return t&&0!==t.length?zd(this.query,this.afs.schedulers.outsideAngular).pipe(Object(h.a)(e=>e.filter(e=>t.indexOf(e.type)>-1)),Object(d.a)(t=>t.length>0),this.afs.keepUnstableUntilFirst):zd(this.query,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}auditTrail(t){return this.stateChanges(t).pipe(Object(l.a)((t,e)=>[...t,...e],[]))}snapshotChanges(t){const e=Yd(t);return Hd(this.query,e,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(t={}){return Qd(this.query,this.afs.schedulers.outsideAngular).pipe(Object(h.a)(e=>e.payload.docs.map(e=>t.idField?Object.assign({[t.idField]:e.id},e.data()):e.data())),this.afs.keepUnstableUntilFirst)}get(t){return Object(s.a)(this.query.get(t)).pipe(Object(p.b)(this.afs.schedulers.insideAngular))}}const Zd=new r.s("angularfire2.enableFirestorePersistence"),tp=new r.s("angularfire2.firestore.persistenceSettings"),ep=new r.s("angularfire2.firestore.settings"),np=new r.s("angularfire2.firestore.use-emulator");function rp(t,e=(t=>t)){return{query:e(t),ref:t}}let ip=(()=>{class t{constructor(t,e,n,r,i,o,u,c,h){this.schedulers=new y.d(o),this.keepUnstableUntilFirst=Object(y.h)(this.schedulers);const l=Object(y.g)(t,o,e);!v.a.auth&&h&&Object(y.j)();const f=c;[this.firestore,this.persistenceEnabled$]=Object(y.f)(`${l.name}.firestore`,"AngularFirestore",l,()=>{const t=o.runOutsideAngular(()=>l.firestore());if(r&&t.settings(r),f&&t.useEmulator(...f),n&&!Object(g.u)(i)){const e=()=>{try{return Object(s.a)(t.enablePersistence(u||void 0).then(()=>!0,()=>!1))}catch(Md){return"undefined"!=typeof console&&console.warn(Md),Object(a.a)(!1)}};return[t,o.runOutsideAngular(e)]}return[t,Object(a.a)(!1)]},[r,f,n])}collection(t,e){let n;n="string"==typeof t?this.firestore.collection(t):t;const{ref:r,query:i}=rp(n,e),o=this.schedulers.ngZone.run(()=>r);return new Xd(o,i,this)}collectionGroup(t,e){const n=e||(t=>t),r=this.firestore.collectionGroup(t);return new Jd(n(r),this)}doc(t){let e;e="string"==typeof t?this.firestore.doc(t):t;const n=this.schedulers.ngZone.run(()=>e);return new $d(n,this)}createId(){return this.firestore.collection("_").doc().id}}return t.\u0275fac=function(e){return new(e||t)(r.Yb(y.c),r.Yb(y.b,8),r.Yb(Zd,8),r.Yb(ep,8),r.Yb(r.D),r.Yb(r.B),r.Yb(tp,8),r.Yb(np,8),r.Yb(Kd.b,8))},t.\u0275prov=r.Kb({factory:function(){return new t(r.Yb(y.c),r.Yb(y.b,8),r.Yb(Zd,8),r.Yb(ep,8),r.Yb(r.D),r.Yb(r.B),r.Yb(tp,8),r.Yb(np,8),r.Yb(Kd.b,8))},token:t,providedIn:"any"}),t})()}}]);